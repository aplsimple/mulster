<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>hl_tcl reference</title>
<style>
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
html{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var,optgroup{font-style:inherit;font-weight:inherit;}del,ins{text-decoration:none;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup{vertical-align:baseline;}sub{vertical-align:baseline;}legend{color:#000;}input,button,textarea,select,optgroup,option{font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;}input,button,textarea,select{*font-size:100%;}body{font:13px/1.231 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small;}select,input,button,textarea,button{font:99% arial,helvetica,clean,sans-serif;}table{font-size:inherit;font:100%;}pre,code,kbd,samp,tt{font-family:monospace;*font-size:108%;line-height:100%;}body{text-align:center;}#doc,#doc2,#doc3,#doc4,.yui-t1,.yui-t2,.yui-t3,.yui-t4,.yui-t5,.yui-t6,.yui-t7{margin:auto;text-align:left;width:57.69em;*width:56.25em;}#doc2{width:73.076em;*width:71.25em;}#doc3{margin:auto;width:auto;}#doc4{width:74.923em;*width:73.05em;}.yui-b{position:relative;}.yui-b{_position:static;}#yui-main .yui-b{position:static;}#yui-main,.yui-g .yui-u .yui-g{width:100%;}.yui-t1 #yui-main,.yui-t2 #yui-main,.yui-t3 #yui-main{float:right;margin-left:-25em;}.yui-t4 #yui-main,.yui-t5 #yui-main,.yui-t6 #yui-main{float:left;margin-right:-25em;}.yui-t1 .yui-b{float:left;width:12.30769em;*width:12.00em;}.yui-t1 #yui-main .yui-b{margin-left:13.30769em;*margin-left:13.05em;}.yui-t2 .yui-b{float:left;width:13.8461em;*width:13.50em;}.yui-t2 #yui-main .yui-b{margin-left:14.8461em;*margin-left:14.55em;}.yui-t3 .yui-b{float:left;width:23.0769em;*width:22.50em;}.yui-t3 #yui-main .yui-b{margin-left:24.0769em;*margin-left:23.62em;}.yui-t4 .yui-b{float:right;width:13.8456em;*width:13.50em;}.yui-t4 #yui-main .yui-b{margin-right:14.8456em;*margin-right:14.55em;}.yui-t5 .yui-b{float:right;width:18.4615em;*width:18.00em;}.yui-t5 #yui-main .yui-b{margin-right:19.4615em;*margin-right:19.125em;}.yui-t6 .yui-b{float:right;width:23.0769em;*width:22.50em;}.yui-t6 #yui-main .yui-b{margin-right:24.0769em;*margin-right:23.62em;}.yui-t7 #yui-main .yui-b{display:block;margin:0 0 1em 0;}#yui-main .yui-b{float:none;width:auto;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf,.yui-gc .yui-u,.yui-gd .yui-g,.yui-g .yui-gc .yui-u,.yui-ge .yui-u,.yui-ge .yui-g,.yui-gf .yui-g,.yui-gf .yui-u{float:right;}.yui-g div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first,.yui-ge div.first,.yui-gf div.first,.yui-g .yui-gc div.first,.yui-g .yui-ge div.first,.yui-gc div.first div.first{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf{width:49.1%;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{width:32%;margin-left:1.99%;}.yui-gb .yui-u{*margin-left:1.9%;*width:31.9%;}.yui-gc div.first,.yui-gd .yui-u{width:66%;}.yui-gd div.first{width:32%;}.yui-ge div.first,.yui-gf .yui-u{width:74.2%;}.yui-ge .yui-u,.yui-gf div.first{width:24%;}.yui-g .yui-gb div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first{margin-left:0;}.yui-g .yui-g .yui-u,.yui-gb .yui-g .yui-u,.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u,.yui-ge .yui-g .yui-u,.yui-gf .yui-g .yui-u{width:49%;*width:48.1%;*margin-left:0;}.yui-g .yui-g .yui-u{width:48.1%;}.yui-g .yui-gb div.first,.yui-gb .yui-gb div.first{*margin-right:0;*width:32%;_width:31.7%;}.yui-g .yui-gc div.first,.yui-gd .yui-g{width:66%;}.yui-gb .yui-g div.first{*margin-right:4%;_margin-right:1.3%;}.yui-gb .yui-gc div.first,.yui-gb .yui-gd div.first{*margin-right:0;}.yui-gb .yui-gb .yui-u,.yui-gb .yui-gc .yui-u{*margin-left:1.8%;_margin-left:4%;}.yui-g .yui-gb .yui-u{_margin-left:1.0%;}.yui-gb .yui-gd .yui-u{*width:66%;_width:61.2%;}.yui-gb .yui-gd div.first{*width:31%;_width:29.5%;}.yui-g .yui-gc .yui-u,.yui-gb .yui-gc .yui-u{width:32%;_float:right;margin-right:0;_margin-left:0;}.yui-gb .yui-gc div.first{width:66%;*float:left;*margin-left:0;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf .yui-u{margin:0;}.yui-gb .yui-gb .yui-u{_margin-left:.7%;}.yui-gb .yui-g div.first,.yui-gb .yui-gb div.first{*margin-left:0;}.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u{*width:48.1%;*margin-left:0;}.yui-gb .yui-gd div.first{width:32%;}.yui-g .yui-gd div.first{_width:29.9%;}.yui-ge .yui-g{width:24%;}.yui-gf .yui-g{width:74.2%;}.yui-gb .yui-ge div.yui-u,.yui-gb .yui-gf div.yui-u{float:right;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf div.first{float:left;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf div.first{*width:24%;_width:20%;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf .yui-u{*width:73.5%;_width:65.5%;}.yui-ge div.first .yui-gd .yui-u{width:65%;}.yui-ge div.first .yui-gd div.first{width:32%;}#hd:after,#bd:after,#ft:after,.yui-g:after,.yui-gb:after,.yui-gc:after,.yui-gd:after,.yui-ge:after,.yui-gf:after{content:".";display:block;height:0;clear:both;visibility:hidden;}#hd,#bd,#ft,.yui-g,.yui-gb,.yui-gc,.yui-gd,.yui-ge,.yui-gf{zoom:1;}

body{margin:10px;}h1{font-size:138.5%;}h2{font-size:123.1%;}h3{font-size:108%;}h1,h2,h3{margin:1em 0;}h1,h2,h3,h4,h5,h6,strong,dt{font-weight:bold;}optgroup{font-weight:normal;}abbr,acronym{border-bottom:1px dotted #000;cursor:help;}em{font-style:italic;}del{text-decoration:line-through;}blockquote,ul,ol,dl{margin:1em;}ol,ul,dl{margin-left:2em;}ol li{list-style:decimal outside;}ul li{list-style:disc outside;}dl dd{margin-left:1em;}th,td{border:1px solid #000;padding:.5em;}th{font-weight:bold;text-align:center;}caption{margin-bottom:.5em;text-align:center;}sup{vertical-align:super;}sub{vertical-align:sub;}p,fieldset,table,pre{margin-bottom:1em;}button,input[type="checkbox"],input[type="radio"],input[type="reset"],input[type="submit"]{padding:1px;}


/* Ruff default CSS */

body {
  max-width: 70em;
  margin: 0;
}

h1,h2 {
  color: #888888;
  margin-bottom: 0.5em;
  margin-top: 0em;
}

#ft {
  text-align: left;
  border-top: 1px solid #006666;
  color: #888888;
  margin-top: 10px;
}

.banner h2 {
  color: #006666;
}

#hd.banner {
 font-family: "Times New Roman", serif;
 font-size: 200%;
 line-height: 64px;
 border-bottom: thin solid #006666;
 color: #006666;
}

p.linkline {
    text-align: right;
    font-size: smaller;
    /*    margin-top: -1em; */
    margin-bottom: 0;
}

.tinylink {
    font-size: x-small;
    font-variant: normal;
    font-family: Arial, sans-serif;
    float: right;
    padding:2px;
}

h1 .tinylink a {
    color: white;
}

#bd {
font-family: Arial, sans-serif;
font-size: 108%;
}

div.navbox {
  /* margin-top: 1em; */
    background-color: #006666;
    color: white;
    padding: 3px 4px 2px 4px;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

div.navbox:hover {
    overflow: visible;
}

/* Note .navbox header css should be based on $header_levels */
.navbox h1, .navbox h2, .navbox h3, .navbox h4, .navbox h5 {
  font-size: 85%;
  margin: 0px;
  font-weight: normal;
}
.navbox h1 {
    font-weight: bold; /* Override */
}
.navbox h2 {
  padding-left: 1em;
}
.navbox h3 {
  padding-left: 2em;
}
.navbox h4 {
  padding-left: 2.5em;
  font-weight: normal;
}
.navbox h5 {
  padding-left: 3em;
  font-weight: normal;
}
.navbox hr {
  color: white;
  margin-top:0.1em;
  margin-bottom:0.1em;
}

.navbox a:link, .navbox a:visited, .navbox a:hover {
  text-decoration: none;
  color: white;
  background-color: #006666;
}

.navbox a:hover {
   font-weight: bold;
}

/* Tooltip text - see https://www.w3schools.com/css/css_tooltip.asp */
.tooltip {
    position: relative;
    /* display: inline-block; */
}

.tooltip .tooltiptext {
    width: 100%;
    font-weight: bold;
    background-color: white;
    color: #006666;
    text-align: left;
    border: 1px solid #006666;
    /* border-radius: 4px; */
    position: absolute;
    z-index: 1;
    margin-left: 4px;
    padding: 2px 3px;
    visibility: hidden;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
    visibility: visible;
}

span.ns_scope {
    color: #aaaaaa;
}

span.ns_scope a:link, span.ns_scope a:visited {
  text-decoration: none;
  color: #aaaaaa;

}

li {
  margin-top: 0.5em;
}

span.ns_scope a:hover {
  text-decoration: none;
  color: #666666;
}

table {
  margin: 1em;
  margin-top: 0.5em;
  border: thin solid;
  border-collapse: collapse;
  border-color: #808080;
  padding: 4px;
}

td {
  border: thin solid;
  border-color: #808080;
  vertical-align: top;
  font-size: 93%;
  padding: 0.3em;
  padding-top: 0.1em;
}
th {
  border: thin solid;
  border-color: #808080;
  padding: 0.3em;
  padding-top: 0.1em;
  background-color: #CCCCCC;
}

dt, dd {
   font-size: 93%;
}

h1.ruff {
    background-color: #006666;
    color: #ffffff;
    padding-left: 0.2em;
    font-family: "Times New Roman", serif;
}
h2.ruff {
    font-variant: small-caps;
    color: #006666;
    font-family: "Times New Roman", serif;
}

h3.ruff, h4.ruff, h5.ruff, h6.ruff {
    color: #006666;
}
h5.ruff {
    font-style: italic;
    font-weight: normal;
}
h6.ruff {
    font-weight: normal;
}
h3.ruffclass, h3.ruffproc, h3.ruffmethod,
h4.ruffclass, h4.ruffproc, h4.ruffmethod,
h5.ruffclass, h5.ruffproc, h5.ruffmethod {
    border-bottom: thin solid #006666;
    color: #006666;
    margin-bottom: 0.2em;
}

pre {
    background-color: #eeeeee;
    margin-top: 1em;
    margin-left: 1em;
    padding: 5px;
    font-family: Consolas, "Courier New", monospace;
    width: max-content;
    font-size: smaller;
    line-height: 1.2em;
}

.ruff_dyn_src {
    display: none; /* Displayed via JS */
}

.ruff_synopsis {
    border: thin solid #cccccc;
    background: #eeeeee;
    font-size: smaller;
    font-family: Consolas, "Courier New", monospace;
    padding: 5px;
    margin: 0em 2em 1em;
}
.ruff_const, .ruff_cmd, ruff_defitem {
    font-weight: bold;
    font-family: Consolas, "Courier New", monospace;
}
.ruff_arg {
    font-style: italic;
    font-family: Consolas, "Courier New", monospace;
}

.ruff_source_link {
    font-size: smaller;
}

.ruff_index {
    font-size: small;
    color: grey;
    line-height: 1;
}

.ruff_index ul li {
    list-style-type: none;
}

.ruff_index ul li a {
    text-decoration: none;
}
</style>
<script>function toggleSource( id )
{
    /* Copied from Rails */
    var elem
    var link

    if( document.getElementById )
    {
        elem = document.getElementById( id )
        link = document.getElementById( "l_" + id )
    }
    else if ( document.all )
    {
        elem = eval( "document.all." + id )
        link = eval( "document.all.l_" + id )
    }
    else
        return false;

    if( elem.style.display == "block" )
    {
        elem.style.display = "none"
        link.innerHTML = "Show source"
    }
    else
    {
        elem.style.display = "block"
        link.innerHTML = "Hide source"
    }
}
</script></head>
<body><div id='doc3' class='yui-t2'><div id='hd' class='banner'>
<a style='text-decoration:none;' href='hl_tcl.html'>hl_tcl reference</a>
</div>
<div id='bd'><div id='yui-main'><div class='yui-b'><h1 class='ruff'><a name='::hl_tcl'></a>::hl_tcl<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <em>hl_tcl</em> package is a syntax highlighter for Tcl/Tk code.</p>
<p class='ruff'>It can be applied to a <em>Tk text</em> widget or to a static html page.</p>
<p class='ruff'>The <em>Tk text</em> widget may be made read-only or editable. Also, the <em>hl_tcl</em> may take an argument, sort of command to watch the viewing / editing.</p>
<p class='ruff'>When applied to html pages, the <em>hl_tcl</em> highlights Tcl/Tk code snippets embedded between &lt;code&gt; &lt;/code&gt; tags.</p>
<p class='ruff'>The <em>hl_tcl</em> has highlighted its own code in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>.</p>
<h2 class='ruff'><a name='::hl_tcl-Some of blah-blah'></a>Some of blah-blah<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The Tcl being incredibly dynamic language sets a lot of problems before any Tcl syntax highlighter. Probably, the usage of quotes and esp. the strings spanning several lines are the main challenges.</p>
<p class='ruff'>Below is a line that brings most (not <em>hl_tcl</em>, as seen in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>) of Tcl highlighters in a stupor:</p>
<pre class='ruff'>
  if {[set i [string first {&quot;} $line $i]]==-1} {return no}
</pre>
<p class='ruff'>... as well as this one:</p>
<pre class='ruff'>
  regsub -all {(([^A-Z@]|\\@)[.?!](&quot;|'|'')?([])])?) } $fieldText {\1  } fieldText
</pre>
<p class='ruff'>Good luck for a highlighter when the second line (or similar) follows the first, giving it a matching quote and thus bringing it out of the stupor.</p>
<p class='ruff'>Those orphan quotes are often used in <code>regexp</code> and <code>regsub</code> Tcl commands, so that when a honest Tcl highlighter (like <a href="https://www.geany.org" title="Geany IDE">Geany</a>) stumbles upon an orphan quote, it tries its best to highlight the rest of code as a string, till the next unmatched quote.</p>
<p class='ruff'>Thus, we have</p>
<p class='ruff'>&lt;img src=&quot;https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl1.png&quot; class=&quot;media&quot; alt=&quot;&quot;&gt;</p>
<p class='ruff'>... instead of</p>
<p class='ruff'>&lt;img src=&quot;https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl2.png&quot; class=&quot;media&quot; alt=&quot;&quot;&gt;</p>
<p class='ruff'>There are &quot;tricky&quot; highlighters (like <a href="https://wiki.gnome.org/Apps/Gedit" title="Gedit editor">Gedit</a>) that behave more wisely at the stumbling an orphan quote: they permit only a one-line Tcl strings (if not continued with \), so that the string highlighting would be most likely finished in the same line it started. No problems except for this silly line. And no delays due to the highlighting the rest of code...</p>
<p class='ruff'>... as seen in:</p>
<p class='ruff'>&lt;img src=&quot;https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl3.png&quot; class=&quot;media&quot; alt=&quot;&quot;&gt;</p>
<h2 class='ruff'><a name='::hl_tcl-Some of editors'></a>Some of editors<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'><a href="https://www.geany.org" title="Geany IDE">Geany</a>. Probably, the best Tcl highlighter. And the great programming tool at that. Still, it has few drawbacks:</p>
<ul class='ruff'>
<li>doesn't highlight the above mentioned Tcl lines properly</li>
<li>doesn't highlight <code>${var}</code> in contrast with <code>$var</code></li>
<li>tries to highlight any (even hexidecimal) number it encounters, thus <code>set a 1fix</code> or <code>set b #abxxx</code> looks a bit peculiar</li>
<li><code>set c {{#000} #FFF}</code> is quite a legal Tcl command as well as <code>set c {#000 #FFF}</code>, not for Geany</li>
<li>no highlighting TclOO (<code>method, mixin, my</code> etc.)</li>
</ul>
<p class='ruff'><a href="http://www.vim.org/" title="Vim editor">Vim</a>. Probably, the fastest Tcl highlighter. Great and awful. Nonetheless:</p>
<ul class='ruff'>
<li>tricky with those above mentioned Tcl lines</li>
<li>doesn't highlight ttk commands (Tk only) and TclOO</li>
<li>tries to highlight every bit of Tcl, e.g. <code>set set set</code> is highlighted as three <code>set</code> commands ;)</li>
<li>as a result, much more florid than most of others</li>
</ul>
<p class='ruff'><a href="https://kate-editor.org" title="Kate editor">Kate</a>. As nearly good as Geany. As nearly florid as Vim (<code>set set set</code>). Doesn't highlight ttk and TclOO.</p>
<p class='ruff'><a href="https://github.com/phase1geo/tke/" title="TKE editor">TKE</a>. Written in Tcl/Tk, it might be the best of all to highlight the Tcl/Tk. In spite of its suspended state it still can. Issues with highlighting strings and the performance.</p>
<p class='ruff'><a href="http://mate-desktop.org" title="Pluma editor">Pluma</a> and <a href="https://wiki.gnome.org/Apps/Gedit" title="Gedit editor">Gedit</a> seem to use the same Tcl highlighting engine that gives rather good results. Still, the mentioned above drawbacks are here too. And no highlighting of tk, ttk, TclOO.</p>
<p class='ruff'><a href="https://notepad-plus-plus.org/" title="Notepad++ official site">Notepad++</a>. Very fast Tcl highlighter. And very basic. All the same drawbacks. No highlighting of tk, ttk, TclOO. <em>Plus</em> an obsolete version of Tcl, i.e. no highlighting <code>lset, lassign</code> etc.</p>
<h2 class='ruff'><a name='::hl_tcl-What can we do?'></a>What can we do?<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>To develop an ideal (correct and fast) Tcl/Tk highlighter, we would have to dive into Tcl core. Though, no hopes to achieve the ideal through repeating the core in Tcl/Tk or massively using the regular expressions.</p>
<p class='ruff'>That said, while implementing Tcl/Tk highlighter <em>in pure Tcl/Tk</em>, we might hope to achieve a reasonable compromise between the performance and the elimination of blunders.</p>
<p class='ruff'>It seems <em>hl_tcl</em> got close to this compromise. Specifically, it provides:</p>
<ul class='ruff'>
<li>special highlighting for Tcl and TclOO commands</li>
<li>special highlighting for Tk and ttk commands</li>
<li>allowing additional commands to highlight (as Tk ones)</li>
<li>special highlighting for declarations <code>proc, method, oo::class</code> etc. as well as <code>return, yield</code></li>
<li>special highlighting for <code>#comments</code>, <code>$variables</code>, <code>&quot;strings&quot;</code>, <code>-options</code></li>
<li>in-line comments being recognized and thus highlighted only after <code>;#</code></li>
<li>proper handling of most <code>regexp</code> and <code>regsub</code> expressions containing a quote</li>
<li>highlighting the multi-line strings, with possible switching this mode off (a-la Gedit) to improve the performance</li>
<li>customizing colors of the highlighting</li>
<li>highlighting viewable/editable <em>Tk text</em> widget and static html pages</li>
<li>good performance at editing 1000-4000 LOC and rather acceptable for 4000-9000 LOC</li>
<li>even monstrous 10000 LOC and more are handled fast at the &quot;tricky&quot; mode a-la Gedit</li>
</ul>
<p class='ruff'>The <em>hl_tcl</em> doesn't provide the following:</p>
<ul class='ruff'>
<li>highlighting <em>numbers</em></li>
<li>highlighting <em>brackets</em>, except for matched ones and inside the strings</li>
</ul>
<p class='ruff'>These are in no way critical drawbacks. A little less florid Tcl code might be even preferable for other tastes.</p>
<p class='ruff'>The Tcl can arrange its pitfalls for <em>hl_tcl</em> (I know where). Also, tricky practices or tastes can make a fool of <em>hl_tcl</em>. Still hopefully these pranks are few and rare to encounter.</p>
<h2 class='ruff'><a name='::hl_tcl-Use for text widget'></a>Use for text widget<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The code below:</p>
<pre class='ruff'>
  package require hl_tcl

  proc ::stub {args} {puts &quot;stub: $args&quot;}

  ::hl_tcl::hl_init $::txt -readonly yes -cmd ::stub

  #... inserting a text into the text widget

  ::hl_tcl::hl_text $::txt
</pre>
<p class='ruff'>sets an example of <em>hl_tcl</em> usage. Here are the details:</p>
<ul class='ruff'>
<li><strong>::stub</strong> is a procedure to watch the text editing; here it simply puts out the text's last index;</li>
<li><strong>hl_init</strong> is called <em>before</em> filling the text widget with a Tcl code; it sets the highlighting options and disables the highlighting till <em>hl_text</em> runs;</li>
<li><strong>hl_text</strong> runs to highlight the Tcl code of the text widget and to view/edit it.</li>
</ul>
<p class='ruff'>The <strong>hl_init</strong> takes arguments:</p>
<ul class='ruff'>
<li><em>txt</em> is the text widget's path</li>
<li><em>args</em> contains options of text widget (omittable)</li>
</ul>
<p class='ruff'>The <em>args</em> is a list of <em>-option &quot;value&quot;</em> where <em>-option</em> may be:</p>
<ul class='ruff'>
<li><em>-colors</em> - list of colors: clrCOM, clrCOMTK, clrSTR, clrVAR, clrCMN, clrPROC, clrOPT</li>
<li><em>-dark</em> - flag &quot;dark background of text&quot;, i.e. simplified <em>-colors</em> (default &quot;no&quot;)</li>
<li><em>-font</em> - attributes of text font</li>
<li><em>-readonly</em> - flag &quot;text is read-only&quot; (default &quot;no&quot;)</li>
<li><em>-multiline</em> - flag &quot;multi-line strings&quot; (default &quot;yes&quot;)</li>
<li><em>-cmd</em> - command to watch editing/viewing (default &quot;&quot;)</li>
<li><em>-cmdpos</em> - command to watch cursor positioning (default &quot;&quot;)</li>
<li><em>-seen</em> - number of first lines seen at start (default 500)</li>
<li><em>-optRE</em> - flag &quot;use a regular expression to highlight options&quot; (default &quot;yes&quot;)</li>
<li><em>-keywords</em> - additional commands to highlight (as Tk ones)</li>
<li><em>-dobind</em> - if <code>true</code>, forces keys binding at repeating calls of hl_init</li>
<li><em>-plaintext</em> - <code>true</code> for plain texts with no highlighting</li>
<li><em>-plaincom</em> - a command for plain highlighting line by line</li>
</ul>
<p class='ruff'><strong>Note</strong>: <code>-seen 500</code> and <code>-multiline no</code> can improve the performance a lot. It's recommended to use <code>-seen 500</code> (or any other reasonable limit, e.g. <code>-seen 200</code>) at any rate, except for static html pages.</p>
<p class='ruff'>A command for <em>-plaincom</em> option has two arguments: a current text's path and a current line's number. It should highlight the current line and return <code>true</code>, otherwise (if the current line is Tcl code) it returns <code>false</code>. An example of its usage is presented by <a href="https://github.com/aplsimple/alited" >alited editor</a> (<code>lib/addon</code> directory).</p>
<p class='ruff'>The rest of <em>hl_tcl</em> procedures are:</p>
<ul class='ruff'>
<li><strong>hl_all</strong> updates all highlighted existing text widgets, e.g. at changing a color scheme of application</li>
<li><strong>hl_readonly</strong> gets/sets a read-only mode and/or a command to watch a text widget at viewing/editing it</li>
<li><strong>hl_colors</strong> gets a list of colors for highlighting</li>
</ul>
<p class='ruff'>See details in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>.</p>
<h2 class='ruff'><a name='::hl_tcl-Use for static html'></a>Use for static html<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>In the <a href="https://chiselapp.com/user/aplsimple/repository/hl_tcl/download" >hl_tcl.zip</a>, there is a Tcl script named <em>tcl_html.tcl</em> that highlights Tcl snippets of static html page(s).</p>
<p class='ruff'>It runs as follows:</p>
<pre class='ruff'>
  tclsh tcl_html.tcl &quot;glob-pattern-of-html-files&quot;
</pre>
<p class='ruff'>For example:</p>
<pre class='ruff'>
  tclsh ~/UTILS/hl_tcl/tcl_html.tcl &quot;~/UTILS/mulster/tasks/ruff/src/*&quot;
</pre>
<p class='ruff'>In this example, the html files are located in <code>~/UTILS/mulster/tasks/ruff/src</code>.</p>
<p class='ruff'>Perhaps, you would want to modify the <em>tcl_html.tcl</em>, this way:</p>
<ul class='ruff'>
<li>replace <code>&quot;no&quot;</code> with <code>&quot;yes&quot;</code> for dark html pages</li>
<li>replace <code>&lt;code class=&quot;tcl&quot;&gt;</code> with html tags <em>starting</em> the Tcl code in your html files</li>
<li>replace <code>&lt;/code&gt;</code> with html tags <em>finishing</em> the Tcl code in your html files</li>
</ul>
<p class='ruff'>These are arguments of <code>::hl_tcl_html::highlight</code> procedure.</p>
<p class='ruff'>The tag pairs can be multiple if the html pages contain them, e.g.</p>
<pre class='ruff'>
  ::hl_tcl_html::highlight $fhtml &quot;no&quot;  {&lt;code class=&quot;tcl&quot;&gt;} {&lt;/code&gt;}  {&lt;pre class=&quot;code&quot;&gt;} {&lt;/pre&gt;}
</pre>
<h2 class='ruff'><a name='::hl_tcl-Links'></a>Links<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<ul class='ruff'>
<li><a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a></li>
<li><a href="https://chiselapp.com/user/aplsimple/repository/hl_tcl/download" >Source</a> (hl_tcl.zip)</li>
<li><a href="https://github.com/aplsimple/hl_tcl/releases/download/hl_tcl-0.6.1/hl_tcl-0.6.1.mp4" >Demo of hl_tcl v0.6.1</a> (25 Mb)</li>
</ul>
<p class='ruff'>Note that <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >hl_tcl</a> is still disposed to update.</p>
<h2 class='ruff'><a name='::hl_tcl-Commands'></a>Commands<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h4 class='ruffproc'><a name='::hl_tcl::addingColors'>addingColors</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Sets/gets colors for a text syntax highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>addingColors</span> <span class='ruff_arg'>?dark? ?txt? ?cs?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>dark</code></td><td class='ruff_defitem'>yes, if the current theme is dark Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>path to the text or {} Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>cs</code></td><td class='ruff_defitem'>color scheme Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>If <em>txt</em> omitted, returns a list of resting colors. The resting colors are:</p>
<ul class='ruff'>
<li>current line's background</li>
<li>#TODO and #! comment's foreground</li>
</ul>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_addingColors' href="javascript:toggleSource('hl_tcl_addingColors')">Show source</a></p>
<div id='hl_tcl_addingColors' class='ruff_dyn_src'><pre>proc ::hl_tcl::addingColors {{dark {}} {txt {}} {cs {}}} {
    # Sets/gets colors for a text syntax highlighting.
    #   dark - yes, if the current theme is dark
    #   txt - path to the text or {}
    #   cs - color scheme
    # If *txt* omitted, returns a list of resting colors.
    # The resting colors are:
    #   - current line's background
    #   - #TODO and #! comment's foreground

    variable my::data
    # try to get color options from current apave settings
    if {[catch {set clrCURL [lindex [::apave::obj csGet $cs] 16]}]} {
      set clrCURL {}
    }
    if {$dark eq {}} {
      if {[catch {set dark [::apave::obj csDark]}]} {
        set dark no
      }
    }
    if {$dark} {
      if {$clrCURL eq {}} {set clrCURL #29383c}
      set clrCMN2 #ff7272
    } else {
      if {$clrCURL eq {}} {set clrCURL #efe0cd}
      set clrCMN2 #ff0000
    }
    if {$txt eq {}} {
      return [list $clrCURL $clrCMN2]
    }
    set my::data(COLORS,$txt) [list {*}[hl_colors $txt] $clrCURL $clrCMN2]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::clearup'>clearup</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Clears data related to text (esp. at deleting it).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>clearup</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_clearup' href="javascript:toggleSource('hl_tcl_clearup')">Show source</a></p>
<div id='hl_tcl_clearup' class='ruff_dyn_src'><pre>proc ::hl_tcl::clearup {txt} {
    # Clears data related to text (esp. at deleting it).
    #   txt - text's path

    variable my::data
    foreach key [array names my::data *,$txt] {
      unset my::data($key)
    }
    foreach i [lsearch -all -exact -index 0 $my::data(LIST_TXT) $txt] {
      set my::data(LIST_TXT) [lreplace $my::data(LIST_TXT) $i $i]
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_all'>hl_all</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_all</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>dict of options</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::hl_init" title="hl_init" class='ruff_cmd'>hl_init</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_all' href="javascript:toggleSource('hl_tcl_hl_all')">Show source</a></p>
<div id='hl_tcl_hl_all' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_all {args} {
    # Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.
    #   args - dict of options
    # See also: hl_init

    if {[info exists ::hl_tcl::my::data(LIST_TXT)]} {
      foreach wattrs $::hl_tcl::my::data(LIST_TXT) {
        lassign $wattrs txt ro com2
        if {[winfo exists $txt]} {
          if {![info exists ::hl_tcl::my::data(SETCOLORS,$txt)]} {
            unset ::hl_tcl::my::data(COLORS,$txt) ;# colors defined by DARK
          }
          # args (if set) override the appropriate settings for $txt
          hl_init $txt -- {*}$args
          hl_text $txt
        }
      }
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_colorNames'>hl_colorNames</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Returns a list of color names for syntax highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_colorNames</span> </div>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of color names for syntax highlighting.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_colorNames' href="javascript:toggleSource('hl_tcl_hl_colorNames')">Show source</a></p>
<div id='hl_tcl_hl_colorNames' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_colorNames {} {
    # Returns a list of color names for syntax highlighting.

    return [list clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT clrBRA]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_colors'>hl_colors</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_colors</span> <span class='ruff_arg'>txt ?dark? ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path or {} or an index of default colors</td></tr>
<tr><td class='ruff_defitem'><code>dark</code></td><td class='ruff_defitem'>flag &quot;dark scheme&quot; Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>a list of colors to set for <em>txt</em></td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of colors for COM COMTK STR VAR CMN PROC OPT BRAC  or, if the colors aren't initialized, &quot;standard&quot; colors.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_colors' href="javascript:toggleSource('hl_tcl_hl_colors')">Show source</a></p>
<div id='hl_tcl_hl_colors' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_colors {txt {dark {}} args} {
    # Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).
    #   txt - text widget's path or {} or an index of default colors
    #   dark - flag &quot;dark scheme&quot;
    #   args - a list of colors to set for *txt*
    # Returns a list of colors for COM COMTK STR VAR CMN PROC OPT BRAC  or, if the colors aren't initialized, &quot;standard&quot; colors.

    if {[llength $args]} {
      set ::hl_tcl::my::data(COLORS,$txt) $args
      return
    }
    if {[info exists ::hl_tcl::my::data(COLORS,$txt)]}  {
      return $::hl_tcl::my::data(COLORS,$txt)
    }
    if {$dark eq {}} {set dark $::hl_tcl::my::data(DARK,$txt)}
    if {![string is integer -strict $txt] || $txt&lt;0 || $txt&gt;3} {set txt 0}
    if {$dark} {set dark 1} {set dark 0}
    return [lindex $::hl_tcl::my::data(SYNTAXCOLORS,$txt) $dark]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_commands'>hl_commands</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Lists all Tcl/Tk commands registered here.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_commands</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_commands' href="javascript:toggleSource('hl_tcl_hl_commands')">Show source</a></p>
<div id='hl_tcl_hl_commands' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_commands {} {
    # Lists all Tcl/Tk commands registered here.

    variable my::data
    return [list {*}$my::data(PROC_TCL) {*}$my::data(CMD_TCL) {*}$my::data(CMD_TK)]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_init'>hl_init</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Initializes highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_init</span> <span class='ruff_arg'>txt ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>dict of options</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>The 'args' options include:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>--</td><td class='ruff_defitem'>means that only args' options will be initialized (defaults skipped)</td></tr>
<tr><td class='ruff_defitem'>-dark</td><td class='ruff_defitem'>flag &quot;the text widget has dark background&quot;</td></tr>
<tr><td class='ruff_defitem'>-readonly</td><td class='ruff_defitem'>flag &quot;read-only&quot;</td></tr>
<tr><td class='ruff_defitem'>-optRE</td><td class='ruff_defitem'>flag &quot;use of RE to highlight options&quot;</td></tr>
<tr><td class='ruff_defitem'>-multiline</td><td class='ruff_defitem'>flag &quot;allowed multi-line strings&quot;</td></tr>
<tr><td class='ruff_defitem'>-cmd</td><td class='ruff_defitem'>command to watch editing/viewing</td></tr>
<tr><td class='ruff_defitem'>-cmdpos</td><td class='ruff_defitem'>command to watch cursor positioning</td></tr>
<tr><td class='ruff_defitem'>-colors</td><td class='ruff_defitem'>list of colors as set in hl_tcl::hl_colorNames</td></tr>
<tr><td class='ruff_defitem'>-font</td><td class='ruff_defitem'>attributes of font</td></tr>
<tr><td class='ruff_defitem'>-seen</td><td class='ruff_defitem'>lines seen at start</td></tr>
<tr><td class='ruff_defitem'>-keywords</td><td class='ruff_defitem'>additional commands to highlight (as Tk ones)</td></tr>
<tr><td class='ruff_defitem'>-dobind</td><td class='ruff_defitem'>if yes, forces key bindings</td></tr>
</table>
<p class='ruff'>This procedure has to be called before writing a text in the text widget.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::hl_colorNames" title="hl_colorNames" class='ruff_cmd'>hl_colorNames</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_init' href="javascript:toggleSource('hl_tcl_hl_init')">Show source</a></p>
<div id='hl_tcl_hl_init' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_init {txt args} {
    # Initializes highlighting.
    #   txt - text widget's path
    #   args - dict of options
    # The 'args' options include:
    #   -- - means that only args' options will be initialized (defaults skipped)
    #   -dark - flag &quot;the text widget has dark background&quot;
    #   -readonly - flag &quot;read-only&quot;
    #   -optRE - flag &quot;use of RE to highlight options&quot;
    #   -multiline - flag &quot;allowed multi-line strings&quot;
    #   -cmd - command to watch editing/viewing
    #   -cmdpos - command to watch cursor positioning
    #   -colors - list of colors as set in hl_tcl::hl_colorNames
    #   -font - attributes of font
    #   -seen - lines seen at start
    #   -keywords - additional commands to highlight (as Tk ones)
    #   -dobind - if yes, forces key bindings
    # This procedure has to be called before writing a text in the text widget.
    # See also: hl_colorNames

    if {[set setonly [expr {[lindex $args 0] eq {--}}]]} {
      set args [lrange $args 1 end]
    }
    iscurline $txt 1
    set ::hl_tcl::my::data(REG_TXT,$txt) {}  ;# disables Modified at changing the text
    set ::hl_tcl::my::data(KEYWORDS,$txt) {}
    set ::hl_tcl::my::data(DOBIND,$txt) 0
    foreach {opt val} {-dark 0 -readonly 0 -cmd {} -cmdpos {} -optRE 1 -dobind 0  -multiline 1 -seen 500 -plaintext no -plaincom {} -insertwidth 2 -keywords {}} {
      if {[dict exists $args $opt]} {
        set val [dict get $args $opt]
      } elseif {$setonly} {
        continue  ;# only those set in args are taken into account
      }
      set ::hl_tcl::my::data([string toupper [string range $opt 1 end]],$txt) $val
    }
    set ::hl_tcl::my::data(CMD_TK_EXP) [lsort [list  {*}$::hl_tcl::my::data(CMD_TK) {*}$::hl_tcl::my::data(KEYWORDS,$txt)]]
    unset ::hl_tcl::my::data(KEYWORDS,$txt)
    if {[dict exists $args -colors]} {
      set colors [dict get $args -colors]
      lassign [addingColors $::hl_tcl::my::data(DARK,$txt)] clrCURL clrCMN2
      if {[set llen [llength $colors]]==8} {
        lappend colors $clrCURL  ;# add curr.line color if omitted
      }
      if {$llen==9} {
        lappend colors $clrCMN2  ;# add #TODO color if omitted
      }
      set ::hl_tcl::my::data(COLORS,$txt) $colors
      set ::hl_tcl::my::data(SETCOLORS,$txt) 1
    } else {
      if {![info exists ::hl_tcl::my::data(COLORS,$txt)]}  {
        addingColors $::hl_tcl::my::data(DARK,$txt) $txt
      }
    }
    if {!$setonly} {
      if {[dict exists $args -font]} {
        set ::hl_tcl::my::data(FONT,$txt) [dict get $args -font]
      } else {
        set ::hl_tcl::my::data(FONT,$txt) [font actual TkFixedFont]
      }
      set ::hl_tcl::my::data(ISPLAINCOM,$txt) [expr {$::hl_tcl::my::data(PLAINCOM,$txt) ne {}}]
    }
    if {!$setonly || [dict exists $args -readonly]} {
      hl_readonly $txt $::hl_tcl::my::data(READONLY,$txt)
    }
    if {[string first ::hl_tcl:: [bind $txt]]&lt;0} {
      my::BindToEvent $txt &lt;FocusIn&gt; ::hl_tcl::my::ShowCurrentLine $txt
    }
    set ::hl_tcl::my::data(_INSPOS_,$txt) {}
    my::MemPos $txt
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_line'>hl_line</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Updates a current line's highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_line</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_line' href="javascript:toggleSource('hl_tcl_hl_line')">Show source</a></p>
<div id='hl_tcl_hl_line' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_line {txt} {
    # Updates a current line's highlighting.
    #   txt - text's path

    if {!$::hl_tcl::my::data(PLAINTEXT,$txt)} {
      set ln0 [expr {int([$txt index insert])}]
      set ln2 [expr {int([$txt index end])}]
      set ln1 [expr {max (1,$ln0-1)}]
      set ln2 [expr {min ($ln2,$ln0+1)}]
      # update lines: previous, current, next
      ::hl_tcl::my::RunCoroAfterIdle $txt $ln1 $ln2 no
    }
    ::hl_tcl::my::MemPos $txt yes
    $txt configure -insertwidth $::hl_tcl::my::data(INSERTWIDTH,$txt)
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_readonly'>hl_readonly</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Makes the text widget be readonly or gets its 'read-only' state.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_readonly</span> <span class='ruff_arg'>txt ?ro? ?com2?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>ro</code></td><td class='ruff_defitem'>flag &quot;the text widget is readonly&quot; Optional, default <code>-1</code>.</td></tr>
<tr><td class='ruff_defitem'><code>com2</code></td><td class='ruff_defitem'>command to be called at viewing and after changes Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>If 'ro' argument is omitted, returns the widget's 'read-only' state.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_readonly' href="javascript:toggleSource('hl_tcl_hl_readonly')">Show source</a></p>
<div id='hl_tcl_hl_readonly' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_readonly {txt {ro -1} {com2 {}}} {
    # Makes the text widget be readonly or gets its 'read-only' state.
    #   txt - text widget's path
    #   ro - flag &quot;the text widget is readonly&quot;
    #   com2 - command to be called at viewing and after changes
    # If 'ro' argument is omitted, returns the widget's 'read-only' state.

    if {$ro==-1} {
      return [expr {[info exists ::hl_tcl::my::data(READONLY,$txt)] &amp;&amp; $::hl_tcl::my::data(READONLY,$txt)}]
    }
    set ::hl_tcl::my::data(READONLY,$txt) $ro
    if {$com2 ne {}} {set ::hl_tcl::my::data(CMD,$txt) $com2}
    set newcom &quot;::$txt.internal&quot;
    if {[info commands $newcom] eq &quot;&quot;} {rename $txt $newcom}
    set com &quot;[namespace current]::my::Modified $txt&quot;
    #if {$com2 ne &quot;&quot;} {append com &quot; ; $com2&quot;}
    if {$ro} {proc ::$txt {args} &quot;  if {!\[winfo exists $txt\]} {return 0} ;  switch -exact -- \[lindex \$args 0\] \{  insert \{$com2\}  delete \{$com2\}  replace \{$com2\}  default \{ return \[eval $newcom \$args\] \}  \}&quot;
    } else {proc ::$txt {args} &quot;  if {!\[winfo exists $txt\]} {return 0} ;  switch -exact -- \[lindex \$args 0\] \{  delete \{$com {*}\$args\}  insert \{$com {*}\$args\}  replace \{$com {*}\$args\}  \} ;  set _res_ \[eval $newcom \$args\] ;  return \$_res_&quot;
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::hl_text'>hl_text</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights Tcl code of a text widget.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_text</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_hl_text' href="javascript:toggleSource('hl_tcl_hl_text')">Show source</a></p>
<div id='hl_tcl_hl_text' class='ruff_dyn_src'><pre>proc ::hl_tcl::hl_text {txt} {
    # Highlights Tcl code of a text widget.
    #   txt - text widget's path

    set font0 $::hl_tcl::my::data(FONT,$txt)
    set font1 [set font2 $font0]
    $txt tag configure tagSTD -font &quot;$font0&quot;
    $txt tag add tagSTD 1.0 end
    dict set font1 -weight bold
    dict set font2 -slant italic
    lassign $::hl_tcl::my::data(COLORS,$txt)  clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT clrBRA clrCURL clrCMN2
    $txt tag configure tagCOM -font &quot;$font1&quot; -foreground $clrCOM
    $txt tag configure tagCOMTK -font &quot;$font1&quot; -foreground $clrCOMTK
    $txt tag configure tagSTR -font &quot;$font0&quot; -foreground $clrSTR
    $txt tag configure tagVAR -font &quot;$font0&quot; -foreground $clrVAR
    $txt tag configure tagCMN -font &quot;$font2&quot; -foreground $clrCMN
    $txt tag configure tagCMN2 -font &quot;$font2&quot; -foreground $clrCMN2 ;#red
    $txt tag configure tagPROC -font &quot;$font1&quot; -foreground $clrPROC
    $txt tag configure tagOPT -font &quot;$font0&quot; -foreground $clrOPT
    $txt tag configure tagBRACKET -font &quot;$font0&quot; -foreground $clrBRA
    $txt tag configure tagBRACKETERR -font &quot;$font0&quot; -foreground white -background red
    $txt tag configure tagCURLINE -background $clrCURL
    $txt tag raise sel
    $txt tag raise tagBRACKETERR
    catch {$txt tag raise hilited;  $txt tag raise hilited2} ;# for apave package
    my::HighlightAll $txt
    if {![info exists ::hl_tcl::my::data(BIND_TXT,$txt)] ||
    [info exists ::hl_tcl::my::data(DOBIND,$txt)] &amp;&amp; $::hl_tcl::my::data(DOBIND,$txt)} {
      my::BindToEvent $txt &lt;FocusIn&gt; ::hl_tcl::my::MemPos $txt
      my::BindToEvent $txt &lt;KeyPress&gt; ::hl_tcl::my::MemPos1 $txt yes %K %s
      my::BindToEvent $txt &lt;KeyRelease&gt; ::hl_tcl::my::MemPos $txt
      my::BindToEvent $txt &lt;ButtonRelease-1&gt; ::hl_tcl::my::MemPos $txt
      foreach ev {Enter KeyRelease ButtonRelease-1} {
        my::BindToEvent $txt &lt;$ev&gt; ::hl_tcl::my::HighlightBrackets $txt
      }
      set ::hl_tcl::my::data(BIND_TXT,$txt) yes
    }
    set ro $::hl_tcl::my::data(READONLY,$txt)
    set com2 $::hl_tcl::my::data(CMD,$txt)
    set txtattrs [list $txt $ro $com2]
    if {![info exists ::hl_tcl::my::data(LIST_TXT)] ||  [set i [lsearch -index 0 -exact $::hl_tcl::my::data(LIST_TXT) $txt]]==-1} {
      lappend ::hl_tcl::my::data(LIST_TXT) $txtattrs
    } else {
      set ::hl_tcl::my::data(LIST_TXT) [lreplace $::hl_tcl::my::data(LIST_TXT) $i $i $txtattrs]
    }
    hl_readonly $txt $ro $com2
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::iscurline'>iscurline</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Sets / gets &quot;highlight a current line&quot; flag for a text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>iscurline</span> <span class='ruff_arg'>txt ?flag?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>the text's path</td></tr>
<tr><td class='ruff_defitem'><code>flag</code></td><td class='ruff_defitem'>the flag Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_iscurline' href="javascript:toggleSource('hl_tcl_iscurline')">Show source</a></p>
<div id='hl_tcl_iscurline' class='ruff_dyn_src'><pre>proc ::hl_tcl::iscurline {txt {flag {}}} {
    # Sets / gets &quot;highlight a current line&quot; flag for a text.
    #   txt - the text's path
    #   flag - the flag

    return [my::IsCurline $txt $flag]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::isdone'>isdone</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if the highlighting of the text is done.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>isdone</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_isdone' href="javascript:toggleSource('hl_tcl_isdone')">Show source</a></p>
<div id='hl_tcl_isdone' class='ruff_dyn_src'><pre>proc ::hl_tcl::isdone {txt} {
    # Checks if the highlighting of the text is done.
    #   txt - text's path

    variable my::data
    return [expr {[info exist my::data(REG_TXT,$txt)] &amp;&amp; $my::data(REG_TXT,$txt) ne {}}]
}</pre></div>
</div><h1 class='ruff'><a name='::hl_tcl::my'></a>::hl_tcl::my<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <code>::hl_tcl::my</code> namespace contains procedures for the &quot;internal&quot; usage by <em>hl_tcl</em> package.</p>
<p class='ruff'>All of them are upper-cased, in contrast with the UI procedures of <code>hl_tcl</code> namespace.</p>
<h2 class='ruff'><a name='::hl_tcl::my-Commands'></a>Commands<span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h4 class='ruffproc'><a name='::hl_tcl::my::AuxEnding'>AuxEnding</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Auxiliary procedure to process the ending comments in the line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>AuxEnding</span> <span class='ruff_arg'>kName lineName iName</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>kName</code></td><td class='ruff_defitem'>variable's name for 'k'</td></tr>
<tr><td class='ruff_defitem'><code>lineName</code></td><td class='ruff_defitem'>variable's name for 'line'</td></tr>
<tr><td class='ruff_defitem'><code>iName</code></td><td class='ruff_defitem'>variable's name for 'i'</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::HighlightLine" title="HighlightLine" class='ruff_cmd'>HighlightLine</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_AuxEnding' href="javascript:toggleSource('hl_tcl_my_AuxEnding')">Show source</a></p>
<div id='hl_tcl_my_AuxEnding' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::AuxEnding {kName lineName iName} {
    # Auxiliary procedure to process the ending comments in the line.
    #   kName - variable's name for 'k'
    #   lineName - variable's name for 'line'
    #   iName - variable's name for 'i'
    # See also: HighlightLine

    upvar 1 $kName k $lineName line $iName i
    if {[set k [string first # $line $i]]&gt;-1 &amp;&amp;  [string index [string trimleft $line] 0] eq {#}} {
      return 1
    }
    # not found a full line comment =&gt; try to find &quot;good&quot; ending comments i.e. &quot;;# ...&quot;
    # at that even proper comments like
    #   if {cond} { #...
    #   }
    # are skipped as &quot;bad&quot;
    set k [lindex [regexp -inline -indices {;\s*#} [string range $line $i end]] 0 0]
    if {$k eq {}} {
      set k -1
      return 0
    }
    set k [expr {$k+$i+1}]
    return 1
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::BindToEvent'>BindToEvent</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Binds an event on a widget to a command.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>BindToEvent</span> <span class='ruff_arg'>w event ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>w</code></td><td class='ruff_defitem'>the widget's path</td></tr>
<tr><td class='ruff_defitem'><code>event</code></td><td class='ruff_defitem'>the event</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>the command</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_BindToEvent' href="javascript:toggleSource('hl_tcl_my_BindToEvent')">Show source</a></p>
<div id='hl_tcl_my_BindToEvent' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::BindToEvent {w event args} {
    # Binds an event on a widget to a command.
    #   w - the widget's path
    #   event - the event
    #   args - the command

    if {[string first $args [bind $w $event]]&lt;0} {
      bind $w $event [list + {*}$args]
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::CoroHighlightAll'>CoroHighlightAll</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights all of a text as a coroutine.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroHighlightAll</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::HighlightAll" title="HighlightAll" class='ruff_cmd'>HighlightAll</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_CoroHighlightAll' href="javascript:toggleSource('hl_tcl_my_CoroHighlightAll')">Show source</a></p>
<div id='hl_tcl_my_CoroHighlightAll' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::CoroHighlightAll {txt} {
    # Highlights all of a text as a coroutine.
    #   txt - text widget's path
    # See also: HighlightAll

    variable data
    catch {  ;# $txt may be destroyed, so catch this
      if {!$data(PLAINTEXT,$txt)} {
        set tlen [lindex [split [$txt index end] .] 0]
        RemoveTags $txt 1.0 end
        set maxl [expr {min($data(SEEN,$txt),$tlen)}]
        set maxl [expr {min($data(SEEN,$txt),$tlen)}]
        for {set currQtd [set ln [set lnseen 0]]} {$ln&lt;$tlen} {} {
          incr ln
          set currQtd [HighlightLine $txt $ln $currQtd]
          if {[incr lnseen]&gt;$data(SEEN,$txt)} {
            set lnseen 0
            after idle after 1 [info coroutine]
            yield
          }
        }
      }
    }
    set data(REG_TXT,$txt) {1}
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::CoroModified'>CoroModified</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Handles modifications of text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroModified</span> <span class='ruff_arg'>txt ?i1? ?i2? ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>i1</code></td><td class='ruff_defitem'>1st index of changes Optional, default <code>-1</code>.</td></tr>
<tr><td class='ruff_defitem'><code>i2</code></td><td class='ruff_defitem'>2nd index of changes Optional, default <code>-1</code>.</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>arguments for a command called after the modifications</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::Modified" title="Modified" class='ruff_cmd'>Modified</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_CoroModified' href="javascript:toggleSource('hl_tcl_my_CoroModified')">Show source</a></p>
<div id='hl_tcl_my_CoroModified' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::CoroModified {txt {i1 -1} {i2 -1} args} {
    # Handles modifications of text.
    #   txt - text widget's path
    #   i1 - 1st index of changes
    #   i2 - 2nd index of changes
    #   args - arguments for a command called after the modifications
    # See also: Modified

    catch {
      variable data
      # current line:
      set ln [expr {int([$txt index insert])}]
      # ending line:
      set endl [expr {int([$txt index {end -1 char}])}]
      # range of change:
      if {$i1!=-1} {
        set dl [expr {abs($i2-$i1)}]
        set ln $i1
      } else {
        set dl [expr {abs(int($data(CUR_LEN,$txt)) - $endl)}]
      }
      # begin and end of changes:
      set ln1 [set lno1 [expr {max(($ln-$dl),1)}]]
      set ln2 [set lno2 [expr {min(($ln+$dl),$endl)}]]
      lassign [CountQSH $txt $ln] cntq cnts ccmnt
      # flag &quot;highlight to the end&quot;:
      set bf1 [expr {abs($ln-int($data(CURPOS,$txt)))&gt;1 || $dl&gt;1  || $cntq!=$data(CNT_QUOTE,$txt)  || $ccmnt!=$data(CNT_COMMENT,$txt)}]
      set bf2 [expr {$cnts!=$data(CNT_SLASH,$txt)}]
      if {$bf1 &amp;&amp; !$data(MULTILINE,$txt) || $bf2} {
        set lnt1 $ln
        set lnt2 [expr {$ln+1}]
        while {$ln2&lt;$endl &amp;&amp; $lnt1&lt;$endl &amp;&amp; $lnt2&lt;=$endl &amp;&amp; (  [$txt get &quot;$lnt1.end -1 char&quot; $lnt1.end] in {\\ \&quot;} ||
        [$txt get &quot;$lnt2.end -1 char&quot; $lnt2.end] in {\\ \&quot;}) || $bf2} {
          incr lnt1 ;# next lines be handled too, if ended with &quot;\\&quot;
          incr lnt2
          incr ln2
          set bf2 0
        }
      }
      set tSTR [$txt tag ranges tagSTR]
      set tCMN [$txt tag ranges tagCMN]
      lappend tCMN {*}[$txt tag ranges tagCMN2]
      if {$ln1==1} {
        set currQtd 0
      } else {
        set currQtd [LineState $txt $tSTR $tCMN &quot;$ln1.0 -1 chars&quot;]
      }
      $txt tag add tagSTD $ln1.0 $ln2.end
      if {!$data(PLAINTEXT,$txt)} {
        set lnseen 0
        while {$ln1&lt;=$ln2} {
          if {$ln1==$ln2} {
            set bf2 [LineState $txt $tSTR $tCMN &quot;$ln1.end +1 chars&quot;]
          }
          RemoveTags $txt $ln1.0 $ln1.end
          set currQtd [HighlightLine $txt $ln1 $currQtd]
          if {$ln1==$ln2 &amp;&amp; ($bf1 || $bf2!=$currQtd) &amp;&amp; $data(MULTILINE,$txt)} {
            set ln2 $endl  ;# run to the end
          }
          if {[incr lnseen]&gt;$data(SEEN,$txt)} {
            set lnseen 0
            catch {after cancel $data(COROATFER,$txt)}
            set data(COROATFER,$txt) [after idle after 1 [info coroutine]]
            yield
          }
          incr ln1
        }
      }
      if {[set cmd $data(CMD,$txt)] ne {}} {
        # run a command after changes done (its arguments are txt, ln1, ln2)
        append cmd { } $txt { } $lno1 { } $lno2 { } $args
        after idle $cmd
      }
      MemPos $txt
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::CoroRun'>CoroRun</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroRun</span> <span class='ruff_arg'>txt pos1 pos2 ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>pos1</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>pos2</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_CoroRun' href="javascript:toggleSource('hl_tcl_my_CoroRun')">Show source</a></p>
<div id='hl_tcl_my_CoroRun' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::CoroRun {txt pos1 pos2 args} {
    variable data
    if {![info exist data(REG_TXT,$txt)] || $data(REG_TXT,$txt) eq {} ||  ![info exist data(CUR_LEN,$txt)]} {
      # skip changes till the highlighting done
      after 10 [list ::hl_tcl::my::RunCoroAfterIdle $txt $pos1 $pos2 yes {*}$args]
      return
    }
    # let them work one by one
    set i1 [expr {int($pos1)}]
    set i2 [expr {int($pos2)}]
    set coroNo [expr {[incr data(CORMOD)] % 10000000}]
    coroutine CoModified$coroNo ::hl_tcl::my::CoroModified $txt $i1 $i2 {*}$args
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::CountChar'>CountChar</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Counts a character in a string.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CountChar</span> <span class='ruff_arg'>str ch ?plistName? ?escaped?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>str</code></td><td class='ruff_defitem'>the string</td></tr>
<tr><td class='ruff_defitem'><code>ch</code></td><td class='ruff_defitem'>the character</td></tr>
<tr><td class='ruff_defitem'><code>plistName</code></td><td class='ruff_defitem'>variable name for a list of positions of <em>ch</em> Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>escaped</code></td><td class='ruff_defitem'>true, if the character is escaped. Optional, default <code>yes</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a number of any occurences of character <em>ch</em> in string <em>str</em> if the character is escaped, but if it is not escaped, only non-escaped characters are counted.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_CountChar' href="javascript:toggleSource('hl_tcl_my_CountChar')">Show source</a></p>
<div id='hl_tcl_my_CountChar' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::CountChar {str ch {plistName {}} {escaped yes}} {
    # Counts a character in a string.
    #   str - the string
    #   ch - the character
    #   plistName - variable name for a list of positions of *ch*
    #   escaped - true, if the character is escaped.
    # Returns a number of any occurences of character *ch* in string *str*
    # if the character is escaped, but if it is not escaped, only non-escaped
    # characters are counted.

    if {$plistName ne {}} {
      upvar 1 $plistName plist
      set plist [list]
    }
    set icnt [set begidx 0]
    while {[set idx [string first $ch $str]] &gt;= 0} {
      set nidx $idx
      if {$escaped || ![Escaped $str $idx]} {
        incr icnt
        if {$plistName ne {}} {lappend plist [expr {$begidx+$idx}]}
      }
      incr begidx [incr idx]
      set str [string range $str $idx end]
    }
    return $icnt
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::CountQSH'>CountQSH</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Counts quotes, slashes, hashes in a line</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CountQSH</span> <span class='ruff_arg'>txt ln</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>ln</code></td><td class='ruff_defitem'>line's index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_CountQSH' href="javascript:toggleSource('hl_tcl_my_CountQSH')">Show source</a></p>
<div id='hl_tcl_my_CountQSH' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::CountQSH {txt ln} {
    # Counts quotes, slashes, hashes in a line
    #   txt - text widget's path
    #   ln - line's index

    set ln [expr {int($ln)}]
    set st [$txt get $ln.0 $ln.end]
    return [list [CountChar $st \&quot;] [CountChar $st \\] [CountChar $st #]]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::Escaped'>Escaped</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a character is escaped in a string.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Escaped</span> <span class='ruff_arg'>line curpos</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>line</code></td><td class='ruff_defitem'>the string</td></tr>
<tr><td class='ruff_defitem'><code>curpos</code></td><td class='ruff_defitem'>position of the character in the line</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns 1 if the character is escaped in the string.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_Escaped' href="javascript:toggleSource('hl_tcl_my_Escaped')">Show source</a></p>
<div id='hl_tcl_my_Escaped' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::Escaped {line curpos} {
    # Checks if a character is escaped in a string.
    #   line - the string
    #   curpos - position of the character in the line
    # Returns 1 if the character is escaped in the string.

    set line [string range $line 0 $curpos-1]
    set linetrim [string trimright $line \\]
    return [expr {([string length $line]-[string length $linetrim])%2}]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::FirstQtd'>FirstQtd</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Searches the quote characters in line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>FirstQtd</span> <span class='ruff_arg'>lineName iName currQtd</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>lineName</code></td><td class='ruff_defitem'>variable's name for 'line'</td></tr>
<tr><td class='ruff_defitem'><code>iName</code></td><td class='ruff_defitem'>variable's name for 'i'</td></tr>
<tr><td class='ruff_defitem'><code>currQtd</code></td><td class='ruff_defitem'>yes, if searching inside the quoted</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns &quot;yes&quot; if a quote character was found.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_FirstQtd' href="javascript:toggleSource('hl_tcl_my_FirstQtd')">Show source</a></p>
<div id='hl_tcl_my_FirstQtd' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::FirstQtd {lineName iName currQtd} {
    # Searches the quote characters in line.
    #   lineName - variable's name for 'line'
    #   iName - variable's name for 'i'
    #   currQtd - yes, if searching inside the quoted
    # Returns &quot;yes&quot; if a quote character was found.

    variable data
    upvar 1 $lineName line $iName i
    while {1} {
      if {[set i [string first \&quot; $line $i]]==-1} {return no}
      if {[NotEscaped $line $i]} {
        if {$currQtd||$i==0} {return yes}
        set i1 [expr {$i-1}]
        set i2 [expr {$i+1}]
        if {[NotEscaped $line $i1]} {
          set c1 [string index $line $i1]  ;# check the string ends
          set c2 [string index $line $i2]
          # not needed: $c1 in $data(S_BOTH) &amp;&amp; $c2 ni $data(S_BOTH) ||
          if {$c1 in $data(S_LEFT) &amp;&amp; $c2 ni $data(S_RIGHT)
          || $c1 ni $data(S_LEFT) &amp;&amp; $c2 in $data(S_RIGHT)} {
            return yes
          }
          # last reverence: for braced expression
          set i1 $i
          while {$i1&gt;0} {
            set c1 [string index $line $i1-1]
            set c2 [string index $line $i1]
            if {$c1 in $data(S_SPACE)} {return [expr { $c2 ne &quot;\{&quot; }]}
            incr i1 -1
          }
          return no
        }
        return yes
      }
      incr i
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightAll'>HighlightAll</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights all of a text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightAll</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Makes a coroutine from this.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::CoroHighlightAll" title="CoroHighlightAll" class='ruff_cmd'>CoroHighlightAll</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightAll' href="javascript:toggleSource('hl_tcl_my_HighlightAll')">Show source</a></p>
<div id='hl_tcl_my_HighlightAll' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightAll {txt} {
    # Highlights all of a text.
    #   txt - text widget's path
    # Makes a coroutine from this.
    # See also: CoroHighlightAll

    # let them work one by one:
    set coroNo [expr {[incr ::hl_tcl::my::data(CORALL)] % 10000000}]
    coroutine co_HlAll$coroNo ::hl_tcl::my::CoroHighlightAll $txt
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightBrackets'>HighlightBrackets</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights matching brackets if any.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightBrackets</span> <span class='ruff_arg'>w</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>w</code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightBrackets' href="javascript:toggleSource('hl_tcl_my_HighlightBrackets')">Show source</a></p>
<div id='hl_tcl_my_HighlightBrackets' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightBrackets {w} {
    # Highlights matching brackets if any.
    #   w - text widget's path

    variable data
    set curpos [ShowCurrentLine $w]
    set curpos2 [$w index {insert -1 chars}]
    set ch [$w get $curpos]
    set il [string first $ch $data(LBR)]
    set ir [string first $ch $data(RBR)]
    set txt [split [$w get 1.0 end] \n]
    if {$il&gt;-1} {
      set brcpos [MatchedBrackets $w $txt $curpos  [string index $data(LBR) $il] [string index $data(RBR) $il] 1]
    } elseif {$ir&gt;-1} {
      set brcpos [MatchedBrackets $w $txt $curpos  [string index $data(RBR) $ir] [string index $data(LBR) $ir] -1]
    } elseif {[set il [string first [$w get $curpos2] $data(LBR)]]&gt;-1} {
      set curpos $curpos2
      set brcpos [MatchedBrackets $w $txt $curpos  [string index $data(LBR) $il] [string index $data(RBR) $il] 1]
    } elseif {[set ir [string first [$w get $curpos2] $data(RBR)]]&gt;-1} {
      set curpos $curpos2
      set brcpos [MatchedBrackets $w $txt $curpos  [string index $data(RBR) $ir] [string index $data(LBR) $ir] -1]
    } else {
      return
    }
    if {$brcpos ne {}} {
      $w tag add tagBRACKET $brcpos
      $w tag add tagBRACKET $curpos
    } else {
      $w tag add tagBRACKETERR $curpos
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightCmd'>HighlightCmd</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights Tcl/Tk commands.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightCmd</span> <span class='ruff_arg'>txt line ln pri i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>line</code></td><td class='ruff_defitem'>line to be highlighted</td></tr>
<tr><td class='ruff_defitem'><code>ln</code></td><td class='ruff_defitem'>line number</td></tr>
<tr><td class='ruff_defitem'><code>pri</code></td><td class='ruff_defitem'>column number to highlighted from</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>current position in 'line'</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightCmd' href="javascript:toggleSource('hl_tcl_my_HighlightCmd')">Show source</a></p>
<div id='hl_tcl_my_HighlightCmd' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightCmd {txt line ln pri i} {
    # Highlights Tcl/Tk commands.
    #   txt - text widget's path
    #   line - line to be highlighted
    #   ln - line number
    #   pri - column number to highlighted from
    #   i - current position in 'line'

    variable data
    $txt tag add tagSTD &quot;$ln.$pri&quot; &quot;$ln.$i +1 chars&quot;
    if {$pri} {
      incr pri -1
      set RE $data(RE1)
    } else {
      set RE $data(RE0)
    }
    set st [string range $line $pri $i-1]
    set lcom [regexp -inline -all -indices $RE $st]
    # commands
    foreach {- - lc -} $lcom {
      lassign $lc i1 i2
      set c [string trim [string range $st $i1 $i2] &quot;\{\}\[;\t &quot;]
      set ik [expr {$i2-$i1+1-[string length $c]}]
      if {$c ne {}} {
        incr i1 $ik
        incr i2
        if {[lsearch -exact -sorted $data(CMD_TCL) $c]&gt;-1} {
          $txt tag add tagCOM &quot;$ln.$pri +$i1 char&quot; &quot;$ln.$pri +$i2 char&quot;
        } elseif {[lsearch -exact -sorted $data(PROC_TCL) $c]&gt;-1} {
          if {$c eq {namespace} &amp;&amp;
          ![regexp {^namespace[\s]+eval([\s]|$)+} [string range $st $i1 end]]} {
            set tag tagCOM ;# let &quot;namespace eval&quot; only be highlighted as proc/return
          } else {
            set tag tagPROC
          }
          $txt tag add $tag &quot;$ln.$pri +$i1 char&quot; &quot;$ln.$pri +$i2 char&quot;
        } elseif {[lsearch -exact -sorted $data(CMD_TK_EXP) $c]&gt;-1} {
          $txt tag add tagCOMTK &quot;$ln.$pri +$i1 char&quot; &quot;$ln.$pri +$i2 char&quot;
        }
      }
    }
    # $variables:
    set dlist [list]
    set slen [expr {[string length $st]-1}]
    set cnt [CountChar $st \$ dlist no]
    foreach dl $dlist {
      if { [string index $st $dl+1] eq &quot;\{&quot; } {
        if {[set br2 [string first \} $st $dl+2]]!=-1} {
          $txt tag add tagVAR &quot;$ln.$pri +$dl char&quot; &quot;$ln.$pri +[incr br2] char&quot;
        }
        continue
      }
      for {set i [set dl2 $dl]} {$i&lt;$slen} {} {
        incr i
        set ch [string index $st $i]
        if {[string is wordchar $ch] || $ch eq {:}} {
          set dl2 $i
          continue
        } elseif {$ch eq {(}} {
          if {[set br2 [string first {)} $st $i+1]]&gt;-1} {
            set dl2 $br2
          }
        }
        break
      }
      if {$dl2&gt;$dl} {
        $txt tag add tagVAR &quot;$ln.$pri +$dl char&quot; &quot;$ln.$pri +[incr dl2] char&quot;
      }
    }
    # -options
    set dl -1
    while {[set dl [string first - $st [incr dl]]]&gt;-1} {
      if {[string index $st $dl-1] ni $data(S_SPACE2)} continue
      set idx1 &quot;$ln.$pri +$dl char&quot;
      if {[string index $st $dl+1] eq {-}} {
        incr dl ;# for --longoption
      }
      set i $dl
      set ch [string index $st $i+1]
      if {![string is alpha -strict $ch]} { ;# || ![string is ascii -strict $ch]
        continue ;# first, a Latin letter
      }
      set dl2 -1
      while {$i&lt;$slen} {
        incr i
        set ch [string index $st $i]
        if {![string is wordchar $ch] &amp;&amp; $ch ne {-}} break
        set dl2 $i
      }
      if {$dl2&gt;-1} {
        $txt tag add tagOPT $idx1 &quot;$ln.$pri +[incr dl2] char&quot;
        set dl $dl2
      }
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightComment'>HighlightComment</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights comments.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightComment</span> <span class='ruff_arg'>txt line ln k</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>line</code></td><td class='ruff_defitem'>current line</td></tr>
<tr><td class='ruff_defitem'><code>ln</code></td><td class='ruff_defitem'>line's number</td></tr>
<tr><td class='ruff_defitem'><code>k</code></td><td class='ruff_defitem'>comment's starting position in line</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightComment' href="javascript:toggleSource('hl_tcl_my_HighlightComment')">Show source</a></p>
<div id='hl_tcl_my_HighlightComment' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightComment {txt line ln k} {
    # Highlights comments.
    #   txt - text widget's path
    #   line - current line
    #   ln - line's number
    #   k - comment's starting position in line

    variable data
    set stcom [string range $line $k end]
    if {[regexp $data(RETODO) $stcom]} {
      $txt tag add tagCMN2 $ln.$k $ln.end  ;# &quot;!&quot; and TODO comments
    } else {
      $txt tag add tagCMN $ln.$k $ln.end
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightLine'>HighlightLine</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights a line in text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightLine</span> <span class='ruff_arg'>txt ln prevQtd</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>ln</code></td><td class='ruff_defitem'>line's number</td></tr>
<tr><td class='ruff_defitem'><code>prevQtd</code></td><td class='ruff_defitem'>flag of &quot;being quoted&quot; from the previous line</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightLine' href="javascript:toggleSource('hl_tcl_my_HighlightLine')">Show source</a></p>
<div id='hl_tcl_my_HighlightLine' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightLine {txt ln prevQtd} {
    # Highlights a line in text.
    #   txt - text widget's path
    #   ln - line's number
    #   prevQtd - flag of &quot;being quoted&quot; from the previous line

    variable data
    if {$data(ISPLAINCOM,$txt)} {
      # plain highlighting: for the current line
      set res [{*}$data(PLAINCOM,$txt) $txt $ln $prevQtd]
      if {$res in {-1 0 1}} {
        return $res ;# to be continued in a next line with prevQtd
      }
      # if the line was highlighted okay, skip the highlighting as Tcl code
      if {$res} {return 0}
      # otherwise highlight it below as Tcl code
    }
    set line [$txt get $ln.0 $ln.end]
    if {$prevQtd==-1} {  ;# comments continued
      HighlightComment $txt $line $ln 0
      if {[string index $line end] ne &quot;\\&quot;} {set prevQtd 0}
      return $prevQtd
    }
    set currQtd $prevQtd  ;# current state of being quoted
    set i [set pri [set lasti 0]]
    set k -1
    while {1} {
      if {![FirstQtd line i $currQtd]} break
      set lasti $i
      if {$currQtd} {
        HighlightStr $txt $ln.$pri &quot;$ln.$i +1 char&quot;
        set currQtd 0
        incr lasti
        if {[AuxEnding j line lasti]} {
          set i $lasti
          set st [string range $line $i $j]
          set it 0
          if {[FirstQtd st it $currQtd]} continue  ;# there is a quote yet
          set k $j
          break
        }
      } else {
        if {[AuxEnding j line pri] &amp;&amp; $j&lt;$i} {
          set lasti $pri
          set k $j
          break
        }
        HighlightCmd $txt $line $ln $pri $i
        set currQtd 1
      }
      set pri $i
      incr i
    }
    if {$currQtd} {
      HighlightStr $txt $ln.$pri $ln.end
    } elseif {$k&gt;-1 || [AuxEnding k line lasti]} {
      HighlightCmd $txt $line $ln $lasti $k
      HighlightComment $txt $line $ln $k
      if {[string index $line end] eq &quot;\\&quot;} {set currQtd -1}
    } else {
      HighlightCmd $txt $line $ln $lasti [string length $line]
    }
    if {!$data(MULTILINE,$txt) &amp;&amp; $currQtd &amp;&amp; [string index $line end] ne &quot;\\&quot;} {
      set currQtd 0
    }
    return $currQtd
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightStr'>HighlightStr</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights strings.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightStr</span> <span class='ruff_arg'>txt p1 p2</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>p1</code></td><td class='ruff_defitem'>starting index of the string in 'txt'</td></tr>
<tr><td class='ruff_defitem'><code>p2</code></td><td class='ruff_defitem'>ending index of the string in 'txt'</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_HighlightStr' href="javascript:toggleSource('hl_tcl_my_HighlightStr')">Show source</a></p>
<div id='hl_tcl_my_HighlightStr' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::HighlightStr {txt p1 p2} {
    # Highlights strings.
    #   txt - text widget's path
    #   p1 - starting index of the string in 'txt'
    #   p2 - ending index of the string in 'txt'

    variable data
    set p1 [$txt index $p1]
    set p2 [$txt index $p2]
    $txt tag add tagSTR $p1 $p2
    set st [$txt get $p1 $p2]
    set lcom [regexp -inline -all -indices $data(RE5) $st]
    foreach {lc g1 g2} $lcom {
      lassign $lc i1 i2
      incr i2
      while {$i1&lt;$i2} {
        incr i1
        if {[string first [string index $st $i1] &quot;\[\]\$\{\}&quot;]&gt;-1} {
          set i12 [expr {$i1+1}]
          $txt tag add tagVAR &quot;$p1 +$i1 char&quot; &quot;$p1 +$i12 char&quot;
        }
      }
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::InRange'>InRange</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a text position is in a range of text positions.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>InRange</span> <span class='ruff_arg'>p1 p2 l ?c?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>p1</code></td><td class='ruff_defitem'>1st position of range</td></tr>
<tr><td class='ruff_defitem'><code>p2</code></td><td class='ruff_defitem'>2nd position of range</td></tr>
<tr><td class='ruff_defitem'><code>l</code></td><td class='ruff_defitem'>line position to check (or 'l.c' if 'c' not set)</td></tr>
<tr><td class='ruff_defitem'><code>c</code></td><td class='ruff_defitem'>column position to check Optional, default <code>-1</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_InRange' href="javascript:toggleSource('hl_tcl_my_InRange')">Show source</a></p>
<div id='hl_tcl_my_InRange' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::InRange {p1 p2 l {c -1}} {
    # Checks if a text position is in a range of text positions.
    #   p1 - 1st position of range
    #   p2 - 2nd position of range
    #   l - line position to check (or 'l.c' if 'c' not set)
    #   c - column position to check

    if {$c==-1} {lassign [split $l .] l c}
    lassign [split $p1 .] l1 c1
    lassign [split $p2 .] l2 c2
    incr c2 -1 ;# text ranges are not right-inclusive
    return [expr {  ($l&gt;=$l1 &amp;&amp; $l&lt;$l2 &amp;&amp; $c&gt;=$c1) || ($l&gt;$l1 &amp;&amp; $l&lt;=$l2 &amp;&amp; $c&lt;=$c2) ||
      ($l==$l1 &amp;&amp; $l1==$l2 &amp;&amp; $c&gt;=$c1 &amp;&amp; $c&lt;=$c2) || ($l&gt;$l1 &amp;&amp; $l&lt;$l2)}]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::IsCurline'>IsCurline</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Sets / gets &quot;highlight a current line&quot; flag for a text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>IsCurline</span> <span class='ruff_arg'>txt ?flag?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>the text's path</td></tr>
<tr><td class='ruff_defitem'><code>flag</code></td><td class='ruff_defitem'>the flag Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_IsCurline' href="javascript:toggleSource('hl_tcl_my_IsCurline')">Show source</a></p>
<div id='hl_tcl_my_IsCurline' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::IsCurline {txt {flag {}}} {
    # Sets / gets &quot;highlight a current line&quot; flag for a text.
    #   txt - the text's path
    #   flag - the flag

    variable data
    if {$flag eq {}} {return $data(HL_CURLINE,$txt)}
    set data(HL_CURLINE,$txt) $flag
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::LineState'>LineState</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets an initial state of line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>LineState</span> <span class='ruff_arg'>txt tSTR tCMN l1</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>tSTR</code></td><td class='ruff_defitem'>ranges of string tags</td></tr>
<tr><td class='ruff_defitem'><code>tCMN</code></td><td class='ruff_defitem'>ranges of comment tags</td></tr>
<tr><td class='ruff_defitem'><code>l1</code></td><td class='ruff_defitem'>the line's index</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Returns: 0 if no tags for the line; 1 if the line is a string's continuation; -1 if the line is a comment's continuation.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_LineState' href="javascript:toggleSource('hl_tcl_my_LineState')">Show source</a></p>
<div id='hl_tcl_my_LineState' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::LineState {txt tSTR tCMN l1} {
    # Gets an initial state of line.
    #   txt - text widget's path
    #   tSTR - ranges of string tags
    #   tCMN - ranges of comment tags
    #   l1 - the line's index
    # Returns: 0 if no tags for the line; 1 if the line is a string's continuation; -1 if the line is a comment's continuation.

    variable data
    set i1 [$txt index $l1]
    if {[set prev [string first -1 $l1]]&gt;-1} {
      set i1 [$txt index &quot;$i1 -1 chars&quot;]
    }
    set ch [$txt get &quot;$i1&quot; &quot;$i1 +1 chars&quot;]
    if {[SearchTag $tCMN [$txt index &quot;$i1 -1 chars&quot;]]!=-1} {  ;# is a comment continues?
      if {$ch eq &quot;\\&quot;} {return -1}
    } elseif {$data(MULTILINE,$txt) || $ch eq &quot;\\&quot;} {         ;# is a string continues?
      set nl [lindex [split $l1 .] 0]
      if {$prev&gt;-1} {
        # is the start of line quoted?
        # Tk tag ranges refer only to non-empty lines
        # =&gt; previous two non-empty chars' coordinates are needed
        # to analize whether they:
        # - end the range
        # - are inside of the range
        # - begin the range
        set co1 [set co2 {}]
        while {$nl&gt;1} {
          incr nl -1
          if {[set line [$txt get $nl.0 $nl.end]] ne {}} {
            if {$co2 eq {}} {
              set co2 [$txt index &quot;$nl.end -1 char&quot;]
              if {[string length $line]&gt;1} {
                set co1 [$txt index &quot;$nl.end -2 char&quot;]
                break
              }
            } else {
              set co1 [$txt index &quot;$nl.end -1 char&quot;]
              break
            }
          }
        }
        if {$co2 eq {}} {return 0}   {set f2 [expr {[SearchTag $tSTR $co2]!=-1}]}
        if {$co1 eq {}} {set f1 $f2} {set f1 [expr {[SearchTag $tSTR $co1]!=-1}]}
        set ch [$txt get $co2 &quot;$co2 +1 chars&quot;]
        set c [lindex [split [$txt index $co2] .] 1]
        if {![NotEscaped $line $c]} {set ch {}}
        return [expr {$ch ne {&quot;} &amp;&amp; $f2 || $ch eq {&quot;} &amp;&amp; !$f1}]
      }
      # is the end of line quoted?
      set line {}
      set nltot [lindex [split [$txt index end] .] 0]
      while {$nl&lt;$nltot} {
        incr nl
        if {[set line [$txt get $nl.0 $nl.end]] ne {}} break
      }
      set i1 $nl.0
      set ch [$txt get $i1 &quot;$i1 +1 chars&quot;]
      set c [lindex [split [$txt index $i1] .] 1]
      if {![NotEscaped $line $c]} {set ch {}}
      set f1 [expr {[SearchTag $tSTR [$txt index $i1]]!=-1}]
      set f2 [expr {[SearchTag $tSTR [$txt index &quot;$i1 +1 chars&quot;]]!=-1}]
      return [expr {$ch ne {&quot;} &amp;&amp; $f1 || $ch eq {&quot;} &amp;&amp; !$f2}]
    }
    return 0
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::MatchedBrackets'>MatchedBrackets</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Finds a match of characters (dchar for schar).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MatchedBrackets</span> <span class='ruff_arg'>w inplist curpos schar dchar dir</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>w</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>inplist</code></td><td class='ruff_defitem'>list of strings where to find a match</td></tr>
<tr><td class='ruff_defitem'><code>curpos</code></td><td class='ruff_defitem'>position of schar in nl.nc form where nl=1.., nc=0..</td></tr>
<tr><td class='ruff_defitem'><code>schar</code></td><td class='ruff_defitem'>source character</td></tr>
<tr><td class='ruff_defitem'><code>dchar</code></td><td class='ruff_defitem'>destination character</td></tr>
<tr><td class='ruff_defitem'><code>dir</code></td><td class='ruff_defitem'>search direction: 1 to the end, -1 to the beginning of list</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_MatchedBrackets' href="javascript:toggleSource('hl_tcl_my_MatchedBrackets')">Show source</a></p>
<div id='hl_tcl_my_MatchedBrackets' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::MatchedBrackets {w inplist curpos schar dchar dir} {
    # Finds a match of characters (dchar for schar).
    #   w - text widget's path
    #   inplist - list of strings where to find a match
    #   curpos - position of schar in nl.nc form where nl=1.., nc=0..
    #   schar - source character
    #   dchar - destination character
    #   dir - search direction: 1 to the end, -1 to the beginning of list

    lassign [split $curpos .] nl nc
    if {$schar eq {&quot;}} {
      set npos $nl.$nc
      set hlpr [$w tag prevrange tagSTR $npos]
      if {[llength $hlpr] &amp;&amp; [$w compare &quot;$npos +1 char&quot; == [lindex $hlpr 1]]} {
        set dir -1  ;# &lt;- quotes are scanned depending on their range (for tcl/c)
      } else {
        set hlpr [$w tag nextrange tagSTR $npos]
        if {![llength $hlpr] || [$w compare $npos != [lindex $hlpr 0]]} {
          # for plain texts:
          if {[$w search -exact \&quot; &quot;$npos +1 char&quot; end] eq {}} {
            set dir -1
          } else {
            set lfnd [$w search -backwards -all -exact \&quot; $npos 1.0]
            if {[llength $lfnd] % 2} {
              set dir -1
            }
          }
        }
      }
      incr nc $dir
    }
    set escaped [Escaped [lindex $inplist $nl-1] $nc]
    if {$dir==1} {set rng1 &quot;$nc end&quot;} else {set rng1 &quot;0 $nc&quot;; set nc 0}
    set retpos {}
    set scount [set dcount 0]
    incr nl -1
    set inplen [llength $inplist]
    while {$nl&gt;=0 &amp;&amp; $nl&lt;$inplen} {
      set line [lindex $inplist $nl]
      set line [string range $line {*}$rng1]
      set sc [CountChar $line $schar slist $escaped]
      set dc [CountChar $line $dchar dlist $escaped]
      set plen [llength [set plist [MergePosList -1 $slist $dlist]]]
      for {set i [expr {$dir&gt;0?0:($plen-1)}]} {$i&gt;=0 &amp;&amp; $i&lt;$plen} {incr i $dir} {
        lassign [lindex $plist $i] src pos
        if {$src} {incr dcount} {incr scount}
        if {$scount &lt;= $dcount} {
          set retpos [incr nl].[incr pos $nc]
          break
        }
      }
      if {$retpos ne {}} break
      set nc 0
      set rng1 {0 end}
      incr nl $dir
    }
    return $retpos
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::MemPos'>MemPos</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Remembers the state of current line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MemPos</span> <span class='ruff_arg'>txt ?doit?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>doit</code></td><td class='ruff_defitem'>argument for ShowCurrentLine Optional, default <code>no</code>.</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::ShowCurrentLine" title="ShowCurrentLine" class='ruff_cmd'>ShowCurrentLine</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_MemPos' href="javascript:toggleSource('hl_tcl_my_MemPos')">Show source</a></p>
<div id='hl_tcl_my_MemPos' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::MemPos {txt {doit no}} {
    # Remembers the state of current line.
    #   txt - text widget's path
    #   doit - argument for ShowCurrentLine
    # See also: ShowCurrentLine

    variable data
    set data(_INSPOS_,$txt) [MemPos1 $txt no]
    set ln [ShowCurrentLine $txt $doit]
    set data(CUR_LEN,$txt) [$txt index {end -1 char}]
    lassign [CountQSH $txt $ln]  data(CNT_QUOTE,$txt) data(CNT_SLASH,$txt) data(CNT_COMMENT,$txt)
    if {[$txt tag ranges tagBRACKET] ne {}}    {$txt tag remove tagBRACKET 1.0 end}
    if {[$txt tag ranges tagBRACKETERR] ne {}} {$txt tag remove tagBRACKETERR 1.0 end}
    if {[set cmd $data(CMDPOS,$txt)] ne {}} {
      # run a command after changing position (with the state as arguments)
      append cmd &quot; $txt $data(CUR_LEN,$txt) $ln $data(CNT_QUOTE,$txt)  $data(CNT_SLASH,$txt) $data(CNT_COMMENT,$txt)&quot;
      catch {after cancel $data(CMDATFER,$txt)}
      set data(CMDATFER,$txt) [after idle $cmd]
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::MemPos1'>MemPos1</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks and sets the cursor's width, depending on its position.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MemPos1</span> <span class='ruff_arg'>txt ?donorm? ?K? ?s?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>donorm</code></td><td class='ruff_defitem'>if yes, forces &quot;normal&quot; cursor Optional, default <code>yes</code>.</td></tr>
<tr><td class='ruff_defitem'><code>K</code></td><td class='ruff_defitem'>key (%K of bind) Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>s</code></td><td class='ruff_defitem'>state (%s of bind) Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>This fixes an issue with text cursor: less width at 0th column.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_MemPos1' href="javascript:toggleSource('hl_tcl_my_MemPos1')">Show source</a></p>
<div id='hl_tcl_my_MemPos1' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::MemPos1 {txt {donorm yes} {K {}} {s {}}} {
    # Checks and sets the cursor's width, depending on its position.
    #   txt - text widget's path
    #   donorm - if yes, forces &quot;normal&quot; cursor
    #   K - key (%K of bind)
    #   s - state (%s of bind)
    # This fixes an issue with text cursor: less width at 0th column.

    variable data
    if {$K eq {Home} &amp;&amp; [string is digit -strict $s] &amp;&amp;  [expr {$s &amp; 4}]==0 &amp;&amp; [expr {$s &amp; 1}]==0} {
      # Ctrl-Home &amp; Shift-Home are passed
      set p1 [$txt index insert]
      set line [$txt get &quot;$p1 linestart&quot; &quot;$p1 lineend&quot;]
      set p [expr {[string length $line]-[string length [string trimleft $line]]}]
      set p2 [expr {int($p1)}].$p
      if {$p &amp;&amp; $p2 ne $p1} {
        after idle &quot;::tk::TextSetCursor $txt $p2&quot;
        return 0
      }
    }
    if {$data(INSERTWIDTH,$txt)==1} {
      if {[$txt cget -insertwidth]!=1} {$txt configure -insertwidth 1}
      return 0
    }
    set insLC [$txt index insert]
    lassign [split $insLC .] L C
    if {$data(_INSPOS_,$txt) eq {}} {
      set L2 [set C2 0]
    } else {
      lassign [split $data(_INSPOS_,$txt) .] L2 C2
    }
    if {$L!=$L2 || $C==0 || $C2==0} {
      if {$C || $donorm} {
        $txt configure -insertwidth $data(INSERTWIDTH,$txt)
      } else {
        $txt configure -insertwidth [expr {$data(INSERTWIDTH,$txt)*2-1}]
      }
    }
    return $insLC
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::MergePosList'>MergePosList</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Merges lists of numbers that are not-coinciding and sorted.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MergePosList</span> <span class='ruff_arg'>none ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>none</code></td><td class='ruff_defitem'>a number to be not allowed in the lists (e.g. less than minimal)</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>list of the lists to be merged</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of pairs: index of list + item of list.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_MergePosList' href="javascript:toggleSource('hl_tcl_my_MergePosList')">Show source</a></p>
<div id='hl_tcl_my_MergePosList' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::MergePosList {none args} {
    # Merges lists of numbers that are not-coinciding and sorted.
    #   none - a number to be not allowed in the lists (e.g. less than minimal)
    #   args - list of the lists to be merged
    # Returns a list of pairs: index of list + item of list.

    set itot [set ilist 0]
    set lind [set lout [list]]
    foreach lst $args {
      incr ilist
      incr itot [set llen [llength $lst]]
      lappend lind [list 0 $llen]
    }
    for {set i 0} {$i&lt;$itot} {incr i} {
      set min $none
      set ind -1
      for {set k 0} {$k&lt;$ilist} {incr k} {
        lassign [lindex $lind $k] li llen
        if {$li &lt; $llen} {
          set e [lindex [lindex $args $k] $li]
          if {$min == $none || $min &gt; $e} {
            set ind $k
            set min $e
            set savli [incr li]
            set savlen $llen
          }
        }
      }
      if {$ind == -1} {return -code error {Error: probably in the input data}}
      lset lind $ind [list $savli $savlen]
      lappend lout [list $ind $min]
    }
    return $lout
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::Modified'>Modified</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Handles modifications of text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Modified</span> <span class='ruff_arg'>txt oper pos1 ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>oper</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>pos1</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Makes a coroutine from this.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::CoroModified" title="CoroModified" class='ruff_cmd'>CoroModified</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_Modified' href="javascript:toggleSource('hl_tcl_my_Modified')">Show source</a></p>
<div id='hl_tcl_my_Modified' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::Modified {txt oper pos1 args} {
    # Handles modifications of text.
    #   txt - text widget's path
    # Makes a coroutine from this.
    # See also: CoroModified

    variable data
    set ar2 [lindex $args 0]
    set posins [$txt index insert]
    if {[catch {set pos1 [set pos2 [$txt index $pos1]]}]} {
      set pos1 [set pos2 $posins]
    }
    switch $oper {
      insert {
        set pos2 [expr {$pos1 + [llength [split $ar2 \n]]}]
      }
      delete {
        if {$ar2 eq {} || [catch {set pos2 [$txt index $ar2]}]} {
          set pos2 $posins
        }
      }
    }
    RunCoroAfterIdle $txt $pos1 $pos2 no {*}$args
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::NotEscaped'>NotEscaped</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a character escaped in a line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>NotEscaped</span> <span class='ruff_arg'>line i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>line</code></td><td class='ruff_defitem'>line</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>the character's position in 'line'</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns &quot;1&quot; if the character not escaped.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_NotEscaped' href="javascript:toggleSource('hl_tcl_my_NotEscaped')">Show source</a></p>
<div id='hl_tcl_my_NotEscaped' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::NotEscaped {line i} {
    # Checks if a character escaped in a line.
    #   line - line
    #   i - the character's position in 'line'
    # Returns &quot;1&quot; if the character not escaped.

    set cntq 0
    while {$i&gt;0} {
      if {[string index $line [incr i -1]] ne &quot;\\&quot;} {
        return [expr {($cntq%2)==0}]
      }
      incr cntq
    }
    return [expr {($cntq%2)==0}]
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::RemoveTags'>RemoveTags</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Removes tags in text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>RemoveTags</span> <span class='ruff_arg'>txt from to</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>from</code></td><td class='ruff_defitem'>starting index</td></tr>
<tr><td class='ruff_defitem'><code>to</code></td><td class='ruff_defitem'>ending index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_RemoveTags' href="javascript:toggleSource('hl_tcl_my_RemoveTags')">Show source</a></p>
<div id='hl_tcl_my_RemoveTags' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::RemoveTags {txt from to} {
    # Removes tags in text.
    #   txt - text widget's path
    #   from - starting index
    #   to - ending index

    foreach tag {tagCOM tagCOMTK tagSTR tagVAR tagCMN tagCMN2 tagPROC tagOPT} {
      $txt tag remove $tag $from $to
    }
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::RunCoroAfterIdle'>RunCoroAfterIdle</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Runs a &quot;modified&quot; corotine after idle.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>RunCoroAfterIdle</span> <span class='ruff_arg'>txt pos1 pos2 wait ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>pos1</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>pos2</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>wait</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_RunCoroAfterIdle' href="javascript:toggleSource('hl_tcl_my_RunCoroAfterIdle')">Show source</a></p>
<div id='hl_tcl_my_RunCoroAfterIdle' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::RunCoroAfterIdle {txt pos1 pos2 wait args} {
    # Runs a &quot;modified&quot; corotine after idle.

    variable data
    if {$wait} {
      catch {
        after cancel $data(COROAFTER,$txt)
        if {$data(COROPOS1,$txt) &lt; $pos1} {set pos1 $data(COROPOS1,$txt)}
        if {$data(COROPOS2,$txt) &gt; $pos2} {set pos2 $data(COROPOS2,$txt)}
      }
      set data(COROPOS1,$txt) $pos1
      set data(COROPOS2,$txt) $pos2
    }
    set data(COROAFTER,$txt) [after idle &quot;::hl_tcl::my::CoroRun $txt $pos1 $pos2 $args&quot;]
    return
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::SearchTag'>SearchTag</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Searches a position in tag ranges.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>SearchTag</span> <span class='ruff_arg'>tagpos l1</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>tagpos</code></td><td class='ruff_defitem'>tag position ranges</td></tr>
<tr><td class='ruff_defitem'><code>l1</code></td><td class='ruff_defitem'>the position to find</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a found range's index of -1 if not found.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_SearchTag' href="javascript:toggleSource('hl_tcl_my_SearchTag')">Show source</a></p>
<div id='hl_tcl_my_SearchTag' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::SearchTag {tagpos l1} {
    # Searches a position in tag ranges.
    #   tagpos - tag position ranges
    #   l1 - the position to find
    # Returns a found range's index of -1 if not found.

    lassign [split $l1 .] l c
    set i 0
    foreach {p1 p2} $tagpos {
      if {[InRange $p1 $p2 $l $c]} {return $i}
      incr i 2
    }
    return -1
}</pre></div>
</div><h4 class='ruffproc'><a name='::hl_tcl::my::ShowCurrentLine'>ShowCurrentLine</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shows the current line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>ShowCurrentLine</span> <span class='ruff_arg'>txt ?doit?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>txt</code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code>doit</code></td><td class='ruff_defitem'>if yes, forces updating current line's background Optional, default <code>no</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a current position of cursor.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_hl_tcl_my_ShowCurrentLine' href="javascript:toggleSource('hl_tcl_my_ShowCurrentLine')">Show source</a></p>
<div id='hl_tcl_my_ShowCurrentLine' class='ruff_dyn_src'><pre>proc ::hl_tcl::my::ShowCurrentLine {txt {doit no}} {
    # Shows the current line.
    #   txt - text widget's path
    #   doit - if yes, forces updating current line's background
    # Returns a current position of cursor.

    variable data
    set pos [$txt index insert]
    set nlines [expr {int([$txt index end])}]
    lassign [split $pos .] ln cn
    if {[catch {lassign [split $data(CURPOS,$txt) .] ln2 cn2}]} {
      set ln2 $ln
      set cn2 $cn
      set data(CURPOS,$txt) [set data(NLINES,$txt) 0]
    }
    if {[IsCurline $txt]} {
      if {$doit || int($data(CURPOS,$txt))!=$ln || $data(NLINES,$txt)!=$nlines  || $ln!=$ln2 || abs($cn-$cn2)&gt;1 || $cn&lt;2} {
        $txt tag remove tagCURLINE 1.0 end
        $txt tag add tagCURLINE [list $pos linestart] [list $pos lineend]+1displayindices
      }
    }
    set data(NLINES,$txt) $nlines
    set data(CURPOS,$txt) $pos
    return $pos
}</pre></div>
</div></div></div><div class='yui-b navbox' ><h1><a href='#::hl_tcl'>hl_tcl</a></h1><h2><a href='#::hl_tcl-Some of blah-blah'>Some of blah-blah</a></h2><h2><a href='#::hl_tcl-Some of editors'>Some of editors</a></h2><h2><a href='#::hl_tcl-What can we do?'>What can we do?</a></h2><h2><a href='#::hl_tcl-Use for text widget'>Use for text widget</a></h2><h2><a href='#::hl_tcl-Use for static html'>Use for static html</a></h2><h2><a href='#::hl_tcl-Links'>Links</a></h2><h2><a href='#::hl_tcl-Commands'>Commands</a></h2><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::addingColors'>addingColors</a><span class='tooltiptext'>Sets/gets colors for a text syntax highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::clearup'>clearup</a><span class='tooltiptext'>Clears data related to text (esp. at deleting it).
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_all'>hl_all</a><span class='tooltiptext'>Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_colorNames'>hl_colorNames</a><span class='tooltiptext'>Returns a list of color names for syntax highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_colors'>hl_colors</a><span class='tooltiptext'>Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_commands'>hl_commands</a><span class='tooltiptext'>Lists all Tcl/Tk commands registered here.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_init'>hl_init</a><span class='tooltiptext'>Initializes highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_line'>hl_line</a><span class='tooltiptext'>Updates a current line's highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_readonly'>hl_readonly</a><span class='tooltiptext'>Makes the text widget be readonly or gets its 'read-only' state.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_text'>hl_text</a><span class='tooltiptext'>Highlights Tcl code of a text widget.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::iscurline'>iscurline</a><span class='tooltiptext'>Sets / gets &quot;highlight a current line&quot; flag for a text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::isdone'>isdone</a><span class='tooltiptext'>Checks if the highlighting of the text is done.
</span></h4><h1><a href='#::hl_tcl::my'>hl_tcl::my</a></h1><h2><a href='#::hl_tcl::my-Commands'>Commands</a></h2><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::AuxEnding'>AuxEnding</a><span class='tooltiptext'>Auxiliary procedure to process the ending comments in the line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::BindToEvent'>BindToEvent</a><span class='tooltiptext'>Binds an event on a widget to a command.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CoroHighlightAll'>CoroHighlightAll</a><span class='tooltiptext'>Highlights all of a text as a coroutine.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CoroModified'>CoroModified</a><span class='tooltiptext'>Handles modifications of text.
</span></h4><h4><a href='hl_tcl.html#::hl_tcl::my::CoroRun'>CoroRun</a></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CountChar'>CountChar</a><span class='tooltiptext'>Counts a character in a string.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CountQSH'>CountQSH</a><span class='tooltiptext'>Counts quotes, slashes, hashes in a line
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::Escaped'>Escaped</a><span class='tooltiptext'>Checks if a character is escaped in a string.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::FirstQtd'>FirstQtd</a><span class='tooltiptext'>Searches the quote characters in line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightAll'>HighlightAll</a><span class='tooltiptext'>Highlights all of a text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightBrackets'>HighlightBrackets</a><span class='tooltiptext'>Highlights matching brackets if any.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightCmd'>HighlightCmd</a><span class='tooltiptext'>Highlights Tcl/Tk commands.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightComment'>HighlightComment</a><span class='tooltiptext'>Highlights comments.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightLine'>HighlightLine</a><span class='tooltiptext'>Highlights a line in text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightStr'>HighlightStr</a><span class='tooltiptext'>Highlights strings.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::InRange'>InRange</a><span class='tooltiptext'>Checks if a text position is in a range of text positions.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::IsCurline'>IsCurline</a><span class='tooltiptext'>Sets / gets &quot;highlight a current line&quot; flag for a text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::LineState'>LineState</a><span class='tooltiptext'>Gets an initial state of line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MatchedBrackets'>MatchedBrackets</a><span class='tooltiptext'>Finds a match of characters (dchar for schar).
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MemPos'>MemPos</a><span class='tooltiptext'>Remembers the state of current line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MemPos1'>MemPos1</a><span class='tooltiptext'>Checks and sets the cursor's width, depending on its position.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MergePosList'>MergePosList</a><span class='tooltiptext'>Merges lists of numbers that are not-coinciding and sorted.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::Modified'>Modified</a><span class='tooltiptext'>Handles modifications of text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::NotEscaped'>NotEscaped</a><span class='tooltiptext'>Checks if a character escaped in a line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::RemoveTags'>RemoveTags</a><span class='tooltiptext'>Removes tags in text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::RunCoroAfterIdle'>RunCoroAfterIdle</a><span class='tooltiptext'>Runs a &quot;modified&quot; corotine after idle.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::SearchTag'>SearchTag</a><span class='tooltiptext'>Searches a position in tag ranges.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::ShowCurrentLine'>ShowCurrentLine</a><span class='tooltiptext'>Shows the current line.
</span></h4></div></div><div id='ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div></div>
</div></body></html>
