<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>klnd reference</title>
<style>
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
html{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var,optgroup{font-style:inherit;font-weight:inherit;}del,ins{text-decoration:none;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup{vertical-align:baseline;}sub{vertical-align:baseline;}legend{color:#000;}input,button,textarea,select,optgroup,option{font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;}input,button,textarea,select{*font-size:100%;}body{font:13px/1.231 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small;}select,input,button,textarea,button{font:99% arial,helvetica,clean,sans-serif;}table{font-size:inherit;font:100%;}pre,code,kbd,samp,tt{font-family:monospace;*font-size:108%;line-height:100%;}body{text-align:center;}#doc,#doc2,#doc3,#doc4,.yui-t1,.yui-t2,.yui-t3,.yui-t4,.yui-t5,.yui-t6,.yui-t7{margin:auto;text-align:left;width:57.69em;*width:56.25em;}#doc2{width:73.076em;*width:71.25em;}#doc3{margin:auto;width:auto;}#doc4{width:74.923em;*width:73.05em;}.yui-b{position:relative;}.yui-b{_position:static;}#yui-main .yui-b{position:static;}#yui-main,.yui-g .yui-u .yui-g{width:100%;}.yui-t1 #yui-main,.yui-t2 #yui-main,.yui-t3 #yui-main{float:right;margin-left:-25em;}.yui-t4 #yui-main,.yui-t5 #yui-main,.yui-t6 #yui-main{float:left;margin-right:-25em;}.yui-t1 .yui-b{float:left;width:12.30769em;*width:12.00em;}.yui-t1 #yui-main .yui-b{margin-left:13.30769em;*margin-left:13.05em;}.yui-t2 .yui-b{float:left;width:13.8461em;*width:13.50em;}.yui-t2 #yui-main .yui-b{margin-left:14.8461em;*margin-left:14.55em;}.yui-t3 .yui-b{float:left;width:23.0769em;*width:22.50em;}.yui-t3 #yui-main .yui-b{margin-left:24.0769em;*margin-left:23.62em;}.yui-t4 .yui-b{float:right;width:13.8456em;*width:13.50em;}.yui-t4 #yui-main .yui-b{margin-right:14.8456em;*margin-right:14.55em;}.yui-t5 .yui-b{float:right;width:18.4615em;*width:18.00em;}.yui-t5 #yui-main .yui-b{margin-right:19.4615em;*margin-right:19.125em;}.yui-t6 .yui-b{float:right;width:23.0769em;*width:22.50em;}.yui-t6 #yui-main .yui-b{margin-right:24.0769em;*margin-right:23.62em;}.yui-t7 #yui-main .yui-b{display:block;margin:0 0 1em 0;}#yui-main .yui-b{float:none;width:auto;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf,.yui-gc .yui-u,.yui-gd .yui-g,.yui-g .yui-gc .yui-u,.yui-ge .yui-u,.yui-ge .yui-g,.yui-gf .yui-g,.yui-gf .yui-u{float:right;}.yui-g div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first,.yui-ge div.first,.yui-gf div.first,.yui-g .yui-gc div.first,.yui-g .yui-ge div.first,.yui-gc div.first div.first{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf{width:49.1%;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{width:32%;margin-left:1.99%;}.yui-gb .yui-u{*margin-left:1.9%;*width:31.9%;}.yui-gc div.first,.yui-gd .yui-u{width:66%;}.yui-gd div.first{width:32%;}.yui-ge div.first,.yui-gf .yui-u{width:74.2%;}.yui-ge .yui-u,.yui-gf div.first{width:24%;}.yui-g .yui-gb div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first{margin-left:0;}.yui-g .yui-g .yui-u,.yui-gb .yui-g .yui-u,.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u,.yui-ge .yui-g .yui-u,.yui-gf .yui-g .yui-u{width:49%;*width:48.1%;*margin-left:0;}.yui-g .yui-g .yui-u{width:48.1%;}.yui-g .yui-gb div.first,.yui-gb .yui-gb div.first{*margin-right:0;*width:32%;_width:31.7%;}.yui-g .yui-gc div.first,.yui-gd .yui-g{width:66%;}.yui-gb .yui-g div.first{*margin-right:4%;_margin-right:1.3%;}.yui-gb .yui-gc div.first,.yui-gb .yui-gd div.first{*margin-right:0;}.yui-gb .yui-gb .yui-u,.yui-gb .yui-gc .yui-u{*margin-left:1.8%;_margin-left:4%;}.yui-g .yui-gb .yui-u{_margin-left:1.0%;}.yui-gb .yui-gd .yui-u{*width:66%;_width:61.2%;}.yui-gb .yui-gd div.first{*width:31%;_width:29.5%;}.yui-g .yui-gc .yui-u,.yui-gb .yui-gc .yui-u{width:32%;_float:right;margin-right:0;_margin-left:0;}.yui-gb .yui-gc div.first{width:66%;*float:left;*margin-left:0;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf .yui-u{margin:0;}.yui-gb .yui-gb .yui-u{_margin-left:.7%;}.yui-gb .yui-g div.first,.yui-gb .yui-gb div.first{*margin-left:0;}.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u{*width:48.1%;*margin-left:0;}.yui-gb .yui-gd div.first{width:32%;}.yui-g .yui-gd div.first{_width:29.9%;}.yui-ge .yui-g{width:24%;}.yui-gf .yui-g{width:74.2%;}.yui-gb .yui-ge div.yui-u,.yui-gb .yui-gf div.yui-u{float:right;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf div.first{float:left;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf div.first{*width:24%;_width:20%;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf .yui-u{*width:73.5%;_width:65.5%;}.yui-ge div.first .yui-gd .yui-u{width:65%;}.yui-ge div.first .yui-gd div.first{width:32%;}#hd:after,#bd:after,#ft:after,.yui-g:after,.yui-gb:after,.yui-gc:after,.yui-gd:after,.yui-ge:after,.yui-gf:after{content:".";display:block;height:0;clear:both;visibility:hidden;}#hd,#bd,#ft,.yui-g,.yui-gb,.yui-gc,.yui-gd,.yui-ge,.yui-gf{zoom:1;}

body{margin:10px;}h1{font-size:138.5%;}h2{font-size:123.1%;}h3{font-size:108%;}h1,h2,h3{margin:1em 0;}h1,h2,h3,h4,h5,h6,strong,dt{font-weight:bold;}optgroup{font-weight:normal;}abbr,acronym{border-bottom:1px dotted #000;cursor:help;}em{font-style:italic;}del{text-decoration:line-through;}blockquote,ul,ol,dl{margin:1em;}ol,ul,dl{margin-left:2em;}ol li{list-style:decimal outside;}ul li{list-style:disc outside;}dl dd{margin-left:1em;}th,td{border:1px solid #000;padding:.5em;}th{font-weight:bold;text-align:center;}caption{margin-bottom:.5em;text-align:center;}sup{vertical-align:super;}sub{vertical-align:sub;}p,fieldset,table,pre{margin-bottom:1em;}button,input[type="checkbox"],input[type="radio"],input[type="reset"],input[type="submit"]{padding:1px;}


/* Ruff default CSS */

body {
  max-width: 70em;
  margin: 0;
}

h1,h2 {
  color: #888888;
  margin-bottom: 0.5em;
  margin-top: 0em;
}

#ft {
  text-align: left;
  border-top: 1px solid #006666;
  color: #888888;
  margin-top: 10px;
}

.banner h2 {
  color: #006666;
}

#hd.banner {
 font-family: "Times New Roman", serif;
 font-size: 200%;
 line-height: 64px;
 border-bottom: thin solid #006666;
 color: #006666;
}

p.linkline {
    text-align: right;
    font-size: smaller;
    /*    margin-top: -1em; */
    margin-bottom: 0;
}

.tinylink {
    font-size: x-small;
    font-variant: normal;
    font-family: Arial, sans-serif;
    float: right;
    padding:2px;
}

h1 .tinylink a {
    color: white;
}

#bd {
font-family: Arial, sans-serif;
font-size: 108%;
}

div.navbox {
  /* margin-top: 1em; */
    background-color: #006666;
    color: white;
    padding: 3px 4px 2px 4px;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

div.navbox:hover {
    overflow: visible;
}

/* Note .navbox header css should be based on $header_levels */
.navbox h1, .navbox h2, .navbox h3, .navbox h4, .navbox h5 {
  font-size: 85%;
  margin: 0px;
  font-weight: normal;
}
.navbox h1 {
    font-weight: bold; /* Override */
}
.navbox h2 {
  padding-left: 1em;
}
.navbox h3 {
  padding-left: 2em;
}
.navbox h4 {
  padding-left: 2.5em;
  font-weight: normal;
}
.navbox h5 {
  padding-left: 3em;
  font-weight: normal;
}
.navbox hr {
  color: white;
  margin-top:0.1em;
  margin-bottom:0.1em;
}

.navbox a:link, .navbox a:visited, .navbox a:hover {
  text-decoration: none;
  color: white;
  background-color: #006666;
}

.navbox a:hover {
   font-weight: bold;
}

/* Tooltip text - see https://www.w3schools.com/css/css_tooltip.asp */
.tooltip {
    position: relative;
    /* display: inline-block; */
}

.tooltip .tooltiptext {
    width: 100%;
    font-weight: bold;
    background-color: white;
    color: #006666;
    text-align: left;
    border: 1px solid #006666;
    /* border-radius: 4px; */
    position: absolute;
    z-index: 1;
    margin-left: 4px;
    padding: 2px 3px;
    visibility: hidden;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
    visibility: visible;
}

span.ns_scope {
    color: #aaaaaa;
}

span.ns_scope a:link, span.ns_scope a:visited {
  text-decoration: none;
  color: #aaaaaa;

}

li {
  margin-top: 0.5em;
}

span.ns_scope a:hover {
  text-decoration: none;
  color: #666666;
}

table {
  margin: 1em;
  margin-top: 0.5em;
  border: thin solid;
  border-collapse: collapse;
  border-color: #808080;
  padding: 4px;
}

td {
  border: thin solid;
  border-color: #808080;
  vertical-align: top;
  font-size: 93%;
  padding: 0.3em;
  padding-top: 0.1em;
}
th {
  border: thin solid;
  border-color: #808080;
  padding: 0.3em;
  padding-top: 0.1em;
  background-color: #CCCCCC;
}

dt, dd {
   font-size: 93%;
}

h1.ruff {
    background-color: #006666;
    color: #ffffff;
    padding-left: 0.2em;
    font-family: "Times New Roman", serif;
}
h2.ruff {
    font-variant: small-caps;
    color: #006666;
    font-family: "Times New Roman", serif;
}

h3.ruff, h4.ruff, h5.ruff, h6.ruff {
    color: #006666;
}
h5.ruff {
    font-style: italic;
    font-weight: normal;
}
h6.ruff {
    font-weight: normal;
}
h3.ruffclass, h3.ruffproc, h3.ruffmethod,
h4.ruffclass, h4.ruffproc, h4.ruffmethod,
h5.ruffclass, h5.ruffproc, h5.ruffmethod {
    border-bottom: thin solid #006666;
    color: #006666;
    margin-bottom: 0.2em;
}

pre {
    background-color: #eeeeee;
    margin-top: 1em;
    margin-left: 1em;
    padding: 5px;
    font-family: Consolas, "Courier New", monospace;
    width: max-content;
    font-size: smaller;
    line-height: 1.2em;
}

.ruff_dyn_src {
    display: none; /* Displayed via JS */
}

.ruff_synopsis {
    border: thin solid #cccccc;
    background: #eeeeee;
    font-size: smaller;
    font-family: Consolas, "Courier New", monospace;
    padding: 5px;
    margin: 0em 2em 1em;
}
.ruff_const, .ruff_cmd, ruff_defitem {
    font-weight: bold;
    font-family: Consolas, "Courier New", monospace;
}
.ruff_arg {
    font-style: italic;
    font-family: Consolas, "Courier New", monospace;
}

.ruff_source_link {
    font-size: smaller;
}

.ruff_index {
    font-size: small;
    color: grey;
    line-height: 1;
}

.ruff_index ul li {
    list-style-type: none;
}

.ruff_index ul li a {
    text-decoration: none;
}
</style>
<script>function toggleSource( id )
{
    /* Copied from Rails */
    var elem
    var link

    if( document.getElementById )
    {
        elem = document.getElementById( id )
        link = document.getElementById( "l_" + id )
    }
    else if ( document.all )
    {
        elem = eval( "document.all." + id )
        link = eval( "document.all.l_" + id )
    }
    else
        return false;

    if( elem.style.display == "block" )
    {
        elem.style.display = "none"
        link.innerHTML = "Show source"
    }
    else
    {
        elem.style.display = "block"
        link.innerHTML = "Hide source"
    }
}
</script></head>
<body><div id='doc3' class='yui-t2'><div id='hd' class='banner'>
<a style='text-decoration:none;' href='klnd.html'>klnd reference</a>
</div>
<div id='bd'><div id='yui-main'><div class='yui-b'><h1 class='ruff'><a name='::klnd'></a>::klnd<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <em>klnd</em> package provides a calendar widget to use along with <a href="../pave/index.html" >apave</a> package.</p>
<p class='ruff'>Features:</p>
<ul class='ruff'>
<li>displays localized days' and months' names</li>
<li>gets a chosen day through <code>-value</code> or <code>-tvar</code> (variable name) option</li>
<li>uses arrow keys to navigate through days, months and years</li>
<li>provides hot keys to navigate through months and years</li>
<li>provides buttons to navigate through months and years</li>
<li>provides a button and a hot key to set a current date</li>
<li>buttons' tips</li>
<li>shown at +X+Y coordinates / under a widget / in a parent's center / in a screen's center or under the mouse pointer</li>
<li>customizable title, date format, first week day (Sunday/Monday)</li>
<li>themeable (with ttk and <a href="../pave/index.html" >apave</a> themes)</li>
<li>may be a modal (by default) or non-modal window</li>
</ul>
<p class='ruff'>The calendar looks like this:</p>
<p class='ruff'>&lt;img src=&quot;../pave/files/widgdat2.png&quot; class=&quot;media&quot; alt=&quot;&quot;&gt;</p>
<p class='ruff'><hr></p>
<p class='ruff'>To directly call the calendar, use the following commands:</p>
<pre class='ruff'>
package require klnd
klnd::calendar ?-option value ... ?

# or this way
source [file join $::apave::apaveDir pickers klnd klnd.tcl]
klnd::calendar ?-option value ... ?
</pre>
<p class='ruff'>where <code>option</code> may be:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>-value</td><td class='ruff_defitem'>sets an input date (omittable)</td></tr>
<tr><td class='ruff_defitem'>-tvar</td><td class='ruff_defitem'>sets a variable name to hold the input/output value (omittable)</td></tr>
<tr><td class='ruff_defitem'>-dateformat</td><td class='ruff_defitem'>sets the input/output date format (%D by default)</td></tr>
<tr><td class='ruff_defitem'>-weekday</td><td class='ruff_defitem'>sets a first week day: %w for Sunday, %u for Monday (default)</td></tr>
<tr><td class='ruff_defitem'>-modal</td><td class='ruff_defitem'><code>yes</code> if the calendar should be a modal window (default)</td></tr>
<tr><td class='ruff_defitem'>-title</td><td class='ruff_defitem'>sets the calendar's title</td></tr>
<tr><td class='ruff_defitem'>-geometry</td><td class='ruff_defitem'>sets the calendar's geometry</td></tr>
<tr><td class='ruff_defitem'>-entry</td><td class='ruff_defitem'>sets a widget's path to show the calendar under</td></tr>
<tr><td class='ruff_defitem'>-parent</td><td class='ruff_defitem'>sets a parent toplevel window to center the calendar in</td></tr>
<tr><td class='ruff_defitem'>-centerme</td><td class='ruff_defitem'><code>yes</code> if the calendar should be centered in the screen</td></tr>
</table>
<p class='ruff'>If <code>-value</code> and <code>-tvar</code> options are both set, the <code>-tvar</code> is preferred. If both omitted, a current system date is used as input.</p>
<p class='ruff'>The calendar returns a chosen date (setting also the <code>-tvar</code> variable if any) or &quot;&quot; at no choice.</p>
<p class='ruff'>The priority of geometry options: <code>-geometry, -entry, -parent, -centerme</code>. At no geometry option given, the calendar is shown under the mouse pointer.</p>
<p class='ruff'>The <code>-parent</code> option may be used along with <code>-geometry, -entry</code>, as it allows a child window to inherit the parent's attributes.</p>
<p class='ruff'><hr></p>
<p class='ruff'>The calendar provides the hotkeys Left, Right, Up, Down, PageUp, PageDown, Home, End and F3 to navigate through days, months and years.</p>
<p class='ruff'>The Enter / Space keys or Double-Click are used to pick a date.</p>
<h2 class='ruff'><a name='::klnd-Usage in apave package'></a>Usage in apave package<span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>With <a href="../pave/index.html" >apave</a> package, the calendar can be used in two forms: <em>date picker</em> and <em>embedded calendar</em>:</p>
<ul class='ruff'>
<li><em>date picker</em> presents an entry field to hold an input/output date and a button to choose a date from the picker</li>
<li><em>embedded calendar</em> presents a full set of widgets to display a selected month of year</li>
</ul>
<p class='ruff'>An example of using <em>date picker</em> for <a href="../pave/index.html" >apave</a> layout:</p>
<pre class='ruff'>
{dat1 labDat1 L 1 1 {} {-tvar ::N::dat1 -title {Date of the event} -dateformat %d.%m.%Y -weekday %w}}
</pre>
<p class='ruff'>This example includes <code>-tvar</code> option meaning a variable name to hold the date.</p>
<p class='ruff'>The <em>embedded calendar</em> differs from this with <code>daT</code> type of widget used instead of <code>dat</code>. Also, this form of calendar doesn't allow using the keyboard; only the mouse is used in it.</p>
<p class='ruff'>The below example is taken from <a href="../alited/index.html" >alited</a>'s source:</p>
<pre class='ruff'>
{.daT - - - - {pack -fill both} {-tvar alited::project::klnddata(date) -com {alited::project::KlndUpdate} -dateformat $alited::project::klnddata(dateformat) -tip {alited::project::KlndTip %W %D}}}
</pre>
<p class='ruff'>This example includes <code>-com</code> option to run a command at clicking a day. This command can use <code>::klnd::update</code> to highlight some days in the calendar. In <a href="../alited/index.html" >alited</a> these days contain  reminders of TODOs being dead-lines.</p>
<p class='ruff'>Options of embedded calendar:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>-com, -command</td><td class='ruff_defitem'>a command to run at left-click</td></tr>
<tr><td class='ruff_defitem'>-popup</td><td class='ruff_defitem'>a command to run at right-click</td></tr>
<tr><td class='ruff_defitem'>-currentmonth</td><td class='ruff_defitem'>a current month to display, in form of &quot;year/month&quot;</td></tr>
<tr><td class='ruff_defitem'>-united</td><td class='ruff_defitem'>if yes, means &quot;united&quot; calendars</td></tr>
<tr><td class='ruff_defitem'>-daylist</td><td class='ruff_defitem'>a list of selected days for &quot;united&quot; calendars</td></tr>
<tr><td class='ruff_defitem'>-hllist</td><td class='ruff_defitem'>a list of highlighted days</td></tr>
<tr><td class='ruff_defitem'>-tip</td><td class='ruff_defitem'>a command to get a day's tip</td></tr>
</table>
<p class='ruff'>A command of <code>-com, -command, -popup</code> options can use wildcards: %y, %m, %d for year, month, day, %X, %Y for mouse pointer's coordinates.</p>
<p class='ruff'>A command of <code>-tip</code> option can use wildcards: %W for a day widget's path, %D for a day.</p>
<p class='ruff'>UI procedures of embedded calendar:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>::klnd::labelPath</td><td class='ruff_defitem'>gets a title label's path, to change its attributes</td></tr>
<tr><td class='ruff_defitem'>::klnd::selectedDay</td><td class='ruff_defitem'>gets a selected day</td></tr>
<tr><td class='ruff_defitem'>::klnd::getDaylist</td><td class='ruff_defitem'>gets a list of selected days (for united calendars)</td></tr>
<tr><td class='ruff_defitem'>::klnd::update</td><td class='ruff_defitem'>redraws a calendar for a month</td></tr>
</table>
<p class='ruff'>The procedures use <code>obj</code> argument, which is just an index of a calendar (beginning with 1). If omitted or equal to {}, <code>obj</code> means a last created calendar.</p>
<p class='ruff'>The multiple embedded calendars may be united with <code>-united yes</code> option, so that a user can select a list of days inside them.</p>
<h2 class='ruff'><a name='::klnd-Commands'></a>Commands<span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h4 class='ruffproc'><a name='::klnd::blinking'>blinking</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Makes a calendar label blink.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>blinking</span> <span class='ruff_arg'>doit</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>doit</code></td><td class='ruff_defitem'>if yes, starts blinking, else stops it</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_blinking' href="javascript:toggleSource('klnd_blinking')">Show source</a></p>
<div id='klnd_blinking' class='ruff_dyn_src'><pre>proc ::klnd::blinking {doit} {
    # Makes a calendar label blink.
    #   doit - if yes, starts blinking, else stops it

    lassign [::apave::obj csGet] - fgnorm - bgnorm
    lassign [::apave::obj csGet 45] - - - - - bgblink fgblink
    set lab [::klnd::labelPath]
    if {$doit} {
      after idle &quot;::apave::blinkWidget $lab $fgnorm $bgnorm $fgblink $bgblink 100 4&quot;
    } else {
      ::apave::blinkWidget $lab $fgnorm $bgnorm
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::calendar'>calendar</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>The main procedure of the calendar's toplevel.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>calendar</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>options of the calendar</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_calendar' href="javascript:toggleSource('klnd_calendar')">Show source</a></p>
<div id='klnd_calendar' class='ruff_dyn_src'><pre>proc ::klnd::calendar {args} {
    # The main procedure of the calendar's toplevel.
    #   args - options of the calendar

    variable my::p
    set my::p(isWidget) no
    # get options and initialize the calendar's settings
    lassign [my::InitCalendar {*}$args] title datevalue tvar parent centerme geo entry
    set args [clearArgs {*}$args]
    # priority of geometry options: -geometry, -entry, -parent, -centerme
    # if no geometry option, show the calendar under the mouse pointer
    if {$geo ne {}} {
      set geo &quot;-geometry $geo&quot;
    } elseif {$entry ne {}} {
      set x [winfo rootx $entry]
      set y [expr {[winfo rooty $entry]+32}]
      set geo &quot;-geometry +$x+$y&quot;
    } elseif {$parent ne {}} {
      set geo &quot;-centerme $parent&quot;    ;# to center in a toplevel window
    } elseif {$centerme ne {}} {
      set geo &quot;-centerme $centerme&quot;  ;# it's an option of apave's
    } else {
      set geo &quot;-geometry +[expr {[winfo pointerx .]+10}]+[expr {[winfo pointery .]+10}]&quot;
    }
    set parent [string trimright $parent .]
    set win [set my::p(win) &quot;$parent._apave_CALENDAR_&quot;]
    catch {$my::p(obj) destroy}
    # create apave object and layout its window
    set my::p(obj) [::apave::APave create APAVE_CLND $win]
    $my::p(obj) makeWindow $win.fra $title
    $my::p(obj) paveWindow $win.fra [list  {*}[my::MainWidgets]  {seh fra T 1 7 {-pady 0}}  {fraBottom seh T 1 7 {-st ew -pady 1}}  {fraBottom.h_ - - - - {pack -fill both -expand 1 -side left} {}}  {fraBottom.But_KLNDCLOSE - - - - {pack -side left} {-t &quot;Close&quot; -com &quot;$::klnd::my::p(obj) res $win 0&quot;}}  ]
    # binds for day buttons and 'Close'
    foreach {ev prc} { &lt;Home&gt; &quot;::klnd::my::GoYear -1 yes&quot; &lt;End&gt; &quot;::klnd::my::GoYear 1 yes&quot;  &lt;Prior&gt; &quot;::klnd::my::GoMonth -1 yes&quot; &lt;Next&gt; &quot;::klnd::my::GoMonth 1 yes&quot;} {
      for {set i 1} {$i&lt;38} {incr i} {
        set but [$my::p(obj) BuT_KLNDSTD$i]
        bind $but $ev $prc
        bind $but &lt;FocusIn&gt; &quot;::klnd::my::Enter $i&quot;
        bind $but &lt;KeyPress&gt; &quot;::klnd::my::KeyPress $i %K&quot;
        bind $but &lt;Double-1&gt; &quot;::klnd::my::DoubleClick $win $i&quot;
      }
      catch {bind [$my::p(obj) But_KLNDCLOSE] $ev $prc}
    }
    bind $win &lt;F3&gt; ::klnd::my::SetCurrentDay
    bind $win &lt;KeyPress&gt; &quot;::klnd::my::Leave&quot;
    # show and work with the calendar
    after idle &quot;::klnd::my::ShowMonth $my::p(m) $my::p(y)&quot;
    set res [$my::p(obj) showModal $win -resizable no {*}$args {*}$geo]
    # get the result of the selection if any
    if {$res &amp;&amp; $my::p(dvis)} {
      set res [clock format [clock scan $my::p(mvis)/$my::p(dvis)/$my::p(yvis) -format %D] -format $my::p(dformat)]
      if {$tvar ne {}} {set $tvar $res}
    } else {
      set res {}
    }
    $my::p(obj) destroy
    destroy $win
    return $res
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::calendar2'>calendar2</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>The main procedure of the calendar embedded widget.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>calendar2</span> <span class='ruff_arg'>pobj w ownname ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>pobj</code></td><td class='ruff_defitem'>apave object</td></tr>
<tr><td class='ruff_defitem'><code>w</code></td><td class='ruff_defitem'>container widget for <em>ownname</em></td></tr>
<tr><td class='ruff_defitem'><code>ownname</code></td><td class='ruff_defitem'>frame widget for calendar</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>options of the calendar</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of widgets for apave layout.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_calendar2' href="javascript:toggleSource('klnd_calendar2')">Show source</a></p>
<div id='klnd_calendar2' class='ruff_dyn_src'><pre>proc ::klnd::calendar2 {pobj w ownname args} {
    # The main procedure of the calendar embedded widget.
    #   pobj - apave object
    #   w - container widget for *ownname*
    #   ownname - frame widget for calendar
    #   args - options of the calendar
    # Returns a list of widgets for apave layout.

    variable my::p
    set obj [incr my::p(objNUM)]
    set my::p($obj) $pobj
    my::InitSettings
    my::InitCalendar {*}$args
    if {$my::p(currentmonth) eq {}} {
      lassign [::klnd::currentYearMonthDay] year month day
      set my::p(currentmonth) &quot;$year/$month&quot;
      set my::p(currentdate) &quot;$year/$month/$day&quot;
    }
    # save options for current calendar
    foreach opt {weekday months days loc yvis mvis dvis  com tvar dformat united currentmonth daylist popup hllist tip} {
      set my::p($opt$obj) $my::p($opt)
    }
    if {$my::p(daylist) ne {-} &amp;&amp; $my::p(united)} {
      # for calendars united, initialize day lists per month
      set my::p(daylist$obj) [list]
      foreach date $my::p(daylist) {
        set d [clock format [clock scan $date -format $my::p(dformat)] -format %Y/%N/%d]
        lassign [split $d /] y m
        set m [my::TrimN $m]
        lappend my::p(daylist$obj) $date
      }
    }
    # if calendars are united, it's selected at start
    # and saved as previously selected one
    set my::p(olddate$obj) {}
    # binds for day buttons and show and work with the calendar
    after idle &quot;::klnd::my::BindButtons2 $obj;  ::klnd::my::ShowMonth2 $obj $my::p(m) $my::p(y) yes yes&quot;
    set res [my::MainWidgets2 $obj $ownname]
    return $res
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::clearArgs'>clearArgs</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Removes specific options from args.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>clearArgs</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>list of options</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_clearArgs' href="javascript:toggleSource('klnd_clearArgs')">Show source</a></p>
<div id='klnd_clearArgs' class='ruff_dyn_src'><pre>proc ::klnd::clearArgs {args} {
    # Removes specific options from args.
    #   args - list of options

    return [::apave::removeOptions $args -title -value -tvar -locale -parent -dateformat -weekday -com -command -currentmonth -united -daylist -hllist -popup -tip]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::clearup'>clearup</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Clearance for klnd data (variable my::p).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>clearup</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_clearup' href="javascript:toggleSource('klnd_clearup')">Show source</a></p>
<div id='klnd_clearup' class='ruff_dyn_src'><pre>proc ::klnd::clearup {} {
    # Clearance for klnd data (variable my::p).

    variable my::p
    array unset my::p *
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::currentYearMonthDay'>currentYearMonthDay</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets current year, month, day. Return a list of  current year, month, day.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>currentYearMonthDay</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_currentYearMonthDay' href="javascript:toggleSource('klnd_currentYearMonthDay')">Show source</a></p>
<div id='klnd_currentYearMonthDay' class='ruff_dyn_src'><pre>proc ::klnd::currentYearMonthDay {} {
    # Gets current year, month, day.
    # Return a list of  current year, month, day.

    set ym [clock seconds]
    return [list {*}&quot; [clock format $ym -format %Y]  [clock format $ym -format %N]  [clock format $ym -format %e]&quot;]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::getDaylist'>getDaylist</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a day list which was set initially and possibly changed by a user.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>getDaylist</span> <span class='ruff_arg'>pobj ?min? ?max?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>pobj</code></td><td class='ruff_defitem'>apave object</td></tr>
<tr><td class='ruff_defitem'><code>min</code></td><td class='ruff_defitem'>minimal index of calendar widget Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>max</code></td><td class='ruff_defitem'>maximal index of calendar widget Optional, default <code>9999999</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>The pobj is the same as passed to klnd::calendar2.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="klnd.html#::klnd::calendar2" title="calendar2" class='ruff_cmd'>calendar2</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_getDaylist' href="javascript:toggleSource('klnd_getDaylist')">Show source</a></p>
<div id='klnd_getDaylist' class='ruff_dyn_src'><pre>proc ::klnd::getDaylist {pobj {min 0} {max 9999999}} {
    # Gets a day list which was set initially and possibly changed by a user.
    #   pobj - apave object
    #   min - minimal index of calendar widget
    #   max - maximal index of calendar widget
    # The pobj is the same as passed to klnd::calendar2.
    # See also: calendar2

    variable my::p
    set res [list]
    if {![catch {set objNUM $my::p(objNUM)}]} {
      for {set obj 0} {$obj&lt;$objNUM} {} {
        incr obj
        if {$my::p($obj) eq $pobj &amp;&amp; [info exist my::p(daylist$obj)]} {
          if {$my::p(daylist$obj) ne {-} &amp;&amp; $min&lt;=$obj &amp;&amp; $obj&lt;=$max} {
            foreach d $my::p(daylist$obj) {
              if {[lsearch -exact $res $d]&lt;0} {
                lappend res $d
              }
            }
          }
        }
      }
    }
    return $res
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::labelPath'>labelPath</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a title label path.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>labelPath</span> <span class='ruff_arg'>?obj?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of the calendar Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Useful to change the label's attributes. If <em>obj</em> omitted, returns a path of last created label.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_labelPath' href="javascript:toggleSource('klnd_labelPath')">Show source</a></p>
<div id='klnd_labelPath' class='ruff_dyn_src'><pre>proc ::klnd::labelPath {{obj {}}} {
    # Gets a title label path.
    #   obj - index of the calendar
    # Useful to change the label's attributes.
    # If *obj* omitted, returns a path of last created label.

    variable my::p
    if {$obj eq {}} {set obj $my::p(objNUM)}
    return [$my::p($obj) LabMonth$obj]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::maxYear'>maxYear</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets maximal year that is correct.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>maxYear</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_maxYear' href="javascript:toggleSource('klnd_maxYear')">Show source</a></p>
<div id='klnd_maxYear' class='ruff_dyn_src'><pre>proc ::klnd::maxYear {} {
    # Gets maximal year that is correct.

    return 9999
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::minYear'>minYear</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets minimal year that is correct.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>minYear</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_minYear' href="javascript:toggleSource('klnd_minYear')">Show source</a></p>
<div id='klnd_minYear' class='ruff_dyn_src'><pre>proc ::klnd::minYear {} {
    # Gets minimal year that is correct.

    return 1753
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::months'>months</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a list of months according to a locale.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>months</span> <span class='ruff_arg'>?loc?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>loc</code></td><td class='ruff_defitem'>the locale Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_months' href="javascript:toggleSource('klnd_months')">Show source</a></p>
<div id='klnd_months' class='ruff_dyn_src'><pre>proc ::klnd::months {{loc {}}} {
    # Gets a list of months according to a locale.
    #   loc - the locale

    if {$loc eq {}} {set loc [my::DefaultLocale]}
    set months [list]
    foreach i {01 02 03 04 05 06 07 08 09 10 11 12} {
      lappend months [clock format [clock scan &quot;$i/01/2021&quot;  -format %D -locale $loc] -format %B -locale $loc]
    }
    return $months
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::selectedDay'>selectedDay</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a selected day.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>selectedDay</span> <span class='ruff_arg'>?obj? ?y? ?m? ?d? ?doblink?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of the calendar Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>year Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>month Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>d</code></td><td class='ruff_defitem'>day Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>doblink</code></td><td class='ruff_defitem'>if yes, make the month blink Optional, default <code>yes</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>If y/m/d are set, they define currently selected date.</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of year, month, day</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_selectedDay' href="javascript:toggleSource('klnd_selectedDay')">Show source</a></p>
<div id='klnd_selectedDay' class='ruff_dyn_src'><pre>proc ::klnd::selectedDay {{obj {}} {y {}} {m {}} {d {}} {doblink yes}} {
    # Gets a selected day.
    #   obj - index of the calendar
    #   y - year
    #   m - month
    #   d - day
    #   doblink - if yes, make the month blink
    # If y/m/d are set, they define currently selected date.
    # Returns a list of year, month, day

    variable my::p
    if {$obj eq {}} {set obj $my::p(objNUM)}
    if {$y ne {}} {
      set my::p(yvis$obj) $y
      set my::p(mvis$obj) $m
      set my::p(dvis$obj) $d
      if {$my::p(tvar$obj) ne {}} {
        set p(olddate$obj) [my::FormatDay2 $obj $y $m $d]
        set $my::p(tvar$obj) $p(olddate$obj)
      }
      after idle &quot;::klnd::my::ShowMonth2 $obj $m $y yes yes; ::klnd::blinking $doblink&quot;
    }
    return [list $my::p(yvis$obj) $my::p(mvis$obj) $my::p(dvis$obj)]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::update'>update</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Redraws a calendar.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>update</span> <span class='ruff_arg'>?obj? ?year? ?month? ?hllist?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of the calendar Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>year</code></td><td class='ruff_defitem'>year to redraw Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>month</code></td><td class='ruff_defitem'>month to redraw Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>hllist</code></td><td class='ruff_defitem'>Not documented. Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_update' href="javascript:toggleSource('klnd_update')">Show source</a></p>
<div id='klnd_update' class='ruff_dyn_src'><pre>proc ::klnd::update {{obj {}} {year {}} {month {}} {hllist {}}} {
    # Redraws a calendar.
    #   obj - index of the calendar
    #   year - year to redraw
    #   month - month to redraw

    variable my::p
    if {$obj eq {}} {
      set obj $my::p(objNUM)
      set year $my::p(yvis$obj)
      set month $my::p(mvis$obj)
      set my::p(hllist$obj) $hllist
    }
    my::ShowMonth2 $obj $month $year yes yes
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::weekdays'>weekdays</a><span class='ns_scope'> [<a href="klnd.html#::klnd" title="::klnd" class='ruff_cmd'>::klnd</a>]</span><span class='tinylink'><a href='klnd.html#::klnd'>klnd</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a list of week days according to a locale.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>weekdays</span> <span class='ruff_arg'>?loc?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>loc</code></td><td class='ruff_defitem'>the locale Optional, default <code>&quot;&quot;</code>.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Return list of weekdays and week format (%u or %w)</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_weekdays' href="javascript:toggleSource('klnd_weekdays')">Show source</a></p>
<div id='klnd_weekdays' class='ruff_dyn_src'><pre>proc ::klnd::weekdays {{loc {}}} {
    # Gets a list of week days according to a locale.
    #   loc - the locale
    # Return list of weekdays and week format (%u or %w)

    variable my::locales
    if {$loc eq {}} {set loc [my::DefaultLocale]}
    if {[array names my::locales $loc] ne {}} {
      set wformat $my::locales($loc)
    } else {
      set wformat %u  ;# by default, 1st day of week is Monday
    }
    if {$wformat eq {%u}} {  ;# Sunday be the last day of week
      set wdays {1 2 3 4 5 6 7}
    } else {
      set wdays {0 1 2 3 4 5 6}
    }
    set days [list]
    foreach i $wdays {
      lappend days [clock format [clock scan &quot;03/[expr {14+$i}]/2021&quot;  -format %D -locale $loc] -format %a -locale $loc]
    }
    return [list $days $wformat]
}</pre></div>
</div><h1 class='ruff'><a name='::klnd::my'></a>::klnd::my<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <code>::klnd::my</code> namespace contains procedures for the &quot;internal&quot; usage by <em>klnd</em> package.</p>
<p class='ruff'>All of them are upper-cased, in contrast with the UI procedures of <code>klnd</code> namespace.</p>
<h2 class='ruff'><a name='::klnd::my-Commands'></a>Commands<span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h4 class='ruffproc'><a name='::klnd::my::BindButtons2'>BindButtons2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Binds events to buttons of a calendar.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>BindButtons2</span> <span class='ruff_arg'>obj</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_BindButtons2' href="javascript:toggleSource('klnd_my_BindButtons2')">Show source</a></p>
<div id='klnd_my_BindButtons2' class='ruff_dyn_src'><pre>proc ::klnd::my::BindButtons2 {obj} {
    # Binds events to buttons of a calendar.
    #   obj - index of calendar

    variable p
    for {set i 1} {$i&lt;38} {incr i} {
      set but [$::klnd::my::p($obj) BuT$obj-${i}KLND]
      bind $but &lt;Button-1&gt; &quot;::klnd::my::Enter2 $obj $i 1&quot;
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::ButtonTip'>ButtonTip</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a button's tip.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>ButtonTip</span> <span class='ruff_arg'>obj tipcom w</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>tipcom</code></td><td class='ruff_defitem'>a caller's command returning a tip</td></tr>
<tr><td class='ruff_defitem'><code>w</code></td><td class='ruff_defitem'>current day button's path</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>The tipcom command can include wildcards:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>%W</td><td class='ruff_defitem'>a current day button's path</td></tr>
<tr><td class='ruff_defitem'>%D</td><td class='ruff_defitem'>a current day's value as Y/M/D</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_ButtonTip' href="javascript:toggleSource('klnd_my_ButtonTip')">Show source</a></p>
<div id='klnd_my_ButtonTip' class='ruff_dyn_src'><pre>proc ::klnd::my::ButtonTip {obj tipcom w} {
    # Gets a button's tip.
    #   obj - index of calendar
    #   tipcom - a caller's command returning a tip
    #   w - current day button's path
    # The tipcom command can include wildcards:
    #   %W - a current day button's path
    #   %D - a current day's value as Y/M/D

    variable p
    set res {}
    catch {
      set y $p(yvis$obj)
      set m $p(mvis$obj)
      set d [TrimN [$w cget -text]]
      set d [clock format [clock scan $m/$d/$y -format %D] -format %Y/%m/%d]
      set tipcom [string map [list %W $w %D $d] $tipcom]
      set res [eval {*}$tipcom]
    }
    return $res
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::CurrentDate'>CurrentDate</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets the current date.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CurrentDate</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_CurrentDate' href="javascript:toggleSource('klnd_my_CurrentDate')">Show source</a></p>
<div id='klnd_my_CurrentDate' class='ruff_dyn_src'><pre>proc ::klnd::my::CurrentDate {} {
    # Gets the current date.

    variable p
    set sec [clock seconds]
    lassign [split [clock format $sec -format $p(FINT)] /] p(y) p(m) p(d)
    return $sec
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::DefaultLocale'>DefaultLocale</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a default locale currently used in a system.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>DefaultLocale</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_DefaultLocale' href="javascript:toggleSource('klnd_my_DefaultLocale')">Show source</a></p>
<div id='klnd_my_DefaultLocale' class='ruff_dyn_src'><pre>proc ::klnd::my::DefaultLocale {} {
    # Gets a default locale currently used in a system.

    return [lindex [::msgcat::mcpreferences] 0]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::DoubleClick'>DoubleClick</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Processes double-clicking a button (to choose or ignore).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>DoubleClick</span> <span class='ruff_arg'>win i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>win</code></td><td class='ruff_defitem'>window's path</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_DoubleClick' href="javascript:toggleSource('klnd_my_DoubleClick')">Show source</a></p>
<div id='klnd_my_DoubleClick' class='ruff_dyn_src'><pre>proc ::klnd::my::DoubleClick {win i} {
    # Processes double-clicking a button (to choose or ignore).
    #   win - window's path
    #   i - button index

    variable p
    if {[IsDay $i]} {$p(obj) res $win 1}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::Enter'>Enter</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights a button and makes it current.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Enter</span> <span class='ruff_arg'>i ?focusin?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
<tr><td class='ruff_defitem'><code>focusin</code></td><td class='ruff_defitem'>yes, if the button is clicked and focused Optional, default <code>0</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_Enter' href="javascript:toggleSource('klnd_my_Enter')">Show source</a></p>
<div id='klnd_my_Enter' class='ruff_dyn_src'><pre>proc ::klnd::my::Enter {i {focusin 0}} {
    # Highlights a button and makes it current.
    #   i - button index
    #   focusin - yes, if the button is clicked and focused

    variable p
    if {![IsDay $i]} return
    Leave
    [set w [$p(obj) BuT_KLNDSTD$i]] configure -fg $p(fgsel) -bg $p(bgsel)
    set p(ienter) $i
    set p(dvis) [$w cget -text]
    catch {after cancel $p(after2)}
    set p(after2) [after 10 &quot;if \[winfo exists $w\] {focus -force $w}&quot;]
    if {$focusin &amp;&amp; $p(com) ne {}} {eval $p(com)}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::Enter2'>Enter2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights a button and makes it current.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Enter2</span> <span class='ruff_arg'>obj i ?focusin?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
<tr><td class='ruff_defitem'><code>focusin</code></td><td class='ruff_defitem'>yes, if the button is clicked and focused Optional, default <code>0</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_Enter2' href="javascript:toggleSource('klnd_my_Enter2')">Show source</a></p>
<div id='klnd_my_Enter2' class='ruff_dyn_src'><pre>proc ::klnd::my::Enter2 {obj i {focusin 0}} {
    # Highlights a button and makes it current.
    #   obj - index of calendar
    #   i - button index
    #   focusin - yes, if the button is clicked and focused

    variable p
    if {[catch {set isday [IsDay2 $obj $i]}]} {set isday no}
    if {!$isday} return
    set w [$p($obj) BuT$obj-${i}KLND]
    set p(dvis$obj) [$w cget -text]
    set date [FormatDay2 $obj $p(yvis$obj) $p(mvis$obj) $p(dvis$obj)]
    if {$focusin} {
      if {$p(daylist$obj) ne {-}} {
        # add/delete the date to/from the list of selected days
        if {[set di [lsearch -exact $p(daylist$obj) $date]]&gt;-1} {
          set p(daylist$obj) [lreplace $p(daylist$obj) $di $di]
          ShowMonth2 $obj $p(mvis$obj) $p(yvis$obj) no
          return
        } else {
          lappend p(daylist$obj) $date
        }
      }
    }
    ShowMonth2 $obj $p(mvis$obj) $p(yvis$obj) no
    if {$focusin} {
      set p(olddate$obj) $date
      if {$p(united$obj)} {
        # if calendars are linked with united, unselect previously selected COMMON day
        # and then highlight the current date
        catch {
          if {$p(daylist$obj) eq {-}} {
            $p(wunited) configure -fg $p(fg1) -bg $p(bg1)
          }
          if {[$p(wcurr$obj) cget -bg] ne $p(bgsel)} {
            set fg [fgMayHL $obj $p(fg2) $p(yvis$obj) $p(mvis$obj) $p(dvis$obj)]
            $p(wcurr$obj) configure -fg $fg -bg $p(bg2)
          }
        }
      }
    }
    set p(ienter) $i
    if {$p(tvar$obj) ne {}} {
      set $p(tvar$obj) $date
      if {$p(olddate$obj) eq $date} {
        if {$p(daylist$obj) ne {-}} {
          ShowMonth2 $obj $p(mvis$obj) $p(yvis$obj) no
        } else {
          catch {
            # unselect previously selected day of THIS month
            if {![HighlightCurrentDay2 $obj]} {
              $p(wunited$obj) configure -fg $p(fg1) -bg $p(bg1)
            }
          }
          # show selected day
          set fg [fgMayHL $obj $p(fgsel) $p(yvis$obj) $p(mvis$obj) $p(dvis$obj)]
          $w configure -fg $fg -bg $p(bgsel)
        }
        # save the selected widget for THIS month
        # and as COMMON for calendars linked with united
        set p(wunited$obj) $w
        if {$p(united$obj)} {set p(wunited) $w}
      }
    }
    if {$focusin &amp;&amp; $p(com$obj) ne {}} {
      eval [MapYMD $p(com$obj) $p(yvis$obj) $p(mvis$obj) $p(dvis$obj)]
    }
    HighlightCurrentDay2 $obj
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::fgMayHL'>fgMayHL</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a foreground color (possibly highlighting).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>fgMayHL</span> <span class='ruff_arg'>obj fg y m d</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>fg</code></td><td class='ruff_defitem'>default foreground color</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>year</td></tr>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>month</td></tr>
<tr><td class='ruff_defitem'><code>d</code></td><td class='ruff_defitem'>day</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_fgMayHL' href="javascript:toggleSource('klnd_my_fgMayHL')">Show source</a></p>
<div id='klnd_my_fgMayHL' class='ruff_dyn_src'><pre>proc ::klnd::my::fgMayHL {obj fg y m d} {
    # Gets a foreground color (possibly highlighting).
    #   fg - default foreground color
    #   y - year
    #   m - month
    #   d - day

    variable p
    foreach item $p(hllist$obj) {
      # date format for highlighting is %Y/%m/%d
      lassign [split [lindex $item 0] /] yh mh dh
      set dh [TrimN $dh]
      set mh [TrimN $mh]
      if {$y==$yh &amp;&amp; $m==$mh &amp;&amp; $d==$dh} {
        set fg red
        break
      }
    }
    return $fg
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::FormatDay2'>FormatDay2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a date formatted according to a current format.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>FormatDay2</span> <span class='ruff_arg'>obj y m d</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>year of the date</td></tr>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>month of the date</td></tr>
<tr><td class='ruff_defitem'><code>d</code></td><td class='ruff_defitem'>day of the date</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_FormatDay2' href="javascript:toggleSource('klnd_my_FormatDay2')">Show source</a></p>
<div id='klnd_my_FormatDay2' class='ruff_dyn_src'><pre>proc ::klnd::my::FormatDay2 {obj y m d} {
    # Gets a date formatted according to a current format.
    #   obj - index of calendar
    #   y - year of the date
    #   m - month of the date
    #   d - day of the date

    variable p
    return [clock format [clock scan $m/$d/$y -format %D] -format $p(dformat$obj) -locale $p(loc$obj)]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::GoMonth'>GoMonth</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shifts the month backward/forward.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>GoMonth</span> <span class='ruff_arg'>i ?dobreak?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>increment for the current month</td></tr>
<tr><td class='ruff_defitem'><code>dobreak</code></td><td class='ruff_defitem'>yes when called from 'bind' Optional, default <code>no</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_GoMonth' href="javascript:toggleSource('klnd_my_GoMonth')">Show source</a></p>
<div id='klnd_my_GoMonth' class='ruff_dyn_src'><pre>proc ::klnd::my::GoMonth {i {dobreak no}} {
    # Shifts the month backward/forward.
    #   i - increment for the current month
    #   dobreak - yes when called from 'bind'

    variable p
    set m [expr {$p(mvis)+($i)}]
    if {$m&gt;12} {set m 1; incr p(yvis)}
    if {$m&lt;1} {set m 12; incr p(yvis) -1}
    ShowMonth $m $p(yvis)
    if {$dobreak} {return -code break}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::GoMonth2'>GoMonth2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shifts the month backward/forward.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>GoMonth2</span> <span class='ruff_arg'>obj i ?dobreak?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>increment for the current month</td></tr>
<tr><td class='ruff_defitem'><code>dobreak</code></td><td class='ruff_defitem'>yes when called from 'bind' Optional, default <code>no</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_GoMonth2' href="javascript:toggleSource('klnd_my_GoMonth2')">Show source</a></p>
<div id='klnd_my_GoMonth2' class='ruff_dyn_src'><pre>proc ::klnd::my::GoMonth2 {obj i {dobreak no}} {
    # Shifts the month backward/forward.
    #   obj - index of calendar
    #   i - increment for the current month
    #   dobreak - yes when called from 'bind'

    variable p
    set m [expr {$p(mvis$obj)+($i)}]
    if {$m&gt;12} {set m 1; incr p(yvis$obj)}
    if {$m&lt;1} {set m 12; incr p(yvis$obj) -1}
    ShowMonth2 $obj $m $p(yvis$obj)
    if {$dobreak} {return -code break}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::GoYear'>GoYear</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shifts the year backward/forward.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>GoYear</span> <span class='ruff_arg'>i ?dobreak?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>increment for the current year</td></tr>
<tr><td class='ruff_defitem'><code>dobreak</code></td><td class='ruff_defitem'>yes when called from 'bind' Optional, default <code>no</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_GoYear' href="javascript:toggleSource('klnd_my_GoYear')">Show source</a></p>
<div id='klnd_my_GoYear' class='ruff_dyn_src'><pre>proc ::klnd::my::GoYear {i {dobreak no}} {
    # Shifts the year backward/forward.
    #   i - increment for the current year
    #   dobreak - yes when called from 'bind'

    variable p
    ShowMonth $p(mvis) [expr {$p(yvis)+($i)}]
    if {$dobreak} {return -code break}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::GoYear2'>GoYear2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shifts the year backward/forward.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>GoYear2</span> <span class='ruff_arg'>obj i ?dobreak?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>increment for the current year</td></tr>
<tr><td class='ruff_defitem'><code>dobreak</code></td><td class='ruff_defitem'>yes when called from 'bind' Optional, default <code>no</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_GoYear2' href="javascript:toggleSource('klnd_my_GoYear2')">Show source</a></p>
<div id='klnd_my_GoYear2' class='ruff_dyn_src'><pre>proc ::klnd::my::GoYear2 {obj i {dobreak no}} {
    # Shifts the year backward/forward.
    #   obj - index of calendar
    #   i - increment for the current year
    #   dobreak - yes when called from 'bind'

    variable p
    ShowMonth2 $obj $p(mvis$obj) [expr {$p(yvis$obj)+($i)}]
    if {$dobreak} {return -code break}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::HighlightCurrentDay'>HighlightCurrentDay</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights the current day's button.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightCurrentDay</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_HighlightCurrentDay' href="javascript:toggleSource('klnd_my_HighlightCurrentDay')">Show source</a></p>
<div id='klnd_my_HighlightCurrentDay' class='ruff_dyn_src'><pre>proc ::klnd::my::HighlightCurrentDay {} {
    # Highlights the current day's button.

    variable p
    catch {[$p(obj) BuT_KLNDSTD$p(icurr)] configure -fg $p(fg2) -bg $p(bg2)}
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::HighlightCurrentDay2'>HighlightCurrentDay2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights the current day's button.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightCurrentDay2</span> <span class='ruff_arg'>obj</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_HighlightCurrentDay2' href="javascript:toggleSource('klnd_my_HighlightCurrentDay2')">Show source</a></p>
<div id='klnd_my_HighlightCurrentDay2' class='ruff_dyn_src'><pre>proc ::klnd::my::HighlightCurrentDay2 {obj} {
    # Highlights the current day's button.
    #   obj - index of calendar

    variable p
    if {$p(currentmonth) eq &quot;$p(yvis$obj)/[TrimN $p(mvis$obj)]&quot;} {
      if {![info exists p(wcurr$obj)]} {
        catch {set p(wcurr$obj) [$p($obj) BuT$obj-$p(icurr$obj)KLND]}
      }
      catch {
        set day [$p(wcurr$obj) cget -text]
        if {[$p(wcurr$obj) cget -bg] ne $p(bgsel) &amp;&amp; [TrimN $day] ne {}} {
          set fg [fgMayHL $obj $p(fg2) $p(yvis$obj) $p(mvis$obj) $day]
          $p(wcurr$obj) configure -fg $fg -bg $p(bg2)
        }
        if {$p(united$obj)} {
          # if calendars are linked with united, one COMMON day selected for all
          set p(wcurrdate) $p(wcurr$obj)
        }
      }
      return [expr {[info exists p(wunited$obj)] &amp;&amp; [info exists p(wcurr$obj)] &amp;&amp;  $p(wunited$obj) eq $p(wcurr$obj)}]
    }
    return no
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::InitCalendar'>InitCalendar</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Initializes the settings of the calendar.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>InitCalendar</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_InitCalendar' href="javascript:toggleSource('klnd_my_InitCalendar')">Show source</a></p>
<div id='klnd_my_InitCalendar' class='ruff_dyn_src'><pre>proc ::klnd::my::InitCalendar {args} {
    # Initializes the settings of the calendar.

    variable p
    variable locales
    InitSettings
    lassign [::apave::parseOptions $args -locale [::msgcat::mclocale]  -title {} -value {} -tvar {} -parent {} -dateformat %D  -weekday {} -centerme {} -geometry {} -entry {} -com {} -command {}  -currentmonth {} -united no -daylist {-} -hllist {} -popup {} -tip {} -width 2]  loc title datevalue tvar parent p(dformat)  p(weekday) centerme geo entry com1 com2  p(currentmonth) p(united) p(daylist) p(hllist) p(popup) p(tip) p(width)
    if {$com2 eq {}} {set p(com) $com1} {set p(com) $com2}
    # get localized week day names
    lassign [::klnd::weekdays $loc] p(days) p(weekday)
    # get localized month names
    set p(months) [::klnd::months $loc]
    set p(loc) $loc
    set p(tvar) $tvar
    if {$tvar ne {}} {
      set datevalue [set $tvar]
    } elseif {$p(daylist) ne {-}} {
      set datevalue [lindex $p(daylist) 0]
    }
    catch {unset p(after)} ;# to pause more at start
    # colors to be used
    CurrentDate
    set p(yvis) $p(y)  ;# by default, the selected date = the current date
    set p(mvis) $p(m)
    set p(dvis) $p(d)
    if {$title eq {}} {set title [::msgcat::mc Calendar]}
    catch {set p(dformat) [subst $p(dformat)]}
    # get the day to display at start
    if {![catch {set ym [clock scan $datevalue -format $p(dformat)]}]} {
      set p(m) [clock format $ym -format %N]
      set p(y) [clock format $ym -format %Y]
      set p(dvis) [clock format $ym -format %e]
    }
    ::apave::obj untouchWidgets *KLND*
    return [list $title $datevalue $tvar $parent $centerme $geo $entry]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::InitSettings'>InitSettings</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets initial settings, once only.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>InitSettings</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_InitSettings' href="javascript:toggleSource('klnd_my_InitSettings')">Show source</a></p>
<div id='klnd_my_InitSettings' class='ruff_dyn_src'><pre>proc ::klnd::my::InitSettings {} {
    # Gets initial settings, once only.

    variable p
    variable msgdir
    array set p [list FINT %Y/%N/%e days {} months {}  d 0 m 0 y 0 dvis 0 mvis 0 yvis 0 icurr 0 ienter 0 weekday {}  d1st 1 width 2 loc en_uk]
    if {![info exists :klnd::my::prevY]} {
      foreach {i icon} {0 date 1 previous2 2 previous 3 next 4 next2} {
        image create photo IM_KLND_$i -data [::apave::iconData $icon small]
      }
      lassign [::apave::obj csGet] p(fg0) p(fg1) p(bg0) p(bg1) - p(bgsel) p(fgsel) - - p(fgh) - - - - p(fg2) p(bg2)
      # localized stuff
      catch {::msgcat::mcload $msgdir}
      set ::klnd::my::prevY [::msgcat::mc {Previous year}]
      set ::klnd::my::prevM [::msgcat::mc {Previous month}]
      set ::klnd::my::nextY [::msgcat::mc {Next year}]
      set ::klnd::my::nextM [::msgcat::mc {Next month}]
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::IsDay'>IsDay</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Check if a button shows a day.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>IsDay</span> <span class='ruff_arg'>i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_IsDay' href="javascript:toggleSource('klnd_my_IsDay')">Show source</a></p>
<div id='klnd_my_IsDay' class='ruff_dyn_src'><pre>proc ::klnd::my::IsDay {i} {
    # Check if a button shows a day.
    #   i - button index

    variable p
    return [expr {![catch {set w [$p(obj) BuT_KLNDSTD$i]}] &amp;&amp; [$w cget -takefocus]}]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::IsDay2'>IsDay2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Check if a button shows a day.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>IsDay2</span> <span class='ruff_arg'>obj i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_IsDay2' href="javascript:toggleSource('klnd_my_IsDay2')">Show source</a></p>
<div id='klnd_my_IsDay2' class='ruff_dyn_src'><pre>proc ::klnd::my::IsDay2 {obj i} {
    # Check if a button shows a day.
    #   obj - index of calendar
    #   i - button index

    variable p
    return [expr {![catch {set w [$p($obj) BuT$obj-${i}KLND]}] &amp;&amp;  [string length [TrimN [$w cget -text]]]}]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::KeyPress'>KeyPress</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Processes the key presses on buttons.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>KeyPress</span> <span class='ruff_arg'>i K</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index</td></tr>
<tr><td class='ruff_defitem'><code>K</code></td><td class='ruff_defitem'>pressed key</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_KeyPress' href="javascript:toggleSource('klnd_my_KeyPress')">Show source</a></p>
<div id='klnd_my_KeyPress' class='ruff_dyn_src'><pre>proc ::klnd::my::KeyPress {i K} {
    # Processes the key presses on buttons.
    #   i - button index
    #   K - pressed key

    variable p
    Leave $i
    switch -glob $K {
      Left {set n [expr {$i-1}]}
      Right {set n [expr {$i+1}]}
      Up {set n [expr {$i-7}]}
      Down {set n [expr {$i+7}]}
      Enter - Return - space {$p(obj) res $p(win) 1; return -code break}
      *Tab* {Leave; focus [$p(obj) But_KLNDCLOSE]; return -code break}
      default {Enter $i; return}
    }
    if {[IsDay $n]} {
      Enter $n
    } elseif {$K in {Left Up}} {
      GoMonth -1
    } else {
      GoMonth 1
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::Leave'>Leave</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Unhighlights a button.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Leave</span> <span class='ruff_arg'>?i?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>i</code></td><td class='ruff_defitem'>button index Optional, default <code>0</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_Leave' href="javascript:toggleSource('klnd_my_Leave')">Show source</a></p>
<div id='klnd_my_Leave' class='ruff_dyn_src'><pre>proc ::klnd::my::Leave {{i 0}} {
    # Unhighlights a button.
    #   i - button index

    variable p
    if {$i &amp;&amp; ![[$p(obj) BuT_KLNDSTD$i] cget -takefocus]} return
    foreach n [list $i $p(ienter)] {
      if {$n} {[$p(obj) BuT_KLNDSTD$n] configure -fg $p(fg1) -bg $p(bg1)}
    }
    HighlightCurrentDay
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::MainWidgets'>MainWidgets</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Forms main widgets of calendar.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MainWidgets</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_MainWidgets' href="javascript:toggleSource('klnd_my_MainWidgets')">Show source</a></p>
<div id='klnd_my_MainWidgets' class='ruff_dyn_src'><pre>proc ::klnd::my::MainWidgets {} {
    # Forms main widgets of calendar.

    variable p
    if {$p(tip) eq {}} {
      set ::klnd::TMPTIP {}
    } else {
      set tip [string map [list \{ ( \} )] $p(tip)] ;# for a possible bad list
      set ::klnd::TMPTIP &quot;-tip {$tip}&quot;
    }
    return {
      {fra - - 1 7 {-st new} {}}  {.frATool - - 1 7 {-st new} {-bg $::klnd::my::p(bg1)}}
      {.frATool.tool - - - - {pack -side top} {-array {
        IM_KLND_0 {::klnd::my::SetCurrentDay} sev 2
        IM_KLND_1 {{::klnd::my::GoYear -1} -tip &quot;$::klnd::my::prevY\n(Home)@@-under 5&quot;} h_ 1
        IM_KLND_2 {{::klnd::my::GoMonth -1} -tip &quot;$::klnd::my::prevM\n(PageUp)@@-under 5&quot;} h_ 2
        LabMonth {&quot;&quot; {-fill x -expand 1} {-anchor center -w 14}} h_ 1
        IM_KLND_3 {{::klnd::my::GoMonth 1} -tip &quot;$::klnd::my::nextM\n(PageDown)@@-under 5&quot;} h_ 2
        IM_KLND_4 {{::klnd::my::GoYear 1} -tip &quot;$::klnd::my::nextY\n(End)@@-under 5&quot;}
        }}}
      {.frADays .frATool T - - {-st nsew} {-bg $::klnd::my::p(bg1)}}
      {.frADays.tcl {
        # make headers and buttons of days
        if {$::tcl_platform(platform) eq {windows}} {
          set att {-highlightthickness 1}
        } else {
          set att {-highlightthickness 0}
        }
        set wt -
        for {set i 1} {$i&lt;50} {incr i} {
          if {$i&lt;8} {set cur &quot;.frADays.LabDay$i&quot;} {set cur &quot;.frADays.BuT_KLNDSTD[expr {$i-7}]&quot;}
          if {($i%7)!=1} {set p L; set pw $pr} {set p T; set pw $wt; set wt $cur}
          if {$i&lt;8} {
            set lwid &quot;$cur $pw $p 1 1 {-st ew} {-anchor center -foreground $::klnd::my::p(fgh) -background $::klnd::my::p(bg1)}&quot;
          } else {
            set lwid &quot;$cur $pw $p 1 1 {-st ew} {-relief flat -overrelief raised -takefocus 0 -padx 8 -pady 1 -font {$::apave::FONTMAIN} -com {::klnd::my::Enter [expr {$i-7}] 1} $::klnd::TMPTIP $att -w 2 -background $::klnd::my::p(bg1)}&quot;
          }
          %C $lwid
          set pr $cur
        }
      }}
    }
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::MainWidgets2'>MainWidgets2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Forms main widgets of calendar.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MainWidgets2</span> <span class='ruff_arg'>obj ownname</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>ownname</code></td><td class='ruff_defitem'>frame for calendar</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_MainWidgets2' href="javascript:toggleSource('klnd_my_MainWidgets2')">Show source</a></p>
<div id='klnd_my_MainWidgets2' class='ruff_dyn_src'><pre>proc ::klnd::my::MainWidgets2 {obj ownname} {
    # Forms main widgets of calendar.
    #   obj - index of calendar
    #   ownname - frame for calendar

    variable p
    set ::klnd::TMPTIP {}
    catch {
      if {$p(tip$obj) ne {}} {
        set tipcom [list $p(tip)] ;# possible bad list
        set ::klnd::TMPTIP  &quot;-tip { -BALTIP %W -COMMAND {::klnd::my::ButtonTip $obj {$tipcom} %w} }&quot;
      }
    }
    set p(tipF3$obj)  &quot;[::msgcat::mc {Current date}]:  [clock format [CurrentDate] -format $p(dformat$obj) -locale $p(loc$obj)]&quot;
    set res [list &quot;$ownname.laB - - 1 10 {-st nsew} {-bg $::klnd::my::p(bg1)}&quot;]
    # if calendars are united, no display of tool bar
    if {$p(united$obj)} {
      lappend res  &quot;$ownname.laB.LabMonth$obj - - - - {pack -fill x -expand 1} {-anchor center -w 18}&quot;
    } else {
      lappend res  &quot;$ownname.laB.tool - - - - {pack -side top} {-array {  IM_KLND_0 {{::klnd::my::SetCurrentDay2 $obj} -tip {$::klnd::my::p(tipF3$obj)@@-under 5}} sev 3  IM_KLND_1 {{::klnd::my::GoYear2 $obj -1} -tip {$::klnd::my::prevY\n(Home)@@-under 5}} h_ 1  IM_KLND_2 {{::klnd::my::GoMonth2 $obj -1} -tip {$::klnd::my::prevM\n(PageUp)@@-under 5}} h_ 2  LabMonth$obj {{} {-fill x -expand 1} {-anchor center -w 18}} h_ 1  IM_KLND_3 {{::klnd::my::GoMonth2 $obj 1} -tip {$::klnd::my::nextM\n(PageDown)@@-under 5}} h_ 2  IM_KLND_4 {{::klnd::my::GoYear2 $obj 1} -tip {$::klnd::my::nextY\n(End)@@-under 5}}  }}&quot;
    }
    lappend res &quot;$ownname.laBDays $ownname.laB T - - {-st nsew} {-bg $::klnd::my::p(bg1)}&quot;
    lappend res  [list $ownname.laBDays.tcl &quot;  set wt - ;  for {set i 1} {\$i&lt;50} {incr i} {  if {\$i&lt;8} {set cur $ownname.laBDays.LabDay$obj\$i} {set cur $ownname.laBDays.BuT$obj-\[expr {\$i-7}\]KLND} ;  if {(\$i%7)!=1} {set p L; set pw \$pr} {set p T; set pw \$wt; set wt \$cur} ;  if {\$i&lt;8} {  set lwid \&quot;\$cur \$pw \$p 1 1 {-st ew} {-anchor center -foreground $::klnd::my::p(fgh) -background $::klnd::my::p(bg1)}\&quot;  } else {  set lwid \&quot;\$cur \$pw \$p 1 1 {-st ew -pady 1} {-relief flat -overrelief raised -takefocus 0  -padx 8 -pady 0 -font {$::apave::FONTMAIN} -com {::klnd::my::Enter2 $obj \[expr {\$i-7}\]} $::klnd::TMPTIP -highlightthickness 0 -w $p(width) -background $::klnd::my::p(bg1)}\&quot;  } ;  %C \$lwid ;  set pr \$cur  }&quot;
      ]
    return $res
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::MapYMD'>MapYMD</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a script with %y, %m, %d wildcards.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MapYMD</span> <span class='ruff_arg'>script y m d</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>script</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code>d</code></td><td class='ruff_defitem'>Not documented.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_MapYMD' href="javascript:toggleSource('klnd_my_MapYMD')">Show source</a></p>
<div id='klnd_my_MapYMD' class='ruff_dyn_src'><pre>proc ::klnd::my::MapYMD {script y m d} {
    # Gets a script with %y, %m, %d wildcards.

    return [string map [list %y $y %m $m %d $d] $script]
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::SetCurrentDay'>SetCurrentDay</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Goes to the current date.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>SetCurrentDay</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_SetCurrentDay' href="javascript:toggleSource('klnd_my_SetCurrentDay')">Show source</a></p>
<div id='klnd_my_SetCurrentDay' class='ruff_dyn_src'><pre>proc ::klnd::my::SetCurrentDay {} {
    # Goes to the current date.

    variable p
    set p(dvis) 0
    ShowMonth $p(m) $p(y)
    Enter $p(icurr)
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::SetCurrentDay2'>SetCurrentDay2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Goes to the current date.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>SetCurrentDay2</span> <span class='ruff_arg'>obj</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_SetCurrentDay2' href="javascript:toggleSource('klnd_my_SetCurrentDay2')">Show source</a></p>
<div id='klnd_my_SetCurrentDay2' class='ruff_dyn_src'><pre>proc ::klnd::my::SetCurrentDay2 {obj} {
    # Goes to the current date.
    #   obj - index of calendar

    variable p
    set p(dvis$obj) 0
    ShowMonth2 $obj $p(m) $p(y)
    Enter2 $obj $p(icurr$obj) 1
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::ShowMonth'>ShowMonth</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Displays a month's days.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>ShowMonth</span> <span class='ruff_arg'>m y</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>month y -year</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>Not documented.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_ShowMonth' href="javascript:toggleSource('klnd_my_ShowMonth')">Show source</a></p>
<div id='klnd_my_ShowMonth' class='ruff_dyn_src'><pre>proc ::klnd::my::ShowMonth {m y} {
    # Displays a month's days.
    #   m - month
    #   y -year

    variable p
    set sec [CurrentDate]
    set y [expr {max($y,1753)}]
    ::baltip::tip [$p(obj) BuT_IM_KLND_0]  &quot;[::msgcat::mc {Current date}]: [clock format $sec -format $p(dformat) -locale $p(loc)]\n(F3)&quot; -under 5
    # display month &amp; year
    [$p(obj) LabMonth] configure -text  &quot;[lindex $p(months) [expr {$m-1}]] $y&quot;  -font [::apave::obj boldDefFont [expr {[::apave::obj basicFontSize]+2}]]
    # display day names
    for {set i 1} {$i&lt;8} {incr i} {
      [$p(obj) LabDay$i] configure -text &quot; [lindex $p(days) $i-1] &quot;
    }
    # 1st day of the month's first week:
    set i0 [clock format [clock scan &quot;$m/1/$y&quot; -format %D] -format %w]
    if {$p(weekday) eq &quot;%u&quot;} {if {$i0} {incr i0 -1} {set i0 6}}
    # get the last day of month
    if {[set yl $y] &amp;&amp; [set ml $m]==12} {set ml 1; incr yl}
    set lday [clock format [clock scan &quot;[incr ml]/1/$yl 1 day ago&quot;] -format %d]
    set iday [set p(icurr) 0]
    for {set i 1} {$i&lt;43} {incr i} {
      if {$i&lt;=$i0 || $iday&gt;=$lday} {
        set att &quot;-takefocus 0 -text {    } -activebackground $p(bg1) -overrelief flat&quot;
      } else {
        set att &quot;-takefocus 1 -text {[incr iday]} -activeforeground $p(fg0) -activebackground $p(bg0) -overrelief raised&quot;
        if {$iday==$p(dvis) || ($iday==$lday &amp;&amp; $iday&lt;$p(dvis))} {
          if {[info exists p(after)]} {set af 20} {set af 200} ;# less at key pressing tight
          catch {after cancel $p(after)}
          set p(after) [after $af &quot;::klnd::my::Enter $i; ::klnd::my::HighlightCurrentDay&quot;]
        }
        if {$iday==1} {set p(d1st) $i}
        if {$y==$p(y) &amp;&amp; $m==$p(m) &amp;&amp; $iday==$p(d)} {
          set p(icurr) $i  ;# button's index of the current date
        }
      }
      [$p(obj) BuT_KLNDSTD$i] configure {*}$att -fg $p(fg1) -bg $p(bg1) -relief flat
    }
    set p(mvis) $m  ;# month &amp; year currently visible
    set p(yvis) $y
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::ShowMonth2'>ShowMonth2</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Displays a month's days.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>ShowMonth2</span> <span class='ruff_arg'>obj m y ?doenter? ?dopopup?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>obj</code></td><td class='ruff_defitem'>index of calendar</td></tr>
<tr><td class='ruff_defitem'><code>m</code></td><td class='ruff_defitem'>month</td></tr>
<tr><td class='ruff_defitem'><code>y</code></td><td class='ruff_defitem'>year</td></tr>
<tr><td class='ruff_defitem'><code>doenter</code></td><td class='ruff_defitem'>yes, if perform Enter2 proc Optional, default <code>yes</code>.</td></tr>
<tr><td class='ruff_defitem'><code>dopopup</code></td><td class='ruff_defitem'>yes, if bind a popup menu Optional, default <code>no</code>.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_ShowMonth2' href="javascript:toggleSource('klnd_my_ShowMonth2')">Show source</a></p>
<div id='klnd_my_ShowMonth2' class='ruff_dyn_src'><pre>proc ::klnd::my::ShowMonth2 {obj m y {doenter yes} {dopopup no}} {
    # Displays a month's days.
    #   obj - index of calendar
    #   m - month
    #   y - year
    #   doenter - yes, if perform Enter2 proc
    #   dopopup - yes, if bind a popup menu

    variable p
    set y [expr {max($y,[::klnd::minYear])}]
    set m [TrimN $m]
    # if calendars are linked with united, no display of year in a title
    if {$p(united$obj)} {set yd {}} {set yd &quot; $y&quot;}
    [$p($obj) LabMonth$obj] configure -text  &quot;[lindex $p(months$obj) [expr {$m-1}]]$yd&quot;  -font [::apave::obj boldDefFont [expr {[::apave::obj basicFontSize]+2}]]
    # highlight color
    set hlcolor red ;#[lindex [::apave::obj csGet] 17]
    # display day names
    for {set i 1} {$i&lt;8} {incr i} {
      [$p($obj) LabDay$obj$i] configure -text &quot; [lindex $p(days$obj) $i-1]&quot;
    }
    # 1st day of the month's first week:
    set i0 [clock format [clock scan &quot;$m/1/$y&quot; -format %D] -format %w]
    if {$p(weekday$obj) eq {%u}} {if {$i0} {incr i0 -1} {set i0 6}}
    # get the last day of month
    if {[set yl $y] &amp;&amp; [set ml $m]==12} {set ml 1; incr yl}
    set lday [clock format [clock scan &quot;[incr ml]/1/$yl 1 day ago&quot;] -format %d]
    set iday [set p(icurr$obj) 0]
    for {set i 1} {$i&lt;43} {incr i} {
      set fg $p(fg1)
      set bg $p(bg1)
      set wbut [$p($obj) BuT$obj-${i}KLND]
      if {$i&lt;=$i0 || $iday&gt;=$lday} {
        set att &quot;-takefocus 0 -text {   } -activebackground $p(bg1) -overrelief flat&quot;
        set script {}
      } else {
        set att &quot;-takefocus 0 -text {[incr iday]} -activeforeground $p(fg0) -activebackground $p(bg0) -overrelief raised&quot;
        if {$doenter &amp;&amp; ($iday==$p(dvis$obj) || ($iday==$lday &amp;&amp; $iday&lt;$p(dvis$obj)))} {
          catch {after cancel $p(after$obj)}
          set p(after$obj) [after idle &quot;::klnd::my::Enter2 $obj $i&quot;]
        }
        if {$iday==1} {set p(d1st) $i}
        if {$y==$p(y) &amp;&amp; $m==$p(m) &amp;&amp; $iday==$p(d)} {
          set p(icurr$obj) $i  ;# button's index of the current date
        }
        set dt [FormatDay2 $obj $y $m $iday]
        if {[lsearch -exact $p(daylist$obj) $dt]&gt;-1} {
          set fg $p(fgsel)
          set bg $p(bgsel)
        } elseif {$p(currentdate) eq &quot;$y/$m/$iday&quot;} {
          set fg $p(fg2)
          set bg $p(bg2)
        }
        if {$dopopup} {
          set script [MapYMD $p(popup$obj) $y $m $iday]
        }
      }
      if {$dopopup &amp;&amp; $p(popup$obj) ne {}} {
        bind $wbut &lt;Button-3&gt; $script
      }
      # as last refuge: highlighting fg by hllist
      set fg [fgMayHL $obj $fg $y $m $iday]
      $wbut configure {*}$att -relief flat -fg $fg -bg $bg
    }
    set p(mvis$obj) $m  ;# month &amp; year currently visible
    set p(yvis$obj) $y
}</pre></div>
</div><h4 class='ruffproc'><a name='::klnd::my::TrimN'>TrimN</a><span class='ns_scope'> [<a href="klnd.html#::klnd::my" title="::klnd::my" class='ruff_cmd'>::klnd::my</a>]</span><span class='tinylink'><a href='klnd.html#::klnd::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Strips day/month of leading 0 and space.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>TrimN</span> <span class='ruff_arg'>n</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>n</code></td><td class='ruff_defitem'>day/month</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_klnd_my_TrimN' href="javascript:toggleSource('klnd_my_TrimN')">Show source</a></p>
<div id='klnd_my_TrimN' class='ruff_dyn_src'><pre>proc ::klnd::my::TrimN {n} {
    # Strips day/month of leading 0 and space.
    #   n - day/month

    return [string trimleft $n { 0}]
}</pre></div>
</div></div></div><div class='yui-b navbox' ><h1><a href='#::klnd'>klnd</a></h1><h2><a href='#::klnd-Usage in apave package'>Usage in apave package</a></h2><h2><a href='#::klnd-Commands'>Commands</a></h2><h4 class='tooltip'><a href='klnd.html#::klnd::blinking'>blinking</a><span class='tooltiptext'>Makes a calendar label blink.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::calendar'>calendar</a><span class='tooltiptext'>The main procedure of the calendar's toplevel.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::calendar2'>calendar2</a><span class='tooltiptext'>The main procedure of the calendar embedded widget.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::clearArgs'>clearArgs</a><span class='tooltiptext'>Removes specific options from args.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::clearup'>clearup</a><span class='tooltiptext'>Clearance for klnd data (variable my::p).
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::currentYearMonthDay'>currentYearMonthDay</a><span class='tooltiptext'>Gets current year, month, day. Return a list of  current year, month, day.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::getDaylist'>getDaylist</a><span class='tooltiptext'>Gets a day list which was set initially and possibly changed by a user.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::labelPath'>labelPath</a><span class='tooltiptext'>Gets a title label path.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::maxYear'>maxYear</a><span class='tooltiptext'>Gets maximal year that is correct.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::minYear'>minYear</a><span class='tooltiptext'>Gets minimal year that is correct.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::months'>months</a><span class='tooltiptext'>Gets a list of months according to a locale.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::selectedDay'>selectedDay</a><span class='tooltiptext'>Gets a selected day.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::update'>update</a><span class='tooltiptext'>Redraws a calendar.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::weekdays'>weekdays</a><span class='tooltiptext'>Gets a list of week days according to a locale.
</span></h4><h1><a href='#::klnd::my'>klnd::my</a></h1><h2><a href='#::klnd::my-Commands'>Commands</a></h2><h4 class='tooltip'><a href='klnd.html#::klnd::my::BindButtons2'>BindButtons2</a><span class='tooltiptext'>Binds events to buttons of a calendar.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::ButtonTip'>ButtonTip</a><span class='tooltiptext'>Gets a button's tip.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::CurrentDate'>CurrentDate</a><span class='tooltiptext'>Gets the current date.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::DefaultLocale'>DefaultLocale</a><span class='tooltiptext'>Gets a default locale currently used in a system.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::DoubleClick'>DoubleClick</a><span class='tooltiptext'>Processes double-clicking a button (to choose or ignore).
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::Enter'>Enter</a><span class='tooltiptext'>Highlights a button and makes it current.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::Enter2'>Enter2</a><span class='tooltiptext'>Highlights a button and makes it current.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::fgMayHL'>fgMayHL</a><span class='tooltiptext'>Gets a foreground color (possibly highlighting).
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::FormatDay2'>FormatDay2</a><span class='tooltiptext'>Gets a date formatted according to a current format.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::GoMonth'>GoMonth</a><span class='tooltiptext'>Shifts the month backward/forward.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::GoMonth2'>GoMonth2</a><span class='tooltiptext'>Shifts the month backward/forward.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::GoYear'>GoYear</a><span class='tooltiptext'>Shifts the year backward/forward.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::GoYear2'>GoYear2</a><span class='tooltiptext'>Shifts the year backward/forward.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::HighlightCurrentDay'>HighlightCurrentDay</a><span class='tooltiptext'>Highlights the current day's button.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::HighlightCurrentDay2'>HighlightCurrentDay2</a><span class='tooltiptext'>Highlights the current day's button.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::InitCalendar'>InitCalendar</a><span class='tooltiptext'>Initializes the settings of the calendar.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::InitSettings'>InitSettings</a><span class='tooltiptext'>Gets initial settings, once only.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::IsDay'>IsDay</a><span class='tooltiptext'>Check if a button shows a day.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::IsDay2'>IsDay2</a><span class='tooltiptext'>Check if a button shows a day.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::KeyPress'>KeyPress</a><span class='tooltiptext'>Processes the key presses on buttons.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::Leave'>Leave</a><span class='tooltiptext'>Unhighlights a button.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::MainWidgets'>MainWidgets</a><span class='tooltiptext'>Forms main widgets of calendar.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::MainWidgets2'>MainWidgets2</a><span class='tooltiptext'>Forms main widgets of calendar.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::MapYMD'>MapYMD</a><span class='tooltiptext'>Gets a script with %y, %m, %d wildcards.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::SetCurrentDay'>SetCurrentDay</a><span class='tooltiptext'>Goes to the current date.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::SetCurrentDay2'>SetCurrentDay2</a><span class='tooltiptext'>Goes to the current date.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::ShowMonth'>ShowMonth</a><span class='tooltiptext'>Displays a month's days.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::ShowMonth2'>ShowMonth2</a><span class='tooltiptext'>Displays a month's days.
</span></h4><h4 class='tooltip'><a href='klnd.html#::klnd::my::TrimN'>TrimN</a><span class='tooltiptext'>Strips day/month of leading 0 and space.
</span></h4></div></div><div id='ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div></div>
</div></body></html>
