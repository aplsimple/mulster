<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>mulster reference</title>
<style>
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
html{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var,optgroup{font-style:inherit;font-weight:inherit;}del,ins{text-decoration:none;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup{vertical-align:baseline;}sub{vertical-align:baseline;}legend{color:#000;}input,button,textarea,select,optgroup,option{font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;}input,button,textarea,select{*font-size:100%;}body{font:13px/1.231 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small;}select,input,button,textarea,button{font:99% arial,helvetica,clean,sans-serif;}table{font-size:inherit;font:100%;}pre,code,kbd,samp,tt{font-family:monospace;*font-size:108%;line-height:100%;}body{text-align:center;}#doc,#doc2,#doc3,#doc4,.yui-t1,.yui-t2,.yui-t3,.yui-t4,.yui-t5,.yui-t6,.yui-t7{margin:auto;text-align:left;width:57.69em;*width:56.25em;}#doc2{width:73.076em;*width:71.25em;}#doc3{margin:auto 10px;width:auto;}#doc4{width:74.923em;*width:73.05em;}.yui-b{position:relative;}.yui-b{_position:static;}#yui-main .yui-b{position:static;}#yui-main,.yui-g .yui-u .yui-g{width:100%;}.yui-t1 #yui-main,.yui-t2 #yui-main,.yui-t3 #yui-main{float:right;margin-left:-25em;}.yui-t4 #yui-main,.yui-t5 #yui-main,.yui-t6 #yui-main{float:left;margin-right:-25em;}.yui-t1 .yui-b{float:left;width:12.30769em;*width:12.00em;}.yui-t1 #yui-main .yui-b{margin-left:13.30769em;*margin-left:13.05em;}.yui-t2 .yui-b{float:left;width:13.8461em;*width:13.50em;}.yui-t2 #yui-main .yui-b{margin-left:14.8461em;*margin-left:14.55em;}.yui-t3 .yui-b{float:left;width:23.0769em;*width:22.50em;}.yui-t3 #yui-main .yui-b{margin-left:24.0769em;*margin-left:23.62em;}.yui-t4 .yui-b{float:right;width:13.8456em;*width:13.50em;}.yui-t4 #yui-main .yui-b{margin-right:14.8456em;*margin-right:14.55em;}.yui-t5 .yui-b{float:right;width:18.4615em;*width:18.00em;}.yui-t5 #yui-main .yui-b{margin-right:19.4615em;*margin-right:19.125em;}.yui-t6 .yui-b{float:right;width:23.0769em;*width:22.50em;}.yui-t6 #yui-main .yui-b{margin-right:24.0769em;*margin-right:23.62em;}.yui-t7 #yui-main .yui-b{display:block;margin:0 0 1em 0;}#yui-main .yui-b{float:none;width:auto;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf,.yui-gc .yui-u,.yui-gd .yui-g,.yui-g .yui-gc .yui-u,.yui-ge .yui-u,.yui-ge .yui-g,.yui-gf .yui-g,.yui-gf .yui-u{float:right;}.yui-g div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first,.yui-ge div.first,.yui-gf div.first,.yui-g .yui-gc div.first,.yui-g .yui-ge div.first,.yui-gc div.first div.first{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf{width:49.1%;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{width:32%;margin-left:1.99%;}.yui-gb .yui-u{*margin-left:1.9%;*width:31.9%;}.yui-gc div.first,.yui-gd .yui-u{width:66%;}.yui-gd div.first{width:32%;}.yui-ge div.first,.yui-gf .yui-u{width:74.2%;}.yui-ge .yui-u,.yui-gf div.first{width:24%;}.yui-g .yui-gb div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first{margin-left:0;}.yui-g .yui-g .yui-u,.yui-gb .yui-g .yui-u,.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u,.yui-ge .yui-g .yui-u,.yui-gf .yui-g .yui-u{width:49%;*width:48.1%;*margin-left:0;}.yui-g .yui-g .yui-u{width:48.1%;}.yui-g .yui-gb div.first,.yui-gb .yui-gb div.first{*margin-right:0;*width:32%;_width:31.7%;}.yui-g .yui-gc div.first,.yui-gd .yui-g{width:66%;}.yui-gb .yui-g div.first{*margin-right:4%;_margin-right:1.3%;}.yui-gb .yui-gc div.first,.yui-gb .yui-gd div.first{*margin-right:0;}.yui-gb .yui-gb .yui-u,.yui-gb .yui-gc .yui-u{*margin-left:1.8%;_margin-left:4%;}.yui-g .yui-gb .yui-u{_margin-left:1.0%;}.yui-gb .yui-gd .yui-u{*width:66%;_width:61.2%;}.yui-gb .yui-gd div.first{*width:31%;_width:29.5%;}.yui-g .yui-gc .yui-u,.yui-gb .yui-gc .yui-u{width:32%;_float:right;margin-right:0;_margin-left:0;}.yui-gb .yui-gc div.first{width:66%;*float:left;*margin-left:0;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf .yui-u{margin:0;}.yui-gb .yui-gb .yui-u{_margin-left:.7%;}.yui-gb .yui-g div.first,.yui-gb .yui-gb div.first{*margin-left:0;}.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u{*width:48.1%;*margin-left:0;}.yui-gb .yui-gd div.first{width:32%;}.yui-g .yui-gd div.first{_width:29.9%;}.yui-ge .yui-g{width:24%;}.yui-gf .yui-g{width:74.2%;}.yui-gb .yui-ge div.yui-u,.yui-gb .yui-gf div.yui-u{float:right;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf div.first{float:left;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf div.first{*width:24%;_width:20%;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf .yui-u{*width:73.5%;_width:65.5%;}.yui-ge div.first .yui-gd .yui-u{width:65%;}.yui-ge div.first .yui-gd div.first{width:32%;}#hd:after,#bd:after,#ft:after,.yui-g:after,.yui-gb:after,.yui-gc:after,.yui-gd:after,.yui-ge:after,.yui-gf:after{content:".";display:block;height:0;clear:both;visibility:hidden;}#hd,#bd,#ft,.yui-g,.yui-gb,.yui-gc,.yui-gd,.yui-ge,.yui-gf{zoom:1;}

body{margin:10px;}h1{font-size:138.5%;}h2{font-size:123.1%;}h3{font-size:108%;}h1,h2,h3{margin:1em 0;}h1,h2,h3,h4,h5,h6,strong,dt{font-weight:bold;}optgroup{font-weight:normal;}abbr,acronym{border-bottom:1px dotted #000;cursor:help;}em{font-style:italic;}del{text-decoration:line-through;}blockquote,ul,ol,dl{margin:1em;}ol,ul,dl{margin-left:2em;}ol li{list-style:decimal outside;}ul li{list-style:disc outside;}dl dd{margin-left:1em;}th,td{border:1px solid #000;padding:.5em;}th{font-weight:bold;text-align:center;}caption{margin-bottom:.5em;text-align:center;}sup{vertical-align:super;}sub{vertical-align:sub;}p,fieldset,table,pre{margin-bottom:1em;}button,input[type="checkbox"],input[type="radio"],input[type="reset"],input[type="submit"]{padding:1px;}


/* Ruff default CSS */

body {
  max-width: 70em;
  margin: 0;
}

h1,h2 {
  color: #888888;
  margin-bottom: 0.5em;
  margin-top: 0em;
}

#ft {
  text-align: left;
  border-top: 1px solid #006666;
  color: #888888;
  margin-top: 10px;
}

.banner h2 {
  color: #006666;
}

#hd.banner {
 font-family: "Times New Roman", serif;
 font-size: 200%;
 line-height: 64px;
 border-bottom: thin solid #006666;
 color: #006666;
}

p.linkline {
    text-align: right;
    font-size: smaller;
    /*    margin-top: -1em; */
    margin-bottom: 0;
}

.tinylink {
    font-size: x-small;
    font-variant: normal;
    font-family: Arial, sans-serif;
    float: right;
    padding:2px;
}

h1 .tinylink a {
    color: white;
}

#bd {
font-family: Arial, sans-serif;
font-size: 108%;
}

div.navbox {
  /* margin-top: 1em; */
    background-color: #006666;
    color: white;
    padding: 3px 4px 2px 4px;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

div.navbox:hover {
    overflow: visible;
}

/* Note .navbox header css should be based on $header_levels */
.navbox h1, .navbox h2, .navbox h3, .navbox h4, .navbox h5 {
  font-size: 85%;
  margin: 0px;
  font-weight: normal;
}
.navbox h1 {
    font-weight: bold; /* Override */
}
.navbox h2 {
  padding-left: 1em;
}
.navbox h3 {
  padding-left: 2em;
}
.navbox h4 {
  padding-left: 2.5em;
  font-weight: normal;
}
.navbox h5 {
  padding-left: 3em;
  font-weight: normal;
}
.navbox hr {
  color: white;
  margin-top:0.1em;
  margin-bottom:0.1em;
}

.navbox a:link, .navbox a:visited, .navbox a:hover {
  text-decoration: none;
  color: white;
  background-color: #006666;
}

.navbox a:hover {
   font-weight: bold;
}

/* Tooltip text - see https://www.w3schools.com/css/css_tooltip.asp */
.tooltip {
    position: relative;
    /* display: inline-block; */
}

.tooltip .tooltiptext {
    width: 100%;
    font-weight: bold;
    background-color: white;
    color: #006666;
    text-align: left;
    border: 1px solid #006666;
    /* border-radius: 4px; */
    position: absolute;
    z-index: 1;
    margin-left: 4px;
    padding: 2px 3px;
    visibility: hidden;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
    visibility: visible;
}

span.ns_scope {
    color: #aaaaaa;
}

span.ns_scope a:link, span.ns_scope a:visited {
  text-decoration: none;
  color: #aaaaaa;

}

li {
  margin-top: 0.5em;
}

span.ns_scope a:hover {
  text-decoration: none;
  color: #666666;
}

table {
  margin: 1em;
  margin-top: 0.5em;
  border: thin solid;
  border-collapse: collapse;
  border-color: #808080;
  padding: 4px;
}

td {
  border: thin solid;
  border-color: #808080;
  vertical-align: top;
  font-size: 93%;
  padding: 0.3em;
  padding-top: 0.1em;
}
th {
  border: thin solid;
  border-color: #808080;
  padding: 0.3em;
  padding-top: 0.1em;
  background-color: #CCCCCC;
}

dt, dd {
   font-size: 93%;
}

h1.ruff {
    background-color: #006666;
    color: #ffffff;
    padding-left: 0.2em;
    font-family: "Times New Roman", serif;
}
h2.ruff {
    font-variant: small-caps;
    color: #006666;
    font-family: "Times New Roman", serif;
}

h3.ruff, h4.ruff, h5.ruff, h6.ruff {
    color: #006666;
}
h5.ruff {
    font-style: italic;
    font-weight: normal;
}
h6.ruff {
    font-weight: normal;
}
h3.ruffclass, h3.ruffproc, h3.ruffmethod,
h4.ruffclass, h4.ruffproc, h4.ruffmethod,
h5.ruffclass, h5.ruffproc, h5.ruffmethod {
    border-bottom: thin solid #006666;
    color: #006666;
    margin-bottom: 0.2em;
}

pre {
    background-color: #eeeeee;
    margin-top: 1em;
    margin-left: 1em;
    padding: 5px;
    font-family: Consolas, "Courier New", monospace;
    width: max-content;
    font-size: smaller;
    line-height: 1.2em;
}

.ruff_dyn_src {
    display: none; /* Displayed via JS */
}

.ruff_synopsis {
    border: thin solid #cccccc;
    background: #eeeeee;
    font-size: smaller;
    font-family: Consolas, "Courier New", monospace;
    padding: 5px;
    margin: 0em 2em 1em;
}
.ruff_const, .ruff_cmd, ruff_defitem {
    font-weight: bold;
    font-family: Consolas, "Courier New", monospace;
}
.ruff_arg {
    font-style: italic;
    font-family: Consolas, "Courier New", monospace;
}

.ruff_source_link {
    font-size: smaller;
}

.ruff_index {
    font-size: small;
    color: grey;
    line-height: 1;
}

.ruff_index ul li {
    list-style-type: none;
}

.ruff_index ul li a {
    text-decoration: none;
}
</style>
<script>function toggleSource( id )
{
    /* Copied from Rails */
    var elem
    var link

    if( document.getElementById )
    {
        elem = document.getElementById( id )
        link = document.getElementById( "l_" + id )
    }
    else if ( document.all )
    {
        elem = eval( "document.all." + id )
        link = eval( "document.all.l_" + id )
    }
    else
        return false;

    if( elem.style.display == "block" )
    {
        elem.style.display = "none"
        link.innerHTML = "Show source"
    }
    else
    {
        elem.style.display = "block"
        link.innerHTML = "Hide source"
    }
}
</script></head>
<body><div id='doc3' class='yui-t2'><div id='hd' class='banner'>
<a style='text-decoration:none;' href='mulster.html'>mulster reference</a>
</div>
<div id='bd'><div id='yui-main'><div class='yui-b'><h1 class='ruff'><a name='::mulster'></a>::mulster<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>This little thing provides multi-line replacements in text files.</p>
<p class='ruff'>It's called this way:</p>
<pre class='ruff'>
tclsh mulster.tcl [options] fileini
</pre>
<p class='ruff'>where:</p>
<p class='ruff'><code>fileini</code> is a name of file containing options for replacements, e.g.</p>
<pre class='ruff'>
INFILE=input file name.txt
OUTFILE=output file name.txt
IN=BEGIN(1,1)
  line #1 to find
  line #2 to find
IN=END
OUT=BEGIN
  line #1
OUT=END
</pre>
<p class='ruff'><code>options</code> are:</p>
<pre class='ruff'>
-infile input-file-name
-outfile output-file-name
-mode exact | exact0 | glob | regexp
-backup 0 | &lt;dir&gt;
-keep 0 | 1 | false | true
-single 0 | 1 | false | true
-files 0 | 1 | false | true
-charset charsetName (e.g. cp1251)
-lineend lineEnding (e.g. \r\n)
--
</pre>
<p class='ruff'>See README for details.</p>
<p class='ruff'>The <code>mulster::Mulster</code> class provides two methods to be called from Tcl module.</p>
<p class='ruff'>1. The <code>main</code> method performs the multi-line replacements. Declared as:</p>
<pre class='ruff'>
method main {fileini {mode 1} {backup BAK} {keep 0} {single 0} {charset &quot;&quot;} {lineend &quot;&quot;} {files 0}}
</pre>
<p class='ruff'>where:</p>
<p class='ruff'><code>fileini</code> is a file name of options</p>
<p class='ruff'><code>mode = 0</code> (exact0, EXACT0) to match exact, without leading/tailing spaces</p>
<p class='ruff'><code>mode = 1</code> (exact, EXACT) to match exact, with all their leading/tailing spaces</p>
<p class='ruff'><code>mode = 2</code> (glob, GLOB) to match glob pattern</p>
<p class='ruff'><code>mode = 3</code> (regexp, re, REGEXP, RE) to match regexp pattern</p>
<p class='ruff'><code>mode = regexp--</code> to match regexp pattern and call <code>regsub</code></p>
<pre class='ruff'>
 Note: IN= line is to be found, OUT= line is to substitute, according to the regexp syntax accepted in Tcl.

 Note: With regexp and regsub, only one line is of use to IN=/OUT= block.
</pre>
<p class='ruff'><code>mode = regexp-all</code> to match regexp pattern and call <code>regsub -all</code></p>
<p class='ruff'><code>mode = regexp-nocase</code> to match regexp pattern and call <code>regsub -nocase</code></p>
<p class='ruff'><code>mode = regexp-expanded</code> to match regexp pattern and call <code>regsub -expanded</code></p>
<p class='ruff'>regexp <code>mode</code> can be combined, e.g. &quot;regexp-all-nocase&quot;</p>
<p class='ruff'><code>backup 0</code> means no input files' backuping</p>
<p class='ruff'><code>backup dir</code> means backuping to <em>dir</em> directory</p>
<p class='ruff'><code>keep</code>  if 1, keeps input files' attributes/times in output files</p>
<p class='ruff'><code>single</code> if 1, sets a standard string-for-string replacements</p>
<p class='ruff'><code>charset</code> is a charset of input files, e.g. cp1251</p>
<p class='ruff'><code>lineend</code> sets characters to end lines, e.g. \r\n (by default \n)</p>
<p class='ruff'><code>files</code> if 1, OUT= lines to be file names to take the lines from</p>
<p class='ruff'>2. The <code>mulsterList</code> method performs in-memory replacements in a list. Declared as:</p>
<pre class='ruff'>
method mulsterList {lcont lin lout {r1 0} {r2 0} {mode 1} {single 0} {files 0}}
</pre>
<p class='ruff'>where:</p>
<p class='ruff'><code>lcont</code> is a list to be processed</p>
<p class='ruff'><code>lin</code> is a list of input lines (replaced)</p>
<p class='ruff'><code>lout</code> is a list of output lines (replacing)</p>
<p class='ruff'><code>r1</code> and <code>r2</code> set a range of replacements</p>
<p class='ruff'><code>mode</code> is a search mode (as defined in getSearchMode method)</p>
<p class='ruff'><code>single</code> if true, means a standard 'string for string' replacements</p>
<p class='ruff'><code>files</code>  if true, output lines are taken from files</p>
<p class='ruff'>The <code>mulsterList</code> method returns a list processed.</p>
<h2 class='ruff'><a name='::mulster-Commands'></a>Commands<span class='tinylink'><a href='mulster.html#::mulster'>mulster</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h4 class='ruffproc'><a name='::mulster::synopsis'>synopsis</a><span class='ns_scope'> [<a href="mulster.html#::mulster" title="::mulster" class='ruff_cmd'>::mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster'>mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Puts a synopsis of mulster utility.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>synopsis</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_1' href="javascript:toggleSource('1')">Show source</a></p>
<div id='1' class='ruff_dyn_src'><pre>proc ::mulster::synopsis {} {


    # Puts a synopsis of mulster utility.

    variable _ruff_preamble
    puts $_ruff_preamble
}</pre></div>
</div><h2 class='ruff'><a name='::mulster-Classes'></a>Classes<span class='tinylink'><a href='mulster.html#::mulster'>mulster</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<h3 class='ruffclass'><a name='::mulster::Mulster'>Mulster</a><span class='ns_scope'> [<a href="mulster.html#::mulster" title="::mulster" class='ruff_cmd'>::mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster'>mulster</a>, <a href='#top'>Top</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><a href="mulster.html#::mulster::Mulster::getBoolean" title="getBoolean" class='ruff_cmd'>getBoolean</a></td><td class='ruff_defitem'>Checks and gets a boolean value.</td></tr>
<tr><td class='ruff_defitem'><a href="mulster.html#::mulster::Mulster::getSearchMode" title="getSearchMode" class='ruff_cmd'>getSearchMode</a></td><td class='ruff_defitem'>Gets a search mode as numeric from string.</td></tr>
<tr><td class='ruff_defitem'><a href="mulster.html#::mulster::Mulster::init" title="init" class='ruff_cmd'>init</a></td><td class='ruff_defitem'>Initializes processing files.</td></tr>
<tr><td class='ruff_defitem'><a href="mulster.html#::mulster::Mulster::main" title="main" class='ruff_cmd'>main</a></td><td class='ruff_defitem'>Processes files according to the options of 'fileini' file.</td></tr>
<tr><td class='ruff_defitem'><a href="mulster.html#::mulster::Mulster::mulsterList" title="mulsterList" class='ruff_cmd'>mulsterList</a></td><td class='ruff_defitem'>Performs replacements in a list.</td></tr>
</table>
<h4 class='ruffmethod'><a name='::mulster::Mulster::getBoolean'>getBoolean</a><span class='ns_scope'> [<a href="mulster.html#::mulster::Mulster" title="::mulster::Mulster" class='ruff_cmd'>::mulster::Mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster::Mulster'>Mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks and gets a boolean value.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getBoolean</span> <span class='ruff_arg'>val ?defval?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>val</code></td><td class='ruff_defitem'>a value to be checked</td></tr>
<tr><td class='ruff_defitem'><code>defval</code></td><td class='ruff_defitem'>a default value Optional, default <code>true</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a normalized value.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_2' href="javascript:toggleSource('2')">Show source</a></p>
<div id='2' class='ruff_dyn_src'><pre>method getBoolean {val {defval true}} {


    # Checks and gets a boolean value.
    #
    #   val - a value to be checked
    #   defval - a default value
    #
    # Returns a normalized value.

    if {$val ni {0 1 false true}} {set val $defval}
    return $val
}</pre></div>
</div><h4 class='ruffmethod'><a name='::mulster::Mulster::getSearchMode'>getSearchMode</a><span class='ns_scope'> [<a href="mulster.html#::mulster::Mulster" title="::mulster::Mulster" class='ruff_cmd'>::mulster::Mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster::Mulster'>Mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets a search mode as numeric from string.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getSearchMode</span> <span class='ruff_arg'>strmode</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>strmode</code></td><td class='ruff_defitem'>search mode in a string form (&quot;exact&quot;, &quot;RE&quot; etc.)</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Numeric mode:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'>0</td><td class='ruff_defitem'>to match exact, without their leading/tailing spaces (str trimmed)</td></tr>
<tr><td class='ruff_defitem'>1</td><td class='ruff_defitem'>to match exact, with all their leading/tailing spaces</td></tr>
<tr><td class='ruff_defitem'>2</td><td class='ruff_defitem'>to match glob</td></tr>
<tr><td class='ruff_defitem'>3</td><td class='ruff_defitem'>to match regexp for IN= lines and substitute by OUT= lines</td></tr>
<tr><td class='ruff_defitem'>4</td><td class='ruff_defitem'>to match regexp -all and call 'regsub -all'</td></tr>
<tr><td class='ruff_defitem'>8</td><td class='ruff_defitem'>to match regexp -nocase and call 'regsub -nocase'</td></tr>
<tr><td class='ruff_defitem'>16</td><td class='ruff_defitem'>to match regexp -expanded and call 'regsub -expanded'</td></tr>
</table>
<p class='ruff'>The mode can combine 4,8,16, e.g. 12 means &quot;regexp -all -nocase&quot;.</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns the numeric mode.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_3' href="javascript:toggleSource('3')">Show source</a></p>
<div id='3' class='ruff_dyn_src'><pre>method getSearchMode {strmode} {


    # Gets a search mode as numeric from string.
    #
    #   strmode - search mode in a string form (&quot;exact&quot;, &quot;RE&quot; etc.)
    #
    # Returns the numeric mode.
    #
    # Numeric mode:
    #   0 - to match exact, without their leading/tailing spaces (str trimmed)
    #   1 - to match exact, with all their leading/tailing spaces
    #   2 - to match glob
    #   3 - to match regexp for IN= lines and substitute by OUT= lines
    #   4 - to match regexp -all and call 'regsub -all'
    #   8 - to match regexp -nocase and call 'regsub -nocase'
    #  16 - to match regexp -expanded and call 'regsub -expanded'
    #
    # The mode can combine 4,8,16, e.g. 12 means &quot;regexp -all -nocase&quot;.

    if {[string is integer $strmode]} {return $strmode}
    set mode 0
    switch -regexp -nocase -matchvar am $strmode {
      ^exact$         {set mode 1}
      ^glob$          {set mode 2}
      ^regexp$ - ^re$ {set mode 3}
      ^regexp\\s*(-.*)$ - ^re\\s*(-.*) {
        set am [split [string toupper [lindex $am 1]] &quot; -&quot;]
        if {&quot;A&quot; in $am || &quot;ALL&quot; in $am} { incr mode 4 }
        if {&quot;N&quot; in $am || &quot;NOCASE&quot; in $am} { incr mode 8 }
        if {&quot;E&quot; in $am || &quot;EXPANDED&quot; in $am} { incr mode 16 }
        incr mode 32  ;# to call 'regsub' anyway
      }
    }
    return $mode
}</pre></div>
</div><h4 class='ruffmethod'><a name='::mulster::Mulster::init'>init</a><span class='ns_scope'> [<a href="mulster.html#::mulster::Mulster" title="::mulster::Mulster" class='ruff_cmd'>::mulster::Mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster::Mulster'>Mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Initializes processing files.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT init</span> <span class='ruff_arg'>infile outfile ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>infile</code></td><td class='ruff_defitem'>input file name</td></tr>
<tr><td class='ruff_defitem'><code>outfile</code></td><td class='ruff_defitem'>output file name</td></tr>
<tr><td class='ruff_defitem'><code>args</code></td><td class='ruff_defitem'>optional arguments</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_4' href="javascript:toggleSource('4')">Show source</a></p>
<div id='4' class='ruff_dyn_src'><pre>method init {infile outfile args} {


    # Initializes processing files.
    #
    #   infile - input file name
    #   outfile - output file name
    #   args - optional arguments

    array set _MMM {}
    my InitIO
    if {$infile ne &quot;&quot;} {
      set _MMM(fin) 1
      set _MMM(infile) $infile
    }
    if {$outfile ne &quot;&quot;} {
      set _MMM(fout) 1
      set _MMM(outfile) $outfile
    }
    set _MMM(IN_FILE)   INFILE=   ;# pattern for in file name
    set _MMM(OUT_FILE)  OUTFILE=  ;# pattern for out file name
    set _MMM(IN_BEGIN)  IN=BEGIN  ;# pattern for in lines start
    set _MMM(IN_END)    IN=END    ;# pattern for in lines finish
    set _MMM(OUT_BEGIN) OUT=BEGIN ;# pattern for out lines start
    set _MMM(OUT_END)   OUT=END   ;# pattern for out lines finish
    set _MMM(MODE)      MODE=     ;# pattern for exact/glob/regexp mode
    set _MMM(BACKUP)    BACKUP=   ;# pattern for backup dir name
    set _MMM(KEEP)      KEEP=     ;# pattern for keep mode
    set _MMM(SINGLE)    SINGLE=   ;# pattern for single mode
    set _MMM(CHARSET)   CHARSET=  ;# pattern for charset mode
    set _MMM(LINEEND)   LINEEND=  ;# pattern for lineend mode
    set _MMM(FILES)     FILES=    ;# pattern for files
    set _MMM(GRP1) {(.+)}           ;# RE group for a file name
    set _MMM(GRP2) {\((.+),(.+)\)}  ;# RE groups for range
    set _MMM(DEBUG) false         ;# DEBUG mode
    if { [self next] != {} } {
      return [next {*}$args]
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::mulster::Mulster::main'>main</a><span class='ns_scope'> [<a href="mulster.html#::mulster::Mulster" title="::mulster::Mulster" class='ruff_cmd'>::mulster::Mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster::Mulster'>Mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Processes files according to the options of 'fileini' file.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT main</span> <span class='ruff_arg'>fileini ?mode? ?backup? ?keep? ?single? ?charset? ?lineend? ?files?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>fileini</code></td><td class='ruff_defitem'>options file name</td></tr>
<tr><td class='ruff_defitem'><code>mode</code></td><td class='ruff_defitem'>a search mode (as defined in getSearchMode method) Optional, default <code>1</code>.</td></tr>
<tr><td class='ruff_defitem'><code>backup</code></td><td class='ruff_defitem'>if 0, means no backuping, otherwise - backup directory Optional, default <code>BAK</code>.</td></tr>
<tr><td class='ruff_defitem'><code>keep</code></td><td class='ruff_defitem'>if 1, keeps input files' attributes/times in output files Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>single</code></td><td class='ruff_defitem'>if 1, standard 'one string for one string' replacements Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>charset</code></td><td class='ruff_defitem'>a charset of input files (e.g. cp1251) Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>lineend</code></td><td class='ruff_defitem'>a line ending of input files (e.g. \r\n) Optional, default <code>&quot;&quot;</code>.</td></tr>
<tr><td class='ruff_defitem'><code>files</code></td><td class='ruff_defitem'>if 1, output lines are taken from files Optional, default <code>0</code>.</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="mulster.html#::mulster::Mulster::getSearchMode" title="getSearchMode" class='ruff_cmd'>getSearchMode</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_5' href="javascript:toggleSource('5')">Show source</a></p>
<div id='5' class='ruff_dyn_src'><pre>method main {fileini {mode 1} {backup BAK} {keep 0} {single 0} {charset {}} {lineend {}} {files 0}} {


    # Processes files according to the options of 'fileini' file.
    #
    #   fileini - options file name
    #   mode - a search mode (as defined in getSearchMode method)
    #   backup - if 0, means no backuping, otherwise - backup directory
    #   keep - if 1, keeps input files' attributes/times in output files
    #   single - if 1, standard 'one string for one string' replacements
    #   charset - a charset of input files (e.g. cp1251)
    #   lineend - a line ending of input files (e.g. \r\n)
    #   files - if 1, output lines are taken from files
    #
    # See also:
    #   getSearchMode

    set mode [my getSearchMode $mode]
    set keep [my getBoolean $keep]
    set single [my getBoolean $single]
    set fileon [my getBoolean $files]
    if {!($_MMM(fin) + $_MMM(fout))} { my InitIO }
    set state NONE
    set _MMM(st) [set comments &quot;&quot;]
    set _MMM(nl) 0
    set _MMM(fileini) $fileini
    set chini [my Topen $fileini]
    foreach _MMM(st) [split [read $chini] \n] {
      incr _MMM(nl)
      switch $state {
        NONE {
          # check for finish
          if {[regexp -nocase &quot;^\\s*MODE=EXIT&quot; $_MMM(st)]} {
            break
          # check for debug mode
          } elseif {[regexp -nocase &quot;^\\s*MODE=DEBUG&quot; $_MMM(st)]} {
            set _MMM(DEBUG) true
          # check for comments
          } elseif {[regexp &quot;^\\s*#&quot; $_MMM(st)]} {
            set comments &quot;\n$_MMM(st)&quot;
          } elseif {[my OptionIs $_MMM(MODE) $_MMM(GRP1)]} {
          # check for mode
            set mode [my getSearchMode $_MMM(match1)]
          # check for backup dir
          } elseif {[my OptionIs $_MMM(BACKUP) $_MMM(GRP1)]} {
            my FlushOut $mode $keep $charset $lineend $backup
            set backup $_MMM(match1)
          # check for keep state
          } elseif {[my OptionIs $_MMM(KEEP) $_MMM(GRP1)]} {
            my FlushOut $mode $keep $charset $lineend $backup
            set keep [my getBoolean $_MMM(match1)]
          # check for charset
          } elseif {[my OptionIs $_MMM(CHARSET) $_MMM(GRP1)]} {
            my FlushOut $mode $keep $charset $lineend $backup
            set charset $_MMM(match1)
          # check for lineend
          } elseif {[my OptionIs $_MMM(LINEEND) $_MMM(GRP1)]} {
            my FlushOut $mode $keep $charset $lineend $backup
            set lineend $_MMM(match1)
          # check for single state
          } elseif {[my OptionIs $_MMM(SINGLE) $_MMM(GRP1)]} {
            set single [my getBoolean $_MMM(match1)]
          # check for fileon state
          } elseif {[my OptionIs $_MMM(FILES) $_MMM(GRP1)]} {
            set fileon [my getBoolean $_MMM(match1)]
          # check for input file
          } elseif {[my OptionIs $_MMM(IN_FILE) $_MMM(GRP1)]} {
            my FlushOut $mode $keep $charset $lineend $backup
            set _MMM(fin) 1
            set _MMM(infile) $_MMM(match1)
          # check for output file
          } elseif {[my OptionIs $_MMM(OUT_FILE) $_MMM(GRP1)]} {
            my CheckFiles 1
            set _MMM(fout) 1
            set _MMM(outfile) $_MMM(match1)
          # check for input lines beginning
          } elseif {[my OptionIs $_MMM(IN_BEGIN)] ||  [my OptionIs $_MMM(IN_BEGIN) $_MMM(GRP2)]} {
            my CheckFiles 1
            my CheckFiles 2
            lappend _MMM(inlist) [list $_MMM(match1) $_MMM(match2)  $single $fileon $charset $lineend $mode $comments]
            set comments &quot;&quot;
            set state IN
          # check for output lines beginning
          } elseif {[my OptionIs $_MMM(OUT_BEGIN)]} {
            my CheckFiles 1
            my CheckFiles 2
            lappend _MMM(outlist) [list]
            set state OUT
          }
        }
        IN {
          # check for input lines ending
          if {[my OptionIs $_MMM(IN_END)]} {
            set state NONE
          } else {
            # collect the input lines
            set curl [lindex $_MMM(inlist) end]
            lappend curl $_MMM(st)
            set _MMM(inlist) [lreplace $_MMM(inlist) end end $curl]
          }
        }
        OUT {
          # check for output lines ending
          if {[my OptionIs $_MMM(OUT_END)]} {
            set state NONE
          } else {
            # collect the output lines
            set curl [lindex $_MMM(outlist) end]
            lappend curl $_MMM(st)
            set _MMM(outlist) [lreplace $_MMM(outlist) end end $curl]
          }
        }
      }
    }
    # flush out the collected lines if any
    my FlushOut $mode $keep $charset $lineend $backup
    close $chini
}</pre></div>
</div><h4 class='ruffmethod'><a name='::mulster::Mulster::mulsterList'>mulsterList</a><span class='ns_scope'> [<a href="mulster.html#::mulster::Mulster" title="::mulster::Mulster" class='ruff_cmd'>::mulster::Mulster</a>]</span><span class='tinylink'><a href='mulster.html#::mulster::Mulster'>Mulster</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Performs replacements in a list.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT mulsterList</span> <span class='ruff_arg'>lcont lin lout ?r1? ?r2? ?mode? ?single? ?files?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>lcont</code></td><td class='ruff_defitem'>a list to be processed</td></tr>
<tr><td class='ruff_defitem'><code>lin</code></td><td class='ruff_defitem'>input lines' list</td></tr>
<tr><td class='ruff_defitem'><code>lout</code></td><td class='ruff_defitem'>output lines' list</td></tr>
<tr><td class='ruff_defitem'><code>r1</code></td><td class='ruff_defitem'>first index of replacements to do Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>r2</code></td><td class='ruff_defitem'>last index of replacements to do Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>mode</code></td><td class='ruff_defitem'>a search mode (as defined in getSearchMode method) Optional, default <code>1</code>.</td></tr>
<tr><td class='ruff_defitem'><code>single</code></td><td class='ruff_defitem'>if true, means a standard 'string for string' replacements Optional, default <code>0</code>.</td></tr>
<tr><td class='ruff_defitem'><code>files</code></td><td class='ruff_defitem'>if true, output lines are taken from files Optional, default <code>0</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list with replacements made.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_6' href="javascript:toggleSource('6')">Show source</a></p>
<div id='6' class='ruff_dyn_src'><pre>method mulsterList {lcont lin lout {r1 0} {r2 0} {mode 1} {single 0} {files 0}} {


    # Performs replacements in a list.
    #
    #   lcont - a list to be processed
    #   lin - input lines' list
    #   lout - output lines' list
    #   r1 - first index of replacements to do
    #   r2 - last index of replacements to do
    #   mode - a search mode (as defined in getSearchMode method)
    #   single - if true, means a standard 'string for string' replacements
    #   files - if true, output lines are taken from files
    #
    # Returns a list with replacements made.

    set _MMM(repls) 0
    set leni [llength $lin]
    if {!$leni} {
      return $lcont  ;# nothing to replace
    }
    set lres [list]  ;# resulting list
    set sti0 [lindex $lin 0]
    if {$mode==0} {set sti0 [string trim $sti0]} ;# for a quick 1st check
    if {$files} {set lout [my FilesContents $lout]}
    set leno [llength $lout]
    set lenc [llength $lcont]
    set ic [set ifnd 0]
    while {$ic &lt; $lenc} {
      set stc [lindex $lcont $ic]
      if { [my CompareStr $mode $stc $sti0] } { ;# 1st line found
        for {set ii [set found 1]} {$ii&lt;$leni &amp;&amp; $found} {incr ii} {
          if {[set ic2 [expr {$ic + $ii}]] &gt;= $lenc} {
            set found 0  ;# out of lcont's range
          } else {
            set sti [lindex $lin $ii]
            set sto [lindex $lcont $ic2]
            if {$mode==0} {  ;# exact0 is 'trimmed exact' mode
              set found [my CompareStr $mode $sto [string trim $sti]]
            } else {
              set found [my CompareStr $mode $sto $sti]
            }
          }
        }
        if {$found} {
          incr ifnd
          ;# check a found ifnd-th bunch for the range (r1,r2)
          if {$ifnd&gt;=$r1 &amp;&amp; ($ifnd&lt;=$r2 || !$r2)} {
            set rinc 1
            for {set io 0} {$io&lt;$leno} {incr io} {
              set stout [lindex $lout $io]
              if {$mode&gt;3} {
                set rinc [regsub {*}[my ReOptions $mode]  [lindex $lin $io] $stc $stout stout]
              }
              lappend lres $stout
            }
            incr ic $leni  ;# go to a line just following the 'lin' bunch
            incr _MMM(repls) $rinc
          } else {         ;# not in the range r1-r2, so skip this IN=/OUT=
            for {set ii 0} {$ii&lt;$leni} {incr ii} {
              lappend lres [lindex $lcont $ic]
              incr ic
            }
          }
          continue
        }
      }
      if {$single} {   ;# do standard string replacement
        foreach si $lin so $lout {
          set stc2 [string map [list $si $so] $stc]
          if {$stc2 ne $stc} {
            incr ifnd
            ;# check a found ifnd-th bunch for the range (r1,r2)
            if {$ifnd&gt;=$r1 &amp;&amp; ($ifnd&lt;=$r2 || !$r2)} {
              set stc $stc2
              incr _MMM(repls)
            }
          }
        }
      }
      lappend lres $stc  ;# this line is not the 1st of 'lin' bunch
      incr ic
    }
    return $lres
}</pre></div>
</div></div></div><div class='yui-b navbox' ><h1><a href='#::mulster'>mulster</a></h1><h2><a href='#::mulster-Commands'>Commands</a></h2><h4 class='tooltip'><a href='mulster.html#::mulster::synopsis'>synopsis</a><span class='tooltiptext'>Puts a synopsis of mulster utility.
</span></h4><h2><a href='#::mulster-Classes'>Classes</a></h2><h3><a href='mulster.html#::mulster::Mulster'>Mulster</a></h3><h4 class='tooltip'><a href='mulster.html#::mulster::Mulster::getBoolean'>getBoolean</a><span class='tooltiptext'>Checks and gets a boolean value.
</span></h4><h4 class='tooltip'><a href='mulster.html#::mulster::Mulster::getSearchMode'>getSearchMode</a><span class='tooltiptext'>Gets a search mode as numeric from string.
</span></h4><h4 class='tooltip'><a href='mulster.html#::mulster::Mulster::init'>init</a><span class='tooltiptext'>Initializes processing files.
</span></h4><h4 class='tooltip'><a href='mulster.html#::mulster::Mulster::main'>main</a><span class='tooltiptext'>Processes files according to the options of 'fileini' file.
</span></h4><h4 class='tooltip'><a href='mulster.html#::mulster::Mulster::mulsterList'>mulsterList</a><span class='tooltiptext'>Performs replacements in a list.
</span></h4></div></div><div id='ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div></div>
</div></body></html>
